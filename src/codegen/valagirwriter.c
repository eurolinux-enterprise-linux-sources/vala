/* valagirwriter.c generated by valac, the Vala compiler
 * generated from valagirwriter.vala, do not modify */

/* valagirwriter.vala
 *
 * Copyright (C) 2008-2012  Jürg Billeter
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.

 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.

 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 * Author:
 * 	Jürg Billeter <j@bitron.ch>
 */


#include <glib.h>
#include <glib-object.h>
#include "valacodegen.h"
#include <vala.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>
#include <valagee.h>
#include <glib/gstdio.h>


#define VALA_GIR_WRITER_TYPE_GIR_NAMESPACE (vala_gir_writer_gir_namespace_get_type ())
typedef struct _ValaGIRWriterGIRNamespace ValaGIRWriterGIRNamespace;
#define _vala_code_context_unref0(var) ((var == NULL) ? NULL : (var = (vala_code_context_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_string_free0(var) ((var == NULL) ? NULL : (var = (g_string_free (var, TRUE), NULL)))
#define _fclose0(var) ((var == NULL) ? NULL : (var = (fclose (var), NULL)))
#define _vala_iterable_unref0(var) ((var == NULL) ? NULL : (var = (vala_iterable_unref (var), NULL)))
#define _vala_code_node_unref0(var) ((var == NULL) ? NULL : (var = (vala_code_node_unref (var), NULL)))
#define _vala_gir_writer_gir_namespace_free0(var) ((var == NULL) ? NULL : (var = (vala_gir_writer_gir_namespace_free (var), NULL)))
#define _vala_iterator_unref0(var) ((var == NULL) ? NULL : (var = (vala_iterator_unref (var), NULL)))
#define _vala_map_unref0(var) ((var == NULL) ? NULL : (var = (vala_map_unref (var), NULL)))
#define _g_regex_unref0(var) ((var == NULL) ? NULL : (var = (g_regex_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

struct _ValaGIRWriterGIRNamespace {
	gchar* ns;
	gchar* version;
};

struct _ValaGIRWriterPrivate {
	ValaCodeContext* context;
	gchar* directory;
	gchar* gir_namespace;
	gchar* gir_version;
	gchar* gir_shared_library;
	GString* buffer;
	FILE* stream;
	ValaHashSet* unannotated_namespaces;
	ValaHashSet* our_namespaces;
	ValaArrayList* hierarchy;
	ValaArrayList* deferred;
	gint indent;
	ValaTypeSymbol* gobject_type;
	ValaTypeSymbol* ginitiallyunowned_type;
	ValaArrayList* externals;
	gint enum_value;
};


static gpointer vala_gir_writer_parent_class = NULL;

static GType vala_gir_writer_gir_namespace_get_type (void) G_GNUC_CONST G_GNUC_UNUSED;
static ValaGIRWriterGIRNamespace* vala_gir_writer_gir_namespace_dup (const ValaGIRWriterGIRNamespace* self);
static void vala_gir_writer_gir_namespace_free (ValaGIRWriterGIRNamespace* self);
static void vala_gir_writer_gir_namespace_copy (const ValaGIRWriterGIRNamespace* self,
                                         ValaGIRWriterGIRNamespace* dest);
static void vala_gir_writer_gir_namespace_destroy (ValaGIRWriterGIRNamespace* self);
#define VALA_GIR_WRITER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), VALA_TYPE_GIR_WRITER, ValaGIRWriterPrivate))
static gboolean vala_gir_writer_gir_namespace_equal (ValaGIRWriterGIRNamespace *self,
                                              ValaGIRWriterGIRNamespace* g);
static gchar* vala_gir_writer_real_get_interface_comment (ValaGIRWriter* self,
                                                   ValaInterface* iface);
static gchar* vala_gir_writer_real_get_struct_comment (ValaGIRWriter* self,
                                                ValaStruct* st);
static gchar* vala_gir_writer_real_get_enum_comment (ValaGIRWriter* self,
                                              ValaEnum* en);
static gchar* vala_gir_writer_real_get_class_comment (ValaGIRWriter* self,
                                               ValaClass* c);
static gchar* vala_gir_writer_real_get_error_code_comment (ValaGIRWriter* self,
                                                    ValaErrorCode* ecode);
static gchar* vala_gir_writer_real_get_enum_value_comment (ValaGIRWriter* self,
                                                    ValaEnumValue* ev);
static gchar* vala_gir_writer_real_get_constant_comment (ValaGIRWriter* self,
                                                  ValaConstant* c);
static gchar* vala_gir_writer_real_get_error_domain_comment (ValaGIRWriter* self,
                                                      ValaErrorDomain* edomain);
static gchar* vala_gir_writer_real_get_field_comment (ValaGIRWriter* self,
                                               ValaField* f);
static gchar* vala_gir_writer_real_get_delegate_comment (ValaGIRWriter* self,
                                                  ValaDelegate* cb);
static gchar* vala_gir_writer_real_get_method_comment (ValaGIRWriter* self,
                                                ValaMethod* m);
static gchar* vala_gir_writer_real_get_property_comment (ValaGIRWriter* self,
                                                  ValaProperty* prop);
static gchar* vala_gir_writer_real_get_delegate_return_comment (ValaGIRWriter* self,
                                                         ValaDelegate* cb);
static gchar* vala_gir_writer_real_get_signal_return_comment (ValaGIRWriter* self,
                                                       ValaSignal* sig);
static gchar* vala_gir_writer_real_get_method_return_comment (ValaGIRWriter* self,
                                                       ValaMethod* m);
static gchar* vala_gir_writer_real_get_signal_comment (ValaGIRWriter* self,
                                                ValaSignal* sig);
static gchar* vala_gir_writer_real_get_parameter_comment (ValaGIRWriter* self,
                                                   ValaParameter* param);
static void vala_gir_writer_write_indent_stream (ValaGIRWriter* self);
static void vala_gir_writer_write_package (ValaGIRWriter* self,
                                    const gchar* package);
static void vala_gir_writer_write_doc (ValaGIRWriter* self,
                                const gchar* comment);
static void vala_gir_writer_write_indent (ValaGIRWriter* self);
static void vala_gir_writer_write_c_includes (ValaGIRWriter* self,
                                       ValaNamespace* ns);
static void vala_gir_writer_write_c_include (ValaGIRWriter* self,
                                      const gchar* name);
static void vala_gir_writer_real_visit_namespace (ValaCodeVisitor* base,
                                           ValaNamespace* ns);
static gboolean vala_gir_writer_is_visibility (ValaGIRWriter* self,
                                        ValaSymbol* sym);
static void vala_gir_writer_visit_deferred (ValaGIRWriter* self);
static void vala_gir_writer_write_symbol_attributes (ValaGIRWriter* self,
                                              ValaSymbol* symbol);
static gboolean vala_gir_writer_is_introspectable (ValaGIRWriter* self,
                                            ValaSymbol* sym);
static void vala_gir_writer_real_visit_class (ValaCodeVisitor* base,
                                       ValaClass* cl);
static gboolean vala_gir_writer_check_accessibility (ValaGIRWriter* self,
                                              ValaSymbol* sym);
static gchar* vala_gir_writer_get_gir_name (ValaGIRWriter* self,
                                     ValaSymbol* symbol);
static void vala_gir_writer_write_gtype_attributes (ValaGIRWriter* self,
                                             ValaTypeSymbol* symbol);
static gchar* vala_gir_writer_gi_type_name (ValaGIRWriter* self,
                                     ValaTypeSymbol* type_symbol);
static void vala_gir_writer_write_ctype_attributes (ValaGIRWriter* self,
                                             ValaTypeSymbol* symbol,
                                             const gchar* suffix);
static void vala_gir_writer_do_write_signature (ValaGIRWriter* self,
                                         ValaMethod* m,
                                         const gchar* tag_name,
                                         gboolean instance,
                                         const gchar* name,
                                         const gchar* cname,
                                         ValaList* params,
                                         ValaDataType* return_type,
                                         gboolean can_fail,
                                         gboolean write_comment);
static void vala_gir_writer_write_signature (ValaGIRWriter* self,
                                      ValaMethod* m,
                                      const gchar* tag_name,
                                      gboolean write_doc,
                                      gboolean instance);
static void vala_gir_writer_real_visit_struct (ValaCodeVisitor* base,
                                        ValaStruct* st);
static void vala_gir_writer_real_visit_interface (ValaCodeVisitor* base,
                                           ValaInterface* iface);
static void vala_gir_writer_real_visit_enum (ValaCodeVisitor* base,
                                      ValaEnum* en);
static void vala_gir_writer_real_visit_enum_value (ValaCodeVisitor* base,
                                            ValaEnumValue* ev);
static gchar* vala_gir_writer_literal_expression_to_value_string (ValaGIRWriter* self,
                                                           ValaExpression* literal);
static void vala_gir_writer_real_visit_error_domain (ValaCodeVisitor* base,
                                              ValaErrorDomain* edomain);
static void vala_gir_writer_real_visit_error_code (ValaCodeVisitor* base,
                                            ValaErrorCode* ecode);
static void vala_gir_writer_real_visit_constant (ValaCodeVisitor* base,
                                          ValaConstant* c);
static void vala_gir_writer_write_type (ValaGIRWriter* self,
                                 ValaDataType* type,
                                 gint index,
                                 ValaParameterDirection direction);
static void vala_gir_writer_real_visit_field (ValaCodeVisitor* base,
                                       ValaField* f);
static void vala_gir_writer_write_implicit_params (ValaGIRWriter* self,
                                            ValaDataType* type,
                                            gint* index,
                                            gboolean has_array_length,
                                            const gchar* name,
                                            ValaParameterDirection direction);
static void vala_gir_writer_write_param_or_return (ValaGIRWriter* self,
                                            ValaDataType* type,
                                            gboolean is_parameter,
                                            gint* index,
                                            gboolean has_array_length,
                                            const gchar* name,
                                            const gchar* comment,
                                            ValaParameterDirection direction,
                                            gboolean constructor,
                                            gboolean caller_allocates,
                                            gboolean ellipsis);
static void vala_gir_writer_skip_implicit_params (ValaGIRWriter* self,
                                           ValaDataType* type,
                                           gint* index,
                                           gboolean has_array_length);
static void vala_gir_writer_write_params_and_return (ValaGIRWriter* self,
                                              ValaList* params,
                                              ValaDataType* return_type,
                                              gboolean return_array_length,
                                              const gchar* return_comment,
                                              gboolean constructor,
                                              ValaDataType* instance_type,
                                              gboolean user_data);
static void vala_gir_writer_real_visit_delegate (ValaCodeVisitor* base,
                                          ValaDelegate* cb);
static void vala_gir_writer_real_visit_method (ValaCodeVisitor* base,
                                        ValaMethod* m);
static gboolean vala_gir_writer_is_type_introspectable (ValaGIRWriter* self,
                                                 ValaDataType* type);
static gboolean vala_gir_writer_is_method_introspectable (ValaGIRWriter* self,
                                                   ValaMethod* m);
static void vala_gir_writer_real_visit_creation_method (ValaCodeVisitor* base,
                                                 ValaCreationMethod* m);
static void vala_gir_writer_real_visit_property (ValaCodeVisitor* base,
                                          ValaProperty* prop);
static void vala_gir_writer_real_visit_signal (ValaCodeVisitor* base,
                                        ValaSignal* sig);
static gchar* vala_gir_writer_get_full_gir_name (ValaGIRWriter* self,
                                          ValaSymbol* sym);
static void vala_gir_writer_gir_namespace_init (ValaGIRWriterGIRNamespace *self,
                                         const gchar* ns,
                                         const gchar* version);
static void vala_gir_writer_finalize (ValaCodeVisitor * obj);
static void _vala_array_destroy (gpointer array,
                          gint array_length,
                          GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array,
                       gint array_length,
                       GDestroyNotify destroy_func);
static gint _vala_array_length (gpointer array);


static gchar*
vala_gir_writer_real_get_interface_comment (ValaGIRWriter* self,
                                            ValaInterface* iface)
{
	gchar* result = NULL;
	g_return_val_if_fail (iface != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_interface_comment (ValaGIRWriter* self,
                                       ValaInterface* iface)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_interface_comment (self, iface);
}


static gchar*
vala_gir_writer_real_get_struct_comment (ValaGIRWriter* self,
                                         ValaStruct* st)
{
	gchar* result = NULL;
	g_return_val_if_fail (st != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_struct_comment (ValaGIRWriter* self,
                                    ValaStruct* st)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_struct_comment (self, st);
}


static gchar*
vala_gir_writer_real_get_enum_comment (ValaGIRWriter* self,
                                       ValaEnum* en)
{
	gchar* result = NULL;
	g_return_val_if_fail (en != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_enum_comment (ValaGIRWriter* self,
                                  ValaEnum* en)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_enum_comment (self, en);
}


static gchar*
vala_gir_writer_real_get_class_comment (ValaGIRWriter* self,
                                        ValaClass* c)
{
	gchar* result = NULL;
	g_return_val_if_fail (c != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_class_comment (ValaGIRWriter* self,
                                   ValaClass* c)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_class_comment (self, c);
}


static gchar*
vala_gir_writer_real_get_error_code_comment (ValaGIRWriter* self,
                                             ValaErrorCode* ecode)
{
	gchar* result = NULL;
	g_return_val_if_fail (ecode != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_error_code_comment (ValaGIRWriter* self,
                                        ValaErrorCode* ecode)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_error_code_comment (self, ecode);
}


static gchar*
vala_gir_writer_real_get_enum_value_comment (ValaGIRWriter* self,
                                             ValaEnumValue* ev)
{
	gchar* result = NULL;
	g_return_val_if_fail (ev != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_enum_value_comment (ValaGIRWriter* self,
                                        ValaEnumValue* ev)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_enum_value_comment (self, ev);
}


static gchar*
vala_gir_writer_real_get_constant_comment (ValaGIRWriter* self,
                                           ValaConstant* c)
{
	gchar* result = NULL;
	g_return_val_if_fail (c != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_constant_comment (ValaGIRWriter* self,
                                      ValaConstant* c)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_constant_comment (self, c);
}


static gchar*
vala_gir_writer_real_get_error_domain_comment (ValaGIRWriter* self,
                                               ValaErrorDomain* edomain)
{
	gchar* result = NULL;
	g_return_val_if_fail (edomain != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_error_domain_comment (ValaGIRWriter* self,
                                          ValaErrorDomain* edomain)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_error_domain_comment (self, edomain);
}


static gchar*
vala_gir_writer_real_get_field_comment (ValaGIRWriter* self,
                                        ValaField* f)
{
	gchar* result = NULL;
	g_return_val_if_fail (f != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_field_comment (ValaGIRWriter* self,
                                   ValaField* f)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_field_comment (self, f);
}


static gchar*
vala_gir_writer_real_get_delegate_comment (ValaGIRWriter* self,
                                           ValaDelegate* cb)
{
	gchar* result = NULL;
	g_return_val_if_fail (cb != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_delegate_comment (ValaGIRWriter* self,
                                      ValaDelegate* cb)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_delegate_comment (self, cb);
}


static gchar*
vala_gir_writer_real_get_method_comment (ValaGIRWriter* self,
                                         ValaMethod* m)
{
	gchar* result = NULL;
	g_return_val_if_fail (m != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_method_comment (ValaGIRWriter* self,
                                    ValaMethod* m)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_method_comment (self, m);
}


static gchar*
vala_gir_writer_real_get_property_comment (ValaGIRWriter* self,
                                           ValaProperty* prop)
{
	gchar* result = NULL;
	g_return_val_if_fail (prop != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_property_comment (ValaGIRWriter* self,
                                      ValaProperty* prop)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_property_comment (self, prop);
}


static gchar*
vala_gir_writer_real_get_delegate_return_comment (ValaGIRWriter* self,
                                                  ValaDelegate* cb)
{
	gchar* result = NULL;
	g_return_val_if_fail (cb != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_delegate_return_comment (ValaGIRWriter* self,
                                             ValaDelegate* cb)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_delegate_return_comment (self, cb);
}


static gchar*
vala_gir_writer_real_get_signal_return_comment (ValaGIRWriter* self,
                                                ValaSignal* sig)
{
	gchar* result = NULL;
	g_return_val_if_fail (sig != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_signal_return_comment (ValaGIRWriter* self,
                                           ValaSignal* sig)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_signal_return_comment (self, sig);
}


static gchar*
vala_gir_writer_real_get_method_return_comment (ValaGIRWriter* self,
                                                ValaMethod* m)
{
	gchar* result = NULL;
	g_return_val_if_fail (m != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_method_return_comment (ValaGIRWriter* self,
                                           ValaMethod* m)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_method_return_comment (self, m);
}


static gchar*
vala_gir_writer_real_get_signal_comment (ValaGIRWriter* self,
                                         ValaSignal* sig)
{
	gchar* result = NULL;
	g_return_val_if_fail (sig != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_signal_comment (ValaGIRWriter* self,
                                    ValaSignal* sig)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_signal_comment (self, sig);
}


static gchar*
vala_gir_writer_real_get_parameter_comment (ValaGIRWriter* self,
                                            ValaParameter* param)
{
	gchar* result = NULL;
	g_return_val_if_fail (param != NULL, NULL);
	result = NULL;
	return result;
}


gchar*
vala_gir_writer_get_parameter_comment (ValaGIRWriter* self,
                                       ValaParameter* param)
{
	g_return_val_if_fail (self != NULL, NULL);
	return VALA_GIR_WRITER_GET_CLASS (self)->get_parameter_comment (self, param);
}


static gpointer
_vala_iterable_ref0 (gpointer self)
{
	return self ? vala_iterable_ref (self) : NULL;
}


void
vala_gir_writer_write_includes (ValaGIRWriter* self)
{
	g_return_if_fail (self != NULL);
	{
		ValaArrayList* _i_list = NULL;
		ValaArrayList* _tmp0_;
		ValaArrayList* _tmp1_;
		gint _i_size = 0;
		ValaArrayList* _tmp2_;
		gint _tmp3_;
		gint _tmp4_;
		gint _i_index = 0;
		_tmp0_ = self->priv->externals;
		_tmp1_ = _vala_iterable_ref0 (_tmp0_);
		_i_list = _tmp1_;
		_tmp2_ = _i_list;
		_tmp3_ = vala_collection_get_size ((ValaCollection*) _tmp2_);
		_tmp4_ = _tmp3_;
		_i_size = _tmp4_;
		_i_index = -1;
		while (TRUE) {
			gint _tmp5_;
			gint _tmp6_;
			gint _tmp7_;
			ValaGIRWriterGIRNamespace* i = NULL;
			ValaArrayList* _tmp8_;
			gint _tmp9_;
			gpointer _tmp10_;
			ValaGIRWriterGIRNamespace* _tmp11_;
			const gchar* _tmp12_;
			const gchar* _tmp13_;
			_tmp5_ = _i_index;
			_i_index = _tmp5_ + 1;
			_tmp6_ = _i_index;
			_tmp7_ = _i_size;
			if (!(_tmp6_ < _tmp7_)) {
				break;
			}
			_tmp8_ = _i_list;
			_tmp9_ = _i_index;
			_tmp10_ = vala_list_get ((ValaList*) _tmp8_, _tmp9_);
			i = (ValaGIRWriterGIRNamespace*) _tmp10_;
			_tmp11_ = i;
			_tmp12_ = (*_tmp11_).ns;
			_tmp13_ = self->priv->gir_namespace;
			if (g_strcmp0 (_tmp12_, _tmp13_) != 0) {
				FILE* _tmp14_;
				ValaGIRWriterGIRNamespace* _tmp15_;
				const gchar* _tmp16_;
				ValaGIRWriterGIRNamespace* _tmp17_;
				const gchar* _tmp18_;
				vala_gir_writer_write_indent_stream (self);
				_tmp14_ = self->priv->stream;
				_tmp15_ = i;
				_tmp16_ = (*_tmp15_).ns;
				_tmp17_ = i;
				_tmp18_ = (*_tmp17_).version;
				fprintf (_tmp14_, "<include name=\"%s\" version=\"%s\"/>\n", _tmp16_, _tmp18_);
			}
			_vala_gir_writer_gir_namespace_free0 (i);
		}
		_vala_iterable_unref0 (_i_list);
	}
}


/**
 * Writes the public interface of the specified code context into the
 * specified file.
 *
 * @param context      a code context
 * @param gir_filename a relative or absolute filename
 */
static gpointer
_vala_code_context_ref0 (gpointer self)
{
	return self ? vala_code_context_ref (self) : NULL;
}


static gpointer
_vala_code_node_ref0 (gpointer self)
{
	return self ? vala_code_node_ref (self) : NULL;
}


void
vala_gir_writer_write_file (ValaGIRWriter* self,
                            ValaCodeContext* context,
                            const gchar* directory,
                            const gchar* gir_filename,
                            const gchar* gir_namespace,
                            const gchar* gir_version,
                            const gchar* package,
                            const gchar* gir_shared_library)
{
	ValaCodeContext* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	ValaNamespace* root_symbol = NULL;
	ValaNamespace* _tmp5_;
	ValaNamespace* _tmp6_;
	ValaNamespace* _tmp7_;
	ValaSymbol* glib_ns = NULL;
	ValaNamespace* _tmp8_;
	ValaScope* _tmp9_;
	ValaScope* _tmp10_;
	ValaSymbol* _tmp11_;
	ValaSymbol* _tmp12_;
	ValaScope* _tmp13_;
	ValaScope* _tmp14_;
	ValaSymbol* _tmp15_;
	ValaSymbol* _tmp16_;
	ValaScope* _tmp17_;
	ValaScope* _tmp18_;
	ValaSymbol* _tmp19_;
	gint _tmp20_;
	GString* _tmp21_;
	gchar* filename = NULL;
	gchar* _tmp22_;
	const gchar* _tmp23_;
	FILE* _tmp24_;
	FILE* _tmp25_;
	FILE* _tmp29_;
	FILE* _tmp30_;
	FILE* _tmp31_;
	FILE* _tmp32_;
	FILE* _tmp33_;
	FILE* _tmp34_;
	gint _tmp35_;
	gint _tmp36_;
	FILE* _tmp37_;
	GString* _tmp38_;
	const gchar* _tmp39_;
	ValaHashSet* _tmp70_;
	gint _tmp71_;
	gint _tmp72_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (context != NULL);
	g_return_if_fail (directory != NULL);
	g_return_if_fail (gir_filename != NULL);
	g_return_if_fail (gir_namespace != NULL);
	g_return_if_fail (gir_version != NULL);
	g_return_if_fail (package != NULL);
	_tmp0_ = _vala_code_context_ref0 (context);
	_vala_code_context_unref0 (self->priv->context);
	self->priv->context = _tmp0_;
	_tmp1_ = g_strdup (directory);
	_g_free0 (self->priv->directory);
	self->priv->directory = _tmp1_;
	_tmp2_ = g_strdup (gir_namespace);
	_g_free0 (self->priv->gir_namespace);
	self->priv->gir_namespace = _tmp2_;
	_tmp3_ = g_strdup (gir_version);
	_g_free0 (self->priv->gir_version);
	self->priv->gir_version = _tmp3_;
	_tmp4_ = g_strdup (gir_shared_library);
	_g_free0 (self->priv->gir_shared_library);
	self->priv->gir_shared_library = _tmp4_;
	_tmp5_ = vala_code_context_get_root (context);
	_tmp6_ = _tmp5_;
	_tmp7_ = _vala_code_node_ref0 (_tmp6_);
	root_symbol = _tmp7_;
	_tmp8_ = root_symbol;
	_tmp9_ = vala_symbol_get_scope ((ValaSymbol*) _tmp8_);
	_tmp10_ = _tmp9_;
	_tmp11_ = vala_scope_lookup (_tmp10_, "GLib");
	glib_ns = _tmp11_;
	_tmp12_ = glib_ns;
	_tmp13_ = vala_symbol_get_scope (_tmp12_);
	_tmp14_ = _tmp13_;
	_tmp15_ = vala_scope_lookup (_tmp14_, "Object");
	_vala_code_node_unref0 (self->priv->gobject_type);
	self->priv->gobject_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp15_, VALA_TYPE_TYPESYMBOL, ValaTypeSymbol);
	_tmp16_ = glib_ns;
	_tmp17_ = vala_symbol_get_scope (_tmp16_);
	_tmp18_ = _tmp17_;
	_tmp19_ = vala_scope_lookup (_tmp18_, "InitiallyUnowned");
	_vala_code_node_unref0 (self->priv->ginitiallyunowned_type);
	self->priv->ginitiallyunowned_type = G_TYPE_CHECK_INSTANCE_CAST (_tmp19_, VALA_TYPE_TYPESYMBOL, ValaTypeSymbol);
	vala_gir_writer_write_package (self, package);
	vala_code_context_accept (context, (ValaCodeVisitor*) self);
	_tmp20_ = self->priv->indent;
	self->priv->indent = _tmp20_ - 1;
	_tmp21_ = self->priv->buffer;
	g_string_append_printf (_tmp21_, "</repository>\n");
	_tmp22_ = g_strdup_printf ("%s%c%s", directory, (gint) G_DIR_SEPARATOR, gir_filename);
	filename = _tmp22_;
	_tmp23_ = filename;
	_tmp24_ = g_fopen (_tmp23_, "w");
	_fclose0 (self->priv->stream);
	self->priv->stream = _tmp24_;
	_tmp25_ = self->priv->stream;
	if (_tmp25_ == NULL) {
		const gchar* _tmp26_;
		gchar* _tmp27_;
		gchar* _tmp28_;
		_tmp26_ = filename;
		_tmp27_ = g_strdup_printf ("unable to open `%s' for writing", _tmp26_);
		_tmp28_ = _tmp27_;
		vala_report_error (NULL, _tmp28_);
		_g_free0 (_tmp28_);
		_vala_code_context_unref0 (self->priv->context);
		self->priv->context = NULL;
		_g_free0 (filename);
		_vala_code_node_unref0 (glib_ns);
		_vala_code_node_unref0 (root_symbol);
		return;
	}
	_tmp29_ = self->priv->stream;
	fprintf (_tmp29_, "<?xml version=\"1.0\"?>\n");
	_tmp30_ = self->priv->stream;
	fprintf (_tmp30_, "<repository version=\"1.2\"");
	_tmp31_ = self->priv->stream;
	fprintf (_tmp31_, " xmlns=\"http://www.gtk.org/introspection/core/1.0\"");
	_tmp32_ = self->priv->stream;
	fprintf (_tmp32_, " xmlns:c=\"http://www.gtk.org/introspection/c/1.0\"");
	_tmp33_ = self->priv->stream;
	fprintf (_tmp33_, " xmlns:glib=\"http://www.gtk.org/introspection/glib/1.0\"");
	_tmp34_ = self->priv->stream;
	fprintf (_tmp34_, ">\n");
	_tmp35_ = self->priv->indent;
	self->priv->indent = _tmp35_ + 1;
	vala_gir_writer_write_includes (self);
	_tmp36_ = self->priv->indent;
	self->priv->indent = _tmp36_ - 1;
	_tmp37_ = self->priv->stream;
	_tmp38_ = self->priv->buffer;
	_tmp39_ = _tmp38_->str;
	fputs (_tmp39_, _tmp37_);
	_fclose0 (self->priv->stream);
	self->priv->stream = NULL;
	{
		ValaIterator* _ns_it = NULL;
		ValaHashSet* _tmp40_;
		ValaIterator* _tmp41_;
		_tmp40_ = self->priv->unannotated_namespaces;
		_tmp41_ = vala_iterable_iterator ((ValaIterable*) _tmp40_);
		_ns_it = _tmp41_;
		while (TRUE) {
			ValaIterator* _tmp42_;
			ValaNamespace* ns = NULL;
			ValaIterator* _tmp43_;
			gpointer _tmp44_;
			ValaHashSet* _tmp45_;
			ValaNamespace* _tmp46_;
			_tmp42_ = _ns_it;
			if (!vala_iterator_next (_tmp42_)) {
				break;
			}
			_tmp43_ = _ns_it;
			_tmp44_ = vala_iterator_get (_tmp43_);
			ns = (ValaNamespace*) _tmp44_;
			_tmp45_ = self->priv->our_namespaces;
			_tmp46_ = ns;
			if (!vala_collection_contains ((ValaCollection*) _tmp45_, _tmp46_)) {
				ValaNamespace* _tmp47_;
				ValaSourceReference* _tmp48_;
				ValaSourceReference* _tmp49_;
				ValaNamespace* _tmp50_;
				const gchar* _tmp51_;
				const gchar* _tmp52_;
				gchar* _tmp53_;
				gchar* _tmp54_;
				_tmp47_ = ns;
				_tmp48_ = vala_code_node_get_source_reference ((ValaCodeNode*) _tmp47_);
				_tmp49_ = _tmp48_;
				_tmp50_ = ns;
				_tmp51_ = vala_symbol_get_name ((ValaSymbol*) _tmp50_);
				_tmp52_ = _tmp51_;
				_tmp53_ = g_strdup_printf ("Namespace %s does not have a GIR namespace and version annotation", _tmp52_);
				_tmp54_ = _tmp53_;
				vala_report_warning (_tmp49_, _tmp54_);
				_g_free0 (_tmp54_);
			}
			_vala_code_node_unref0 (ns);
		}
		_vala_iterator_unref0 (_ns_it);
	}
	{
		ValaIterator* _ns_it = NULL;
		ValaHashSet* _tmp55_;
		ValaIterator* _tmp56_;
		_tmp55_ = self->priv->our_namespaces;
		_tmp56_ = vala_iterable_iterator ((ValaIterable*) _tmp55_);
		_ns_it = _tmp56_;
		while (TRUE) {
			ValaIterator* _tmp57_;
			ValaNamespace* ns = NULL;
			ValaIterator* _tmp58_;
			gpointer _tmp59_;
			ValaNamespace* _tmp60_;
			ValaSourceReference* _tmp61_;
			ValaSourceReference* _tmp62_;
			ValaSourceFile* _tmp63_;
			ValaSourceFile* _tmp64_;
			ValaNamespace* _tmp65_;
			ValaSourceReference* _tmp66_;
			ValaSourceReference* _tmp67_;
			ValaSourceFile* _tmp68_;
			ValaSourceFile* _tmp69_;
			_tmp57_ = _ns_it;
			if (!vala_iterator_next (_tmp57_)) {
				break;
			}
			_tmp58_ = _ns_it;
			_tmp59_ = vala_iterator_get (_tmp58_);
			ns = (ValaNamespace*) _tmp59_;
			_tmp60_ = ns;
			_tmp61_ = vala_code_node_get_source_reference ((ValaCodeNode*) _tmp60_);
			_tmp62_ = _tmp61_;
			_tmp63_ = vala_source_reference_get_file (_tmp62_);
			_tmp64_ = _tmp63_;
			vala_source_file_set_gir_namespace (_tmp64_, gir_namespace);
			_tmp65_ = ns;
			_tmp66_ = vala_code_node_get_source_reference ((ValaCodeNode*) _tmp65_);
			_tmp67_ = _tmp66_;
			_tmp68_ = vala_source_reference_get_file (_tmp67_);
			_tmp69_ = _tmp68_;
			vala_source_file_set_gir_version (_tmp69_, gir_version);
			_vala_code_node_unref0 (ns);
		}
		_vala_iterator_unref0 (_ns_it);
	}
	_tmp70_ = self->priv->our_namespaces;
	_tmp71_ = vala_collection_get_size ((ValaCollection*) _tmp70_);
	_tmp72_ = _tmp71_;
	if (_tmp72_ == 0) {
		vala_report_error (NULL, "No suitable namespace found to export for GIR");
	}
	_vala_code_context_unref0 (self->priv->context);
	self->priv->context = NULL;
	_g_free0 (filename);
	_vala_code_node_unref0 (glib_ns);
	_vala_code_node_unref0 (root_symbol);
}


static void
vala_gir_writer_write_doc (ValaGIRWriter* self,
                           const gchar* comment)
{
	g_return_if_fail (self != NULL);
	if (comment != NULL) {
		GString* _tmp0_;
		GString* _tmp1_;
		GString* _tmp2_;
		vala_gir_writer_write_indent (self);
		_tmp0_ = self->priv->buffer;
		g_string_append (_tmp0_, "<doc xml:whitespace=\"preserve\">");
		_tmp1_ = self->priv->buffer;
		g_string_append (_tmp1_, comment);
		_tmp2_ = self->priv->buffer;
		g_string_append (_tmp2_, "</doc>\n");
	}
}


static void
vala_gir_writer_write_package (ValaGIRWriter* self,
                               const gchar* package)
{
	GString* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (package != NULL);
	vala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<package name=\"%s\"/>\n", package);
}


static void
vala_gir_writer_write_c_includes (ValaGIRWriter* self,
                                  ValaNamespace* ns)
{
	ValaSet* header_filenames = NULL;
	GHashFunc _tmp0_;
	GEqualFunc _tmp1_;
	ValaHashSet* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	gchar** _tmp5_;
	gchar** _tmp6_;
	gchar** _tmp7_;
	gint _tmp7__length1;
	g_return_if_fail (self != NULL);
	g_return_if_fail (ns != NULL);
	_tmp0_ = g_str_hash;
	_tmp1_ = g_str_equal;
	_tmp2_ = vala_hash_set_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, (GDestroyNotify) g_free, _tmp0_, _tmp1_);
	header_filenames = (ValaSet*) _tmp2_;
	_tmp3_ = vala_get_ccode_header_filenames ((ValaSymbol*) ns);
	_tmp4_ = _tmp3_;
	_tmp6_ = _tmp5_ = g_strsplit (_tmp4_, ",", 0);
	_tmp7_ = _tmp6_;
	_tmp7__length1 = _vala_array_length (_tmp5_);
	_g_free0 (_tmp4_);
	{
		gchar** c_header_filename_collection = NULL;
		gint c_header_filename_collection_length1 = 0;
		gint _c_header_filename_collection_size_ = 0;
		gint c_header_filename_it = 0;
		c_header_filename_collection = _tmp7_;
		c_header_filename_collection_length1 = _tmp7__length1;
		for (c_header_filename_it = 0; c_header_filename_it < _tmp7__length1; c_header_filename_it = c_header_filename_it + 1) {
			const gchar* c_header_filename = NULL;
			c_header_filename = c_header_filename_collection[c_header_filename_it];
			{
				ValaSet* _tmp8_;
				const gchar* _tmp9_;
				_tmp8_ = header_filenames;
				_tmp9_ = c_header_filename;
				vala_collection_add ((ValaCollection*) _tmp8_, _tmp9_);
			}
		}
		c_header_filename_collection = (_vala_array_free (c_header_filename_collection, c_header_filename_collection_length1, (GDestroyNotify) g_free), NULL);
	}
	{
		ValaIterator* _symbol_it = NULL;
		ValaScope* _tmp10_;
		ValaScope* _tmp11_;
		ValaMap* _tmp12_;
		ValaMap* _tmp13_;
		ValaCollection* _tmp14_;
		ValaCollection* _tmp15_;
		ValaIterator* _tmp16_;
		ValaIterator* _tmp17_;
		_tmp10_ = vala_symbol_get_scope ((ValaSymbol*) ns);
		_tmp11_ = _tmp10_;
		_tmp12_ = vala_scope_get_symbol_table (_tmp11_);
		_tmp13_ = _tmp12_;
		_tmp14_ = vala_map_get_values (_tmp13_);
		_tmp15_ = _tmp14_;
		_tmp16_ = vala_iterable_iterator ((ValaIterable*) _tmp15_);
		_tmp17_ = _tmp16_;
		_vala_iterable_unref0 (_tmp15_);
		_vala_map_unref0 (_tmp13_);
		_symbol_it = _tmp17_;
		while (TRUE) {
			ValaIterator* _tmp18_;
			ValaSymbol* symbol = NULL;
			ValaIterator* _tmp19_;
			gpointer _tmp20_;
			ValaSymbol* _tmp21_;
			gchar* _tmp22_;
			gchar* _tmp23_;
			gchar** _tmp24_;
			gchar** _tmp25_;
			gchar** _tmp26_;
			gint _tmp26__length1;
			_tmp18_ = _symbol_it;
			if (!vala_iterator_next (_tmp18_)) {
				break;
			}
			_tmp19_ = _symbol_it;
			_tmp20_ = vala_iterator_get (_tmp19_);
			symbol = (ValaSymbol*) _tmp20_;
			_tmp21_ = symbol;
			_tmp22_ = vala_get_ccode_header_filenames (_tmp21_);
			_tmp23_ = _tmp22_;
			_tmp25_ = _tmp24_ = g_strsplit (_tmp23_, ",", 0);
			_tmp26_ = _tmp25_;
			_tmp26__length1 = _vala_array_length (_tmp24_);
			_g_free0 (_tmp23_);
			{
				gchar** c_header_filename_collection = NULL;
				gint c_header_filename_collection_length1 = 0;
				gint _c_header_filename_collection_size_ = 0;
				gint c_header_filename_it = 0;
				c_header_filename_collection = _tmp26_;
				c_header_filename_collection_length1 = _tmp26__length1;
				for (c_header_filename_it = 0; c_header_filename_it < _tmp26__length1; c_header_filename_it = c_header_filename_it + 1) {
					const gchar* c_header_filename = NULL;
					c_header_filename = c_header_filename_collection[c_header_filename_it];
					{
						ValaSet* _tmp27_;
						const gchar* _tmp28_;
						_tmp27_ = header_filenames;
						_tmp28_ = c_header_filename;
						vala_collection_add ((ValaCollection*) _tmp27_, _tmp28_);
					}
				}
				c_header_filename_collection = (_vala_array_free (c_header_filename_collection, c_header_filename_collection_length1, (GDestroyNotify) g_free), NULL);
			}
			_vala_code_node_unref0 (symbol);
		}
		_vala_iterator_unref0 (_symbol_it);
	}
	{
		ValaIterator* _c_header_filename_it = NULL;
		ValaSet* _tmp29_;
		ValaIterator* _tmp30_;
		_tmp29_ = header_filenames;
		_tmp30_ = vala_iterable_iterator ((ValaIterable*) _tmp29_);
		_c_header_filename_it = _tmp30_;
		while (TRUE) {
			ValaIterator* _tmp31_;
			gchar* c_header_filename = NULL;
			ValaIterator* _tmp32_;
			gpointer _tmp33_;
			const gchar* _tmp34_;
			_tmp31_ = _c_header_filename_it;
			if (!vala_iterator_next (_tmp31_)) {
				break;
			}
			_tmp32_ = _c_header_filename_it;
			_tmp33_ = vala_iterator_get (_tmp32_);
			c_header_filename = (gchar*) _tmp33_;
			_tmp34_ = c_header_filename;
			vala_gir_writer_write_c_include (self, _tmp34_);
			_g_free0 (c_header_filename);
		}
		_vala_iterator_unref0 (_c_header_filename_it);
	}
	_vala_iterable_unref0 (header_filenames);
}


static void
vala_gir_writer_write_c_include (ValaGIRWriter* self,
                                 const gchar* name)
{
	GString* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (name != NULL);
	vala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<c:include name=\"%s\"/>\n", name);
}


static void
vala_gir_writer_real_visit_namespace (ValaCodeVisitor* base,
                                      ValaNamespace* ns)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	const gchar* _tmp2_;
	const gchar* _tmp3_;
	ValaSymbol* _tmp8_;
	ValaSymbol* _tmp9_;
	const gchar* _tmp10_;
	const gchar* _tmp11_;
	GString* _tmp12_;
	const gchar* _tmp13_;
	const gchar* _tmp14_;
	gchar* cprefix = NULL;
	gchar* _tmp15_;
	const gchar* _tmp16_;
	const gchar* _tmp19_;
	GString* _tmp22_;
	gint _tmp23_;
	ValaArrayList* _tmp24_;
	ValaArrayList* _tmp25_;
	gpointer _tmp26_;
	ValaSymbol* _tmp27_;
	gint _tmp28_;
	GString* _tmp29_;
	ValaHashSet* _tmp30_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (ns != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) ns);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_is_visibility (self, (ValaSymbol*) ns)) {
		return;
	}
	_tmp2_ = vala_symbol_get_name ((ValaSymbol*) ns);
	_tmp3_ = _tmp2_;
	if (_tmp3_ == NULL) {
		ValaArrayList* _tmp4_;
		ValaArrayList* _tmp5_;
		gpointer _tmp6_;
		ValaSymbol* _tmp7_;
		_tmp4_ = self->priv->hierarchy;
		vala_list_insert ((ValaList*) _tmp4_, 0, (ValaSymbol*) ns);
		vala_code_node_accept_children ((ValaCodeNode*) ns, (ValaCodeVisitor*) self);
		_tmp5_ = self->priv->hierarchy;
		_tmp6_ = vala_list_remove_at ((ValaList*) _tmp5_, 0);
		_tmp7_ = (ValaSymbol*) _tmp6_;
		_vala_code_node_unref0 (_tmp7_);
		return;
	}
	_tmp8_ = vala_symbol_get_parent_symbol ((ValaSymbol*) ns);
	_tmp9_ = _tmp8_;
	_tmp10_ = vala_symbol_get_name (_tmp9_);
	_tmp11_ = _tmp10_;
	if (_tmp11_ != NULL) {
		vala_code_node_accept_children ((ValaCodeNode*) ns, (ValaCodeVisitor*) self);
		return;
	}
	vala_gir_writer_write_c_includes (self, ns);
	vala_gir_writer_write_indent (self);
	_tmp12_ = self->priv->buffer;
	_tmp13_ = self->priv->gir_namespace;
	_tmp14_ = self->priv->gir_version;
	g_string_append_printf (_tmp12_, "<namespace name=\"%s\" version=\"%s\"", _tmp13_, _tmp14_);
	_tmp15_ = vala_get_ccode_prefix ((ValaSymbol*) ns);
	cprefix = _tmp15_;
	_tmp16_ = self->priv->gir_shared_library;
	if (_tmp16_ != NULL) {
		GString* _tmp17_;
		const gchar* _tmp18_;
		_tmp17_ = self->priv->buffer;
		_tmp18_ = self->priv->gir_shared_library;
		g_string_append_printf (_tmp17_, " shared-library=\"%s\"", _tmp18_);
	}
	_tmp19_ = cprefix;
	if (_tmp19_ != NULL) {
		GString* _tmp20_;
		const gchar* _tmp21_;
		_tmp20_ = self->priv->buffer;
		_tmp21_ = cprefix;
		g_string_append_printf (_tmp20_, " c:prefix=\"%s\"", _tmp21_);
	}
	_tmp22_ = self->priv->buffer;
	g_string_append_printf (_tmp22_, ">\n");
	_tmp23_ = self->priv->indent;
	self->priv->indent = _tmp23_ + 1;
	_tmp24_ = self->priv->hierarchy;
	vala_list_insert ((ValaList*) _tmp24_, 0, (ValaSymbol*) ns);
	vala_code_node_accept_children ((ValaCodeNode*) ns, (ValaCodeVisitor*) self);
	_tmp25_ = self->priv->hierarchy;
	_tmp26_ = vala_list_remove_at ((ValaList*) _tmp25_, 0);
	_tmp27_ = (ValaSymbol*) _tmp26_;
	_vala_code_node_unref0 (_tmp27_);
	_tmp28_ = self->priv->indent;
	self->priv->indent = _tmp28_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp29_ = self->priv->buffer;
	g_string_append_printf (_tmp29_, "</namespace>\n");
	_tmp30_ = self->priv->our_namespaces;
	vala_collection_add ((ValaCollection*) _tmp30_, ns);
	vala_gir_writer_visit_deferred (self);
	_g_free0 (cprefix);
}


static void
vala_gir_writer_write_symbol_attributes (ValaGIRWriter* self,
                                         ValaSymbol* symbol)
{
	ValaVersionAttribute* _tmp1_;
	ValaVersionAttribute* _tmp2_;
	gboolean _tmp3_;
	gboolean _tmp4_;
	ValaVersionAttribute* _tmp18_;
	ValaVersionAttribute* _tmp19_;
	gchar* _tmp20_;
	gchar* _tmp21_;
	gchar* _tmp22_;
	gboolean _tmp23_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	if (!vala_gir_writer_is_introspectable (self, symbol)) {
		GString* _tmp0_;
		_tmp0_ = self->priv->buffer;
		g_string_append_printf (_tmp0_, " introspectable=\"0\"");
	}
	_tmp1_ = vala_symbol_get_version (symbol);
	_tmp2_ = _tmp1_;
	_tmp3_ = vala_version_attribute_get_deprecated (_tmp2_);
	_tmp4_ = _tmp3_;
	if (_tmp4_) {
		GString* _tmp5_;
		ValaVersionAttribute* _tmp6_;
		ValaVersionAttribute* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		gchar* _tmp10_;
		gboolean _tmp11_;
		_tmp5_ = self->priv->buffer;
		g_string_append_printf (_tmp5_, " deprecated=\"1\"");
		_tmp6_ = vala_symbol_get_version (symbol);
		_tmp7_ = _tmp6_;
		_tmp8_ = vala_version_attribute_get_deprecated_since (_tmp7_);
		_tmp9_ = _tmp8_;
		_tmp10_ = _tmp9_;
		_tmp11_ = _tmp10_ != NULL;
		_g_free0 (_tmp10_);
		if (_tmp11_) {
			GString* _tmp12_;
			ValaVersionAttribute* _tmp13_;
			ValaVersionAttribute* _tmp14_;
			gchar* _tmp15_;
			gchar* _tmp16_;
			gchar* _tmp17_;
			_tmp12_ = self->priv->buffer;
			_tmp13_ = vala_symbol_get_version (symbol);
			_tmp14_ = _tmp13_;
			_tmp15_ = vala_version_attribute_get_deprecated_since (_tmp14_);
			_tmp16_ = _tmp15_;
			_tmp17_ = _tmp16_;
			g_string_append_printf (_tmp12_, " deprecated-version=\"%s\"", _tmp17_);
			_g_free0 (_tmp17_);
		}
	}
	_tmp18_ = vala_symbol_get_version (symbol);
	_tmp19_ = _tmp18_;
	_tmp20_ = vala_version_attribute_get_since (_tmp19_);
	_tmp21_ = _tmp20_;
	_tmp22_ = _tmp21_;
	_tmp23_ = _tmp22_ != NULL;
	_g_free0 (_tmp22_);
	if (_tmp23_) {
		GString* _tmp24_;
		ValaVersionAttribute* _tmp25_;
		ValaVersionAttribute* _tmp26_;
		gchar* _tmp27_;
		gchar* _tmp28_;
		gchar* _tmp29_;
		_tmp24_ = self->priv->buffer;
		_tmp25_ = vala_symbol_get_version (symbol);
		_tmp26_ = _tmp25_;
		_tmp27_ = vala_version_attribute_get_since (_tmp26_);
		_tmp28_ = _tmp27_;
		_tmp29_ = _tmp28_;
		g_string_append_printf (_tmp24_, " version=\"%s\"", _tmp29_);
		_g_free0 (_tmp29_);
	}
}


static glong
string_strnlen (gchar* str,
                glong maxlen)
{
	glong result = 0L;
	gchar* end = NULL;
	gchar* _tmp0_;
	gchar* _tmp1_;
	_tmp0_ = memchr (str, 0, (gsize) maxlen);
	end = _tmp0_;
	_tmp1_ = end;
	if (_tmp1_ == NULL) {
		result = maxlen;
		return result;
	} else {
		gchar* _tmp2_;
		_tmp2_ = end;
		result = (glong) (_tmp2_ - str);
		return result;
	}
}


static gchar*
string_substring (const gchar* self,
                  glong offset,
                  glong len)
{
	gchar* result = NULL;
	glong string_length = 0L;
	gboolean _tmp0_ = FALSE;
	glong _tmp6_;
	gchar* _tmp7_;
	g_return_val_if_fail (self != NULL, NULL);
	if (offset >= ((glong) 0)) {
		_tmp0_ = len >= ((glong) 0);
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		string_length = string_strnlen ((gchar*) self, offset + len);
	} else {
		gint _tmp1_;
		gint _tmp2_;
		_tmp1_ = strlen (self);
		_tmp2_ = _tmp1_;
		string_length = (glong) _tmp2_;
	}
	if (offset < ((glong) 0)) {
		glong _tmp3_;
		_tmp3_ = string_length;
		offset = _tmp3_ + offset;
		g_return_val_if_fail (offset >= ((glong) 0), NULL);
	} else {
		glong _tmp4_;
		_tmp4_ = string_length;
		g_return_val_if_fail (offset <= _tmp4_, NULL);
	}
	if (len < ((glong) 0)) {
		glong _tmp5_;
		_tmp5_ = string_length;
		len = _tmp5_ - offset;
	}
	_tmp6_ = string_length;
	g_return_val_if_fail ((offset + len) <= _tmp6_, NULL);
	_tmp7_ = g_strndup (((gchar*) self) + offset, (gsize) len);
	result = _tmp7_;
	return result;
}


static void
vala_gir_writer_real_visit_class (ValaCodeVisitor* base,
                                  ValaClass* cl)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	ValaArrayList* _tmp2_;
	gpointer _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean _tmp5_;
	ValaTypeSymbol* _tmp7_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (cl != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) cl);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) cl)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = vala_list_get ((ValaList*) _tmp2_, 0);
	_tmp4_ = (ValaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_NAMESPACE);
	_vala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		ValaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		vala_collection_add ((ValaCollection*) _tmp6_, (ValaCodeNode*) cl);
		return;
	}
	_tmp7_ = self->priv->gobject_type;
	if (vala_typesymbol_is_subtype_of ((ValaTypeSymbol*) cl, _tmp7_)) {
		gchar* gtype_struct_name = NULL;
		gchar* _tmp8_;
		gchar* _tmp9_;
		gchar* _tmp10_;
		gchar* _tmp11_;
		GString* _tmp12_;
		gchar* _tmp13_;
		gchar* _tmp14_;
		GString* _tmp15_;
		const gchar* _tmp16_;
		GString* _tmp17_;
		ValaClass* _tmp18_;
		ValaClass* _tmp19_;
		gchar* _tmp20_;
		gchar* _tmp21_;
		gboolean _tmp22_;
		gboolean _tmp23_;
		GString* _tmp25_;
		gint _tmp26_;
		gchar* _tmp27_;
		gchar* _tmp28_;
		GString* _tmp50_;
		gint _tmp51_;
		GString* _tmp52_;
		ValaClass* _tmp53_;
		ValaClass* _tmp54_;
		gchar* _tmp55_;
		gchar* _tmp56_;
		ValaClass* _tmp57_;
		ValaClass* _tmp58_;
		gchar* _tmp59_;
		gchar* _tmp60_;
		gint _tmp61_;
		GString* _tmp62_;
		GString* _tmp63_;
		gint _tmp64_;
		GString* _tmp65_;
		gchar* _tmp66_;
		gchar* _tmp67_;
		gchar* _tmp68_;
		gchar* _tmp69_;
		gint _tmp70_;
		GString* _tmp71_;
		ValaArrayList* _tmp72_;
		ValaArrayList* _tmp73_;
		gpointer _tmp74_;
		ValaSymbol* _tmp75_;
		gint _tmp76_;
		GString* _tmp77_;
		GString* _tmp78_;
		const gchar* _tmp79_;
		GString* _tmp80_;
		const gchar* _tmp81_;
		const gchar* _tmp82_;
		GString* _tmp83_;
		gint _tmp84_;
		GString* _tmp85_;
		gint _tmp86_;
		GString* _tmp87_;
		ValaClass* _tmp88_;
		ValaClass* _tmp89_;
		gchar* _tmp90_;
		gchar* _tmp91_;
		ValaClass* _tmp92_;
		ValaClass* _tmp93_;
		gchar* _tmp94_;
		gchar* _tmp95_;
		gint _tmp96_;
		GString* _tmp97_;
		gint _tmp216_;
		GString* _tmp217_;
		GString* _tmp218_;
		gchar* _tmp219_;
		gchar* _tmp220_;
		gchar* _tmp221_;
		gchar* _tmp222_;
		_tmp8_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) cl);
		_tmp9_ = _tmp8_;
		_tmp10_ = g_strconcat (_tmp9_, "Class", NULL);
		_tmp11_ = _tmp10_;
		_g_free0 (_tmp9_);
		gtype_struct_name = _tmp11_;
		vala_gir_writer_write_indent (self);
		_tmp12_ = self->priv->buffer;
		_tmp13_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) cl);
		_tmp14_ = _tmp13_;
		g_string_append_printf (_tmp12_, "<class name=\"%s\"", _tmp14_);
		_g_free0 (_tmp14_);
		vala_gir_writer_write_gtype_attributes (self, (ValaTypeSymbol*) cl);
		_tmp15_ = self->priv->buffer;
		_tmp16_ = gtype_struct_name;
		g_string_append_printf (_tmp15_, " glib:type-struct=\"%s\"", _tmp16_);
		_tmp17_ = self->priv->buffer;
		_tmp18_ = vala_class_get_base_class (cl);
		_tmp19_ = _tmp18_;
		_tmp20_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp19_);
		_tmp21_ = _tmp20_;
		g_string_append_printf (_tmp17_, " parent=\"%s\"", _tmp21_);
		_g_free0 (_tmp21_);
		_tmp22_ = vala_class_get_is_abstract (cl);
		_tmp23_ = _tmp22_;
		if (_tmp23_) {
			GString* _tmp24_;
			_tmp24_ = self->priv->buffer;
			g_string_append_printf (_tmp24_, " abstract=\"1\"");
		}
		vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) cl);
		_tmp25_ = self->priv->buffer;
		g_string_append_printf (_tmp25_, ">\n");
		_tmp26_ = self->priv->indent;
		self->priv->indent = _tmp26_ + 1;
		_tmp27_ = vala_gir_writer_get_class_comment (self, cl);
		_tmp28_ = _tmp27_;
		vala_gir_writer_write_doc (self, _tmp28_);
		_g_free0 (_tmp28_);
		{
			ValaList* _base_type_list = NULL;
			ValaList* _tmp29_;
			gint _base_type_size = 0;
			ValaList* _tmp30_;
			gint _tmp31_;
			gint _tmp32_;
			gint _base_type_index = 0;
			_tmp29_ = vala_class_get_base_types (cl);
			_base_type_list = _tmp29_;
			_tmp30_ = _base_type_list;
			_tmp31_ = vala_collection_get_size ((ValaCollection*) _tmp30_);
			_tmp32_ = _tmp31_;
			_base_type_size = _tmp32_;
			_base_type_index = -1;
			while (TRUE) {
				gint _tmp33_;
				gint _tmp34_;
				gint _tmp35_;
				ValaDataType* base_type = NULL;
				ValaList* _tmp36_;
				gint _tmp37_;
				gpointer _tmp38_;
				ValaObjectType* object_type = NULL;
				ValaDataType* _tmp39_;
				ValaObjectType* _tmp40_;
				ValaObjectType* _tmp41_;
				ValaObjectTypeSymbol* _tmp42_;
				ValaObjectTypeSymbol* _tmp43_;
				_tmp33_ = _base_type_index;
				_base_type_index = _tmp33_ + 1;
				_tmp34_ = _base_type_index;
				_tmp35_ = _base_type_size;
				if (!(_tmp34_ < _tmp35_)) {
					break;
				}
				_tmp36_ = _base_type_list;
				_tmp37_ = _base_type_index;
				_tmp38_ = vala_list_get (_tmp36_, _tmp37_);
				base_type = (ValaDataType*) _tmp38_;
				_tmp39_ = base_type;
				_tmp40_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp39_, VALA_TYPE_OBJECT_TYPE, ValaObjectType));
				object_type = _tmp40_;
				_tmp41_ = object_type;
				_tmp42_ = vala_object_type_get_type_symbol (_tmp41_);
				_tmp43_ = _tmp42_;
				if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp43_, VALA_TYPE_INTERFACE)) {
					GString* _tmp44_;
					ValaObjectType* _tmp45_;
					ValaObjectTypeSymbol* _tmp46_;
					ValaObjectTypeSymbol* _tmp47_;
					gchar* _tmp48_;
					gchar* _tmp49_;
					vala_gir_writer_write_indent (self);
					_tmp44_ = self->priv->buffer;
					_tmp45_ = object_type;
					_tmp46_ = vala_object_type_get_type_symbol (_tmp45_);
					_tmp47_ = _tmp46_;
					_tmp48_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp47_);
					_tmp49_ = _tmp48_;
					g_string_append_printf (_tmp44_, "<implements name=\"%s\"/>\n", _tmp49_);
					_g_free0 (_tmp49_);
				}
				_vala_code_node_unref0 (object_type);
				_vala_code_node_unref0 (base_type);
			}
			_vala_iterable_unref0 (_base_type_list);
		}
		vala_gir_writer_write_indent (self);
		_tmp50_ = self->priv->buffer;
		g_string_append_printf (_tmp50_, "<field name=\"parent_instance\">\n");
		_tmp51_ = self->priv->indent;
		self->priv->indent = _tmp51_ + 1;
		vala_gir_writer_write_indent (self);
		_tmp52_ = self->priv->buffer;
		_tmp53_ = vala_class_get_base_class (cl);
		_tmp54_ = _tmp53_;
		_tmp55_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp54_);
		_tmp56_ = _tmp55_;
		_tmp57_ = vala_class_get_base_class (cl);
		_tmp58_ = _tmp57_;
		_tmp59_ = vala_get_ccode_name ((ValaCodeNode*) _tmp58_);
		_tmp60_ = _tmp59_;
		g_string_append_printf (_tmp52_, "<type name=\"%s\" c:type=\"%s\"/>\n", _tmp56_, _tmp60_);
		_g_free0 (_tmp60_);
		_g_free0 (_tmp56_);
		_tmp61_ = self->priv->indent;
		self->priv->indent = _tmp61_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp62_ = self->priv->buffer;
		g_string_append_printf (_tmp62_, "</field>\n");
		vala_gir_writer_write_indent (self);
		_tmp63_ = self->priv->buffer;
		g_string_append_printf (_tmp63_, "<field name=\"priv\">\n");
		_tmp64_ = self->priv->indent;
		self->priv->indent = _tmp64_ + 1;
		vala_gir_writer_write_indent (self);
		_tmp65_ = self->priv->buffer;
		_tmp66_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) cl);
		_tmp67_ = _tmp66_;
		_tmp68_ = vala_get_ccode_name ((ValaCodeNode*) cl);
		_tmp69_ = _tmp68_;
		g_string_append_printf (_tmp65_, "<type name=\"%sPrivate\" c:type=\"%sPrivate*\"/>\n", _tmp67_, _tmp69_);
		_g_free0 (_tmp69_);
		_g_free0 (_tmp67_);
		_tmp70_ = self->priv->indent;
		self->priv->indent = _tmp70_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp71_ = self->priv->buffer;
		g_string_append_printf (_tmp71_, "</field>\n");
		_tmp72_ = self->priv->hierarchy;
		vala_list_insert ((ValaList*) _tmp72_, 0, (ValaSymbol*) cl);
		vala_code_node_accept_children ((ValaCodeNode*) cl, (ValaCodeVisitor*) self);
		_tmp73_ = self->priv->hierarchy;
		_tmp74_ = vala_list_remove_at ((ValaList*) _tmp73_, 0);
		_tmp75_ = (ValaSymbol*) _tmp74_;
		_vala_code_node_unref0 (_tmp75_);
		_tmp76_ = self->priv->indent;
		self->priv->indent = _tmp76_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp77_ = self->priv->buffer;
		g_string_append_printf (_tmp77_, "</class>\n");
		vala_gir_writer_write_indent (self);
		_tmp78_ = self->priv->buffer;
		_tmp79_ = gtype_struct_name;
		g_string_append_printf (_tmp78_, "<record name=\"%s\"", _tmp79_);
		vala_gir_writer_write_ctype_attributes (self, (ValaTypeSymbol*) cl, "Class");
		_tmp80_ = self->priv->buffer;
		_tmp81_ = vala_symbol_get_name ((ValaSymbol*) cl);
		_tmp82_ = _tmp81_;
		g_string_append_printf (_tmp80_, " glib:is-gtype-struct-for=\"%s\"", _tmp82_);
		_tmp83_ = self->priv->buffer;
		g_string_append_printf (_tmp83_, ">\n");
		_tmp84_ = self->priv->indent;
		self->priv->indent = _tmp84_ + 1;
		vala_gir_writer_write_indent (self);
		_tmp85_ = self->priv->buffer;
		g_string_append_printf (_tmp85_, "<field name=\"parent_class\">\n");
		_tmp86_ = self->priv->indent;
		self->priv->indent = _tmp86_ + 1;
		vala_gir_writer_write_indent (self);
		_tmp87_ = self->priv->buffer;
		_tmp88_ = vala_class_get_base_class (cl);
		_tmp89_ = _tmp88_;
		_tmp90_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp89_);
		_tmp91_ = _tmp90_;
		_tmp92_ = vala_class_get_base_class (cl);
		_tmp93_ = _tmp92_;
		_tmp94_ = vala_get_ccode_name ((ValaCodeNode*) _tmp93_);
		_tmp95_ = _tmp94_;
		g_string_append_printf (_tmp87_, "<type name=\"%sClass\" c:type=\"%sClass\"/>\n", _tmp91_, _tmp95_);
		_g_free0 (_tmp95_);
		_g_free0 (_tmp91_);
		_tmp96_ = self->priv->indent;
		self->priv->indent = _tmp96_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp97_ = self->priv->buffer;
		g_string_append_printf (_tmp97_, "</field>\n");
		{
			ValaList* _m_list = NULL;
			ValaList* _tmp98_;
			gint _m_size = 0;
			ValaList* _tmp99_;
			gint _tmp100_;
			gint _tmp101_;
			gint _m_index = 0;
			_tmp98_ = vala_object_type_symbol_get_methods ((ValaObjectTypeSymbol*) cl);
			_m_list = _tmp98_;
			_tmp99_ = _m_list;
			_tmp100_ = vala_collection_get_size ((ValaCollection*) _tmp99_);
			_tmp101_ = _tmp100_;
			_m_size = _tmp101_;
			_m_index = -1;
			while (TRUE) {
				gint _tmp102_;
				gint _tmp103_;
				gint _tmp104_;
				ValaMethod* m = NULL;
				ValaList* _tmp105_;
				gint _tmp106_;
				gpointer _tmp107_;
				gboolean _tmp108_ = FALSE;
				ValaMethod* _tmp109_;
				gboolean _tmp110_;
				gboolean _tmp111_;
				_tmp102_ = _m_index;
				_m_index = _tmp102_ + 1;
				_tmp103_ = _m_index;
				_tmp104_ = _m_size;
				if (!(_tmp103_ < _tmp104_)) {
					break;
				}
				_tmp105_ = _m_list;
				_tmp106_ = _m_index;
				_tmp107_ = vala_list_get (_tmp105_, _tmp106_);
				m = (ValaMethod*) _tmp107_;
				_tmp109_ = m;
				_tmp110_ = vala_method_get_is_abstract (_tmp109_);
				_tmp111_ = _tmp110_;
				if (_tmp111_) {
					_tmp108_ = TRUE;
				} else {
					ValaMethod* _tmp112_;
					gboolean _tmp113_;
					gboolean _tmp114_;
					_tmp112_ = m;
					_tmp113_ = vala_method_get_is_virtual (_tmp112_);
					_tmp114_ = _tmp113_;
					_tmp108_ = _tmp114_;
				}
				if (_tmp108_) {
					ValaMethod* _tmp115_;
					gboolean _tmp116_;
					gboolean _tmp117_;
					_tmp115_ = m;
					_tmp116_ = vala_method_get_coroutine (_tmp115_);
					_tmp117_ = _tmp116_;
					if (_tmp117_) {
						gchar* finish_name = NULL;
						ValaMethod* _tmp118_;
						const gchar* _tmp119_;
						const gchar* _tmp120_;
						gchar* _tmp121_;
						const gchar* _tmp122_;
						const gchar* _tmp130_;
						gchar* _tmp131_;
						GString* _tmp132_;
						ValaMethod* _tmp133_;
						const gchar* _tmp134_;
						const gchar* _tmp135_;
						gint _tmp136_;
						ValaMethod* _tmp137_;
						ValaMethod* _tmp138_;
						const gchar* _tmp139_;
						const gchar* _tmp140_;
						ValaMethod* _tmp141_;
						gchar* _tmp142_;
						gchar* _tmp143_;
						ValaMethod* _tmp144_;
						ValaList* _tmp145_;
						ValaList* _tmp146_;
						ValaVoidType* _tmp147_;
						ValaVoidType* _tmp148_;
						gint _tmp149_;
						GString* _tmp150_;
						GString* _tmp151_;
						const gchar* _tmp152_;
						gint _tmp153_;
						ValaMethod* _tmp154_;
						const gchar* _tmp155_;
						ValaMethod* _tmp156_;
						gchar* _tmp157_;
						gchar* _tmp158_;
						ValaMethod* _tmp159_;
						ValaList* _tmp160_;
						ValaList* _tmp161_;
						ValaMethod* _tmp162_;
						ValaDataType* _tmp163_;
						ValaDataType* _tmp164_;
						ValaMethod* _tmp165_;
						gboolean _tmp166_;
						gboolean _tmp167_;
						gint _tmp168_;
						GString* _tmp169_;
						_tmp118_ = m;
						_tmp119_ = vala_symbol_get_name ((ValaSymbol*) _tmp118_);
						_tmp120_ = _tmp119_;
						_tmp121_ = g_strdup (_tmp120_);
						finish_name = _tmp121_;
						_tmp122_ = finish_name;
						if (g_str_has_suffix (_tmp122_, "_async")) {
							const gchar* _tmp123_;
							const gchar* _tmp124_;
							gint _tmp125_;
							gint _tmp126_;
							gint _tmp127_;
							gint _tmp128_;
							gchar* _tmp129_;
							_tmp123_ = finish_name;
							_tmp124_ = finish_name;
							_tmp125_ = strlen (_tmp124_);
							_tmp126_ = _tmp125_;
							_tmp127_ = strlen ("_async");
							_tmp128_ = _tmp127_;
							_tmp129_ = string_substring (_tmp123_, (glong) 0, (glong) (_tmp126_ - _tmp128_));
							_g_free0 (finish_name);
							finish_name = _tmp129_;
						}
						_tmp130_ = finish_name;
						_tmp131_ = g_strconcat (_tmp130_, "_finish", NULL);
						_g_free0 (finish_name);
						finish_name = _tmp131_;
						vala_gir_writer_write_indent (self);
						_tmp132_ = self->priv->buffer;
						_tmp133_ = m;
						_tmp134_ = vala_symbol_get_name ((ValaSymbol*) _tmp133_);
						_tmp135_ = _tmp134_;
						g_string_append_printf (_tmp132_, "<field name=\"%s\">\n", _tmp135_);
						_tmp136_ = self->priv->indent;
						self->priv->indent = _tmp136_ + 1;
						_tmp137_ = m;
						_tmp138_ = m;
						_tmp139_ = vala_symbol_get_name ((ValaSymbol*) _tmp138_);
						_tmp140_ = _tmp139_;
						_tmp141_ = m;
						_tmp142_ = vala_get_ccode_name ((ValaCodeNode*) _tmp141_);
						_tmp143_ = _tmp142_;
						_tmp144_ = m;
						_tmp145_ = vala_method_get_async_begin_parameters (_tmp144_);
						_tmp146_ = _tmp145_;
						_tmp147_ = vala_void_type_new (NULL);
						_tmp148_ = _tmp147_;
						vala_gir_writer_do_write_signature (self, _tmp137_, "callback", TRUE, _tmp140_, _tmp143_, _tmp146_, (ValaDataType*) _tmp148_, FALSE, FALSE);
						_vala_code_node_unref0 (_tmp148_);
						_vala_iterable_unref0 (_tmp146_);
						_g_free0 (_tmp143_);
						_tmp149_ = self->priv->indent;
						self->priv->indent = _tmp149_ - 1;
						vala_gir_writer_write_indent (self);
						_tmp150_ = self->priv->buffer;
						g_string_append_printf (_tmp150_, "</field>\n");
						vala_gir_writer_write_indent (self);
						_tmp151_ = self->priv->buffer;
						_tmp152_ = finish_name;
						g_string_append_printf (_tmp151_, "<field name=\"%s\">\n", _tmp152_);
						_tmp153_ = self->priv->indent;
						self->priv->indent = _tmp153_ + 1;
						_tmp154_ = m;
						_tmp155_ = finish_name;
						_tmp156_ = m;
						_tmp157_ = vala_get_ccode_finish_name (_tmp156_);
						_tmp158_ = _tmp157_;
						_tmp159_ = m;
						_tmp160_ = vala_method_get_async_end_parameters (_tmp159_);
						_tmp161_ = _tmp160_;
						_tmp162_ = m;
						_tmp163_ = vala_callable_get_return_type ((ValaCallable*) _tmp162_);
						_tmp164_ = _tmp163_;
						_tmp165_ = m;
						_tmp166_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp165_);
						_tmp167_ = _tmp166_;
						vala_gir_writer_do_write_signature (self, _tmp154_, "callback", TRUE, _tmp155_, _tmp158_, _tmp161_, _tmp164_, _tmp167_, FALSE);
						_vala_iterable_unref0 (_tmp161_);
						_g_free0 (_tmp158_);
						_tmp168_ = self->priv->indent;
						self->priv->indent = _tmp168_ - 1;
						vala_gir_writer_write_indent (self);
						_tmp169_ = self->priv->buffer;
						g_string_append_printf (_tmp169_, "</field>\n");
						_g_free0 (finish_name);
					} else {
						GString* _tmp170_;
						ValaMethod* _tmp171_;
						const gchar* _tmp172_;
						const gchar* _tmp173_;
						gint _tmp174_;
						ValaMethod* _tmp175_;
						ValaMethod* _tmp176_;
						const gchar* _tmp177_;
						const gchar* _tmp178_;
						ValaMethod* _tmp179_;
						gchar* _tmp180_;
						gchar* _tmp181_;
						ValaMethod* _tmp182_;
						ValaList* _tmp183_;
						ValaList* _tmp184_;
						ValaMethod* _tmp185_;
						ValaDataType* _tmp186_;
						ValaDataType* _tmp187_;
						ValaMethod* _tmp188_;
						gboolean _tmp189_;
						gboolean _tmp190_;
						gint _tmp191_;
						GString* _tmp192_;
						vala_gir_writer_write_indent (self);
						_tmp170_ = self->priv->buffer;
						_tmp171_ = m;
						_tmp172_ = vala_symbol_get_name ((ValaSymbol*) _tmp171_);
						_tmp173_ = _tmp172_;
						g_string_append_printf (_tmp170_, "<field name=\"%s\">\n", _tmp173_);
						_tmp174_ = self->priv->indent;
						self->priv->indent = _tmp174_ + 1;
						_tmp175_ = m;
						_tmp176_ = m;
						_tmp177_ = vala_symbol_get_name ((ValaSymbol*) _tmp176_);
						_tmp178_ = _tmp177_;
						_tmp179_ = m;
						_tmp180_ = vala_get_ccode_name ((ValaCodeNode*) _tmp179_);
						_tmp181_ = _tmp180_;
						_tmp182_ = m;
						_tmp183_ = vala_callable_get_parameters ((ValaCallable*) _tmp182_);
						_tmp184_ = _tmp183_;
						_tmp185_ = m;
						_tmp186_ = vala_callable_get_return_type ((ValaCallable*) _tmp185_);
						_tmp187_ = _tmp186_;
						_tmp188_ = m;
						_tmp189_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp188_);
						_tmp190_ = _tmp189_;
						vala_gir_writer_do_write_signature (self, _tmp175_, "callback", TRUE, _tmp178_, _tmp181_, _tmp184_, _tmp187_, _tmp190_, FALSE);
						_vala_iterable_unref0 (_tmp184_);
						_g_free0 (_tmp181_);
						_tmp191_ = self->priv->indent;
						self->priv->indent = _tmp191_ - 1;
						vala_gir_writer_write_indent (self);
						_tmp192_ = self->priv->buffer;
						g_string_append_printf (_tmp192_, "</field>\n");
					}
				}
				_vala_code_node_unref0 (m);
			}
			_vala_iterable_unref0 (_m_list);
		}
		{
			ValaList* _sig_list = NULL;
			ValaList* _tmp193_;
			gint _sig_size = 0;
			ValaList* _tmp194_;
			gint _tmp195_;
			gint _tmp196_;
			gint _sig_index = 0;
			_tmp193_ = vala_object_type_symbol_get_signals ((ValaObjectTypeSymbol*) cl);
			_sig_list = _tmp193_;
			_tmp194_ = _sig_list;
			_tmp195_ = vala_collection_get_size ((ValaCollection*) _tmp194_);
			_tmp196_ = _tmp195_;
			_sig_size = _tmp196_;
			_sig_index = -1;
			while (TRUE) {
				gint _tmp197_;
				gint _tmp198_;
				gint _tmp199_;
				ValaSignal* sig = NULL;
				ValaList* _tmp200_;
				gint _tmp201_;
				gpointer _tmp202_;
				ValaSignal* _tmp203_;
				ValaMethod* _tmp204_;
				ValaMethod* _tmp205_;
				_tmp197_ = _sig_index;
				_sig_index = _tmp197_ + 1;
				_tmp198_ = _sig_index;
				_tmp199_ = _sig_size;
				if (!(_tmp198_ < _tmp199_)) {
					break;
				}
				_tmp200_ = _sig_list;
				_tmp201_ = _sig_index;
				_tmp202_ = vala_list_get (_tmp200_, _tmp201_);
				sig = (ValaSignal*) _tmp202_;
				_tmp203_ = sig;
				_tmp204_ = vala_signal_get_default_handler (_tmp203_);
				_tmp205_ = _tmp204_;
				if (_tmp205_ != NULL) {
					GString* _tmp206_;
					ValaSignal* _tmp207_;
					gchar* _tmp208_;
					gchar* _tmp209_;
					gint _tmp210_;
					ValaSignal* _tmp211_;
					ValaMethod* _tmp212_;
					ValaMethod* _tmp213_;
					gint _tmp214_;
					GString* _tmp215_;
					vala_gir_writer_write_indent (self);
					_tmp206_ = self->priv->buffer;
					_tmp207_ = sig;
					_tmp208_ = vala_get_ccode_lower_case_name ((ValaCodeNode*) _tmp207_, NULL);
					_tmp209_ = _tmp208_;
					g_string_append_printf (_tmp206_, "<field name=\"%s\">\n", _tmp209_);
					_g_free0 (_tmp209_);
					_tmp210_ = self->priv->indent;
					self->priv->indent = _tmp210_ + 1;
					_tmp211_ = sig;
					_tmp212_ = vala_signal_get_default_handler (_tmp211_);
					_tmp213_ = _tmp212_;
					vala_gir_writer_write_signature (self, _tmp213_, "callback", FALSE, TRUE);
					_tmp214_ = self->priv->indent;
					self->priv->indent = _tmp214_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp215_ = self->priv->buffer;
					g_string_append_printf (_tmp215_, "</field>\n");
				}
				_vala_code_node_unref0 (sig);
			}
			_vala_iterable_unref0 (_sig_list);
		}
		_tmp216_ = self->priv->indent;
		self->priv->indent = _tmp216_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp217_ = self->priv->buffer;
		g_string_append_printf (_tmp217_, "</record>\n");
		vala_gir_writer_write_indent (self);
		_tmp218_ = self->priv->buffer;
		_tmp219_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) cl);
		_tmp220_ = _tmp219_;
		_tmp221_ = vala_get_ccode_name ((ValaCodeNode*) cl);
		_tmp222_ = _tmp221_;
		g_string_append_printf (_tmp218_, "<record name=\"%sPrivate\" c:type=\"%sPrivate\" disguised=\"1\"/>\n", _tmp220_, _tmp222_);
		_g_free0 (_tmp222_);
		_g_free0 (_tmp220_);
		_g_free0 (gtype_struct_name);
	} else {
		GString* _tmp223_;
		gchar* _tmp224_;
		gchar* _tmp225_;
		GString* _tmp226_;
		gint _tmp227_;
		gchar* _tmp228_;
		gchar* _tmp229_;
		ValaArrayList* _tmp230_;
		ValaArrayList* _tmp231_;
		gpointer _tmp232_;
		ValaSymbol* _tmp233_;
		gint _tmp234_;
		GString* _tmp235_;
		vala_gir_writer_write_indent (self);
		_tmp223_ = self->priv->buffer;
		_tmp224_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) cl);
		_tmp225_ = _tmp224_;
		g_string_append_printf (_tmp223_, "<record name=\"%s\"", _tmp225_);
		_g_free0 (_tmp225_);
		vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) cl);
		_tmp226_ = self->priv->buffer;
		g_string_append_printf (_tmp226_, ">\n");
		_tmp227_ = self->priv->indent;
		self->priv->indent = _tmp227_ + 1;
		_tmp228_ = vala_gir_writer_get_class_comment (self, cl);
		_tmp229_ = _tmp228_;
		vala_gir_writer_write_doc (self, _tmp229_);
		_g_free0 (_tmp229_);
		_tmp230_ = self->priv->hierarchy;
		vala_list_insert ((ValaList*) _tmp230_, 0, (ValaSymbol*) cl);
		vala_code_node_accept_children ((ValaCodeNode*) cl, (ValaCodeVisitor*) self);
		_tmp231_ = self->priv->hierarchy;
		_tmp232_ = vala_list_remove_at ((ValaList*) _tmp231_, 0);
		_tmp233_ = (ValaSymbol*) _tmp232_;
		_vala_code_node_unref0 (_tmp233_);
		_tmp234_ = self->priv->indent;
		self->priv->indent = _tmp234_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp235_ = self->priv->buffer;
		g_string_append_printf (_tmp235_, "</record>\n");
	}
	vala_gir_writer_visit_deferred (self);
}


static void
vala_gir_writer_real_visit_struct (ValaCodeVisitor* base,
                                   ValaStruct* st)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	ValaArrayList* _tmp2_;
	gpointer _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean _tmp5_;
	GString* _tmp7_;
	gchar* _tmp8_;
	gchar* _tmp9_;
	GString* _tmp10_;
	gint _tmp11_;
	gchar* _tmp12_;
	gchar* _tmp13_;
	ValaArrayList* _tmp14_;
	ValaArrayList* _tmp15_;
	gpointer _tmp16_;
	ValaSymbol* _tmp17_;
	gint _tmp18_;
	GString* _tmp19_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (st != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) st);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) st)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = vala_list_get ((ValaList*) _tmp2_, 0);
	_tmp4_ = (ValaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_NAMESPACE);
	_vala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		ValaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		vala_collection_add ((ValaCollection*) _tmp6_, (ValaCodeNode*) st);
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp7_ = self->priv->buffer;
	_tmp8_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) st);
	_tmp9_ = _tmp8_;
	g_string_append_printf (_tmp7_, "<record name=\"%s\"", _tmp9_);
	_g_free0 (_tmp9_);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) st);
	_tmp10_ = self->priv->buffer;
	g_string_append_printf (_tmp10_, ">\n");
	_tmp11_ = self->priv->indent;
	self->priv->indent = _tmp11_ + 1;
	_tmp12_ = vala_gir_writer_get_struct_comment (self, st);
	_tmp13_ = _tmp12_;
	vala_gir_writer_write_doc (self, _tmp13_);
	_g_free0 (_tmp13_);
	_tmp14_ = self->priv->hierarchy;
	vala_list_insert ((ValaList*) _tmp14_, 0, (ValaSymbol*) st);
	vala_code_node_accept_children ((ValaCodeNode*) st, (ValaCodeVisitor*) self);
	_tmp15_ = self->priv->hierarchy;
	_tmp16_ = vala_list_remove_at ((ValaList*) _tmp15_, 0);
	_tmp17_ = (ValaSymbol*) _tmp16_;
	_vala_code_node_unref0 (_tmp17_);
	_tmp18_ = self->priv->indent;
	self->priv->indent = _tmp18_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp19_ = self->priv->buffer;
	g_string_append_printf (_tmp19_, "</record>\n");
	vala_gir_writer_visit_deferred (self);
}


static void
vala_gir_writer_real_visit_interface (ValaCodeVisitor* base,
                                      ValaInterface* iface)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	ValaArrayList* _tmp2_;
	gpointer _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean _tmp5_;
	gchar* gtype_struct_name = NULL;
	const gchar* _tmp7_;
	const gchar* _tmp8_;
	gchar* _tmp9_;
	GString* _tmp10_;
	gchar* _tmp11_;
	gchar* _tmp12_;
	GString* _tmp13_;
	const gchar* _tmp14_;
	GString* _tmp15_;
	gint _tmp16_;
	gchar* _tmp17_;
	gchar* _tmp18_;
	ValaList* _tmp19_;
	ValaList* _tmp20_;
	gint _tmp21_;
	gint _tmp22_;
	gboolean _tmp23_;
	ValaArrayList* _tmp40_;
	ValaArrayList* _tmp41_;
	gpointer _tmp42_;
	ValaSymbol* _tmp43_;
	gint _tmp44_;
	GString* _tmp45_;
	GString* _tmp46_;
	const gchar* _tmp47_;
	GString* _tmp48_;
	const gchar* _tmp49_;
	const gchar* _tmp50_;
	GString* _tmp51_;
	gint _tmp52_;
	GString* _tmp53_;
	gint _tmp54_;
	GString* _tmp55_;
	gint _tmp56_;
	GString* _tmp57_;
	gint _tmp236_;
	GString* _tmp237_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (iface != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) iface);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) iface)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = vala_list_get ((ValaList*) _tmp2_, 0);
	_tmp4_ = (ValaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_NAMESPACE);
	_vala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		ValaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		vala_collection_add ((ValaCollection*) _tmp6_, (ValaCodeNode*) iface);
		return;
	}
	_tmp7_ = vala_symbol_get_name ((ValaSymbol*) iface);
	_tmp8_ = _tmp7_;
	_tmp9_ = g_strconcat (_tmp8_, "Iface", NULL);
	gtype_struct_name = _tmp9_;
	vala_gir_writer_write_indent (self);
	_tmp10_ = self->priv->buffer;
	_tmp11_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) iface);
	_tmp12_ = _tmp11_;
	g_string_append_printf (_tmp10_, "<interface name=\"%s\"", _tmp12_);
	_g_free0 (_tmp12_);
	vala_gir_writer_write_gtype_attributes (self, (ValaTypeSymbol*) iface);
	_tmp13_ = self->priv->buffer;
	_tmp14_ = gtype_struct_name;
	g_string_append_printf (_tmp13_, " glib:type-struct=\"%s\"", _tmp14_);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) iface);
	_tmp15_ = self->priv->buffer;
	g_string_append_printf (_tmp15_, ">\n");
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ + 1;
	_tmp17_ = vala_gir_writer_get_interface_comment (self, iface);
	_tmp18_ = _tmp17_;
	vala_gir_writer_write_doc (self, _tmp18_);
	_g_free0 (_tmp18_);
	_tmp19_ = vala_interface_get_prerequisites (iface);
	_tmp20_ = _tmp19_;
	_tmp21_ = vala_collection_get_size ((ValaCollection*) _tmp20_);
	_tmp22_ = _tmp21_;
	_tmp23_ = _tmp22_ > 0;
	_vala_iterable_unref0 (_tmp20_);
	if (_tmp23_) {
		{
			ValaList* _base_type_list = NULL;
			ValaList* _tmp24_;
			gint _base_type_size = 0;
			ValaList* _tmp25_;
			gint _tmp26_;
			gint _tmp27_;
			gint _base_type_index = 0;
			_tmp24_ = vala_interface_get_prerequisites (iface);
			_base_type_list = _tmp24_;
			_tmp25_ = _base_type_list;
			_tmp26_ = vala_collection_get_size ((ValaCollection*) _tmp25_);
			_tmp27_ = _tmp26_;
			_base_type_size = _tmp27_;
			_base_type_index = -1;
			while (TRUE) {
				gint _tmp28_;
				gint _tmp29_;
				gint _tmp30_;
				ValaDataType* base_type = NULL;
				ValaList* _tmp31_;
				gint _tmp32_;
				gpointer _tmp33_;
				GString* _tmp34_;
				ValaDataType* _tmp35_;
				ValaObjectTypeSymbol* _tmp36_;
				ValaObjectTypeSymbol* _tmp37_;
				gchar* _tmp38_;
				gchar* _tmp39_;
				_tmp28_ = _base_type_index;
				_base_type_index = _tmp28_ + 1;
				_tmp29_ = _base_type_index;
				_tmp30_ = _base_type_size;
				if (!(_tmp29_ < _tmp30_)) {
					break;
				}
				_tmp31_ = _base_type_list;
				_tmp32_ = _base_type_index;
				_tmp33_ = vala_list_get (_tmp31_, _tmp32_);
				base_type = (ValaDataType*) _tmp33_;
				vala_gir_writer_write_indent (self);
				_tmp34_ = self->priv->buffer;
				_tmp35_ = base_type;
				_tmp36_ = vala_object_type_get_type_symbol (G_TYPE_CHECK_INSTANCE_CAST (_tmp35_, VALA_TYPE_OBJECT_TYPE, ValaObjectType));
				_tmp37_ = _tmp36_;
				_tmp38_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp37_);
				_tmp39_ = _tmp38_;
				g_string_append_printf (_tmp34_, "<prerequisite name=\"%s\"/>\n", _tmp39_);
				_g_free0 (_tmp39_);
				_vala_code_node_unref0 (base_type);
			}
			_vala_iterable_unref0 (_base_type_list);
		}
	}
	_tmp40_ = self->priv->hierarchy;
	vala_list_insert ((ValaList*) _tmp40_, 0, (ValaSymbol*) iface);
	vala_code_node_accept_children ((ValaCodeNode*) iface, (ValaCodeVisitor*) self);
	_tmp41_ = self->priv->hierarchy;
	_tmp42_ = vala_list_remove_at ((ValaList*) _tmp41_, 0);
	_tmp43_ = (ValaSymbol*) _tmp42_;
	_vala_code_node_unref0 (_tmp43_);
	_tmp44_ = self->priv->indent;
	self->priv->indent = _tmp44_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp45_ = self->priv->buffer;
	g_string_append_printf (_tmp45_, "</interface>\n");
	vala_gir_writer_write_indent (self);
	_tmp46_ = self->priv->buffer;
	_tmp47_ = gtype_struct_name;
	g_string_append_printf (_tmp46_, "<record name=\"%s\"", _tmp47_);
	vala_gir_writer_write_ctype_attributes (self, (ValaTypeSymbol*) iface, "Iface");
	_tmp48_ = self->priv->buffer;
	_tmp49_ = vala_symbol_get_name ((ValaSymbol*) iface);
	_tmp50_ = _tmp49_;
	g_string_append_printf (_tmp48_, " glib:is-gtype-struct-for=\"%s\"", _tmp50_);
	_tmp51_ = self->priv->buffer;
	g_string_append_printf (_tmp51_, ">\n");
	_tmp52_ = self->priv->indent;
	self->priv->indent = _tmp52_ + 1;
	vala_gir_writer_write_indent (self);
	_tmp53_ = self->priv->buffer;
	g_string_append_printf (_tmp53_, "<field name=\"parent_iface\">\n");
	_tmp54_ = self->priv->indent;
	self->priv->indent = _tmp54_ + 1;
	vala_gir_writer_write_indent (self);
	_tmp55_ = self->priv->buffer;
	g_string_append_printf (_tmp55_, "<type name=\"GObject.TypeInterface\" c:type=\"GTypeInterface\"/>\n");
	_tmp56_ = self->priv->indent;
	self->priv->indent = _tmp56_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp57_ = self->priv->buffer;
	g_string_append_printf (_tmp57_, "</field>\n");
	{
		ValaList* _m_list = NULL;
		ValaList* _tmp58_;
		gint _m_size = 0;
		ValaList* _tmp59_;
		gint _tmp60_;
		gint _tmp61_;
		gint _m_index = 0;
		_tmp58_ = vala_object_type_symbol_get_methods ((ValaObjectTypeSymbol*) iface);
		_m_list = _tmp58_;
		_tmp59_ = _m_list;
		_tmp60_ = vala_collection_get_size ((ValaCollection*) _tmp59_);
		_tmp61_ = _tmp60_;
		_m_size = _tmp61_;
		_m_index = -1;
		while (TRUE) {
			gint _tmp62_;
			gint _tmp63_;
			gint _tmp64_;
			ValaMethod* m = NULL;
			ValaList* _tmp65_;
			gint _tmp66_;
			gpointer _tmp67_;
			gboolean _tmp68_ = FALSE;
			ValaMethod* _tmp69_;
			gboolean _tmp70_;
			gboolean _tmp71_;
			_tmp62_ = _m_index;
			_m_index = _tmp62_ + 1;
			_tmp63_ = _m_index;
			_tmp64_ = _m_size;
			if (!(_tmp63_ < _tmp64_)) {
				break;
			}
			_tmp65_ = _m_list;
			_tmp66_ = _m_index;
			_tmp67_ = vala_list_get (_tmp65_, _tmp66_);
			m = (ValaMethod*) _tmp67_;
			_tmp69_ = m;
			_tmp70_ = vala_method_get_is_abstract (_tmp69_);
			_tmp71_ = _tmp70_;
			if (_tmp71_) {
				_tmp68_ = TRUE;
			} else {
				ValaMethod* _tmp72_;
				gboolean _tmp73_;
				gboolean _tmp74_;
				_tmp72_ = m;
				_tmp73_ = vala_method_get_is_virtual (_tmp72_);
				_tmp74_ = _tmp73_;
				_tmp68_ = _tmp74_;
			}
			if (_tmp68_) {
				ValaMethod* _tmp75_;
				gboolean _tmp76_;
				gboolean _tmp77_;
				_tmp75_ = m;
				_tmp76_ = vala_method_get_coroutine (_tmp75_);
				_tmp77_ = _tmp76_;
				if (_tmp77_) {
					gchar* finish_name = NULL;
					ValaMethod* _tmp78_;
					const gchar* _tmp79_;
					const gchar* _tmp80_;
					gchar* _tmp81_;
					const gchar* _tmp82_;
					const gchar* _tmp90_;
					gchar* _tmp91_;
					GString* _tmp92_;
					ValaMethod* _tmp93_;
					const gchar* _tmp94_;
					const gchar* _tmp95_;
					gint _tmp96_;
					ValaMethod* _tmp97_;
					ValaMethod* _tmp98_;
					const gchar* _tmp99_;
					const gchar* _tmp100_;
					ValaMethod* _tmp101_;
					gchar* _tmp102_;
					gchar* _tmp103_;
					ValaMethod* _tmp104_;
					ValaList* _tmp105_;
					ValaList* _tmp106_;
					ValaVoidType* _tmp107_;
					ValaVoidType* _tmp108_;
					gint _tmp109_;
					GString* _tmp110_;
					GString* _tmp111_;
					const gchar* _tmp112_;
					gint _tmp113_;
					ValaMethod* _tmp114_;
					const gchar* _tmp115_;
					ValaMethod* _tmp116_;
					gchar* _tmp117_;
					gchar* _tmp118_;
					ValaMethod* _tmp119_;
					ValaList* _tmp120_;
					ValaList* _tmp121_;
					ValaMethod* _tmp122_;
					ValaDataType* _tmp123_;
					ValaDataType* _tmp124_;
					ValaMethod* _tmp125_;
					gboolean _tmp126_;
					gboolean _tmp127_;
					gint _tmp128_;
					GString* _tmp129_;
					_tmp78_ = m;
					_tmp79_ = vala_symbol_get_name ((ValaSymbol*) _tmp78_);
					_tmp80_ = _tmp79_;
					_tmp81_ = g_strdup (_tmp80_);
					finish_name = _tmp81_;
					_tmp82_ = finish_name;
					if (g_str_has_suffix (_tmp82_, "_async")) {
						const gchar* _tmp83_;
						const gchar* _tmp84_;
						gint _tmp85_;
						gint _tmp86_;
						gint _tmp87_;
						gint _tmp88_;
						gchar* _tmp89_;
						_tmp83_ = finish_name;
						_tmp84_ = finish_name;
						_tmp85_ = strlen (_tmp84_);
						_tmp86_ = _tmp85_;
						_tmp87_ = strlen ("_async");
						_tmp88_ = _tmp87_;
						_tmp89_ = string_substring (_tmp83_, (glong) 0, (glong) (_tmp86_ - _tmp88_));
						_g_free0 (finish_name);
						finish_name = _tmp89_;
					}
					_tmp90_ = finish_name;
					_tmp91_ = g_strconcat (_tmp90_, "_finish", NULL);
					_g_free0 (finish_name);
					finish_name = _tmp91_;
					vala_gir_writer_write_indent (self);
					_tmp92_ = self->priv->buffer;
					_tmp93_ = m;
					_tmp94_ = vala_symbol_get_name ((ValaSymbol*) _tmp93_);
					_tmp95_ = _tmp94_;
					g_string_append_printf (_tmp92_, "<field name=\"%s\">\n", _tmp95_);
					_tmp96_ = self->priv->indent;
					self->priv->indent = _tmp96_ + 1;
					_tmp97_ = m;
					_tmp98_ = m;
					_tmp99_ = vala_symbol_get_name ((ValaSymbol*) _tmp98_);
					_tmp100_ = _tmp99_;
					_tmp101_ = m;
					_tmp102_ = vala_get_ccode_name ((ValaCodeNode*) _tmp101_);
					_tmp103_ = _tmp102_;
					_tmp104_ = m;
					_tmp105_ = vala_method_get_async_begin_parameters (_tmp104_);
					_tmp106_ = _tmp105_;
					_tmp107_ = vala_void_type_new (NULL);
					_tmp108_ = _tmp107_;
					vala_gir_writer_do_write_signature (self, _tmp97_, "callback", TRUE, _tmp100_, _tmp103_, _tmp106_, (ValaDataType*) _tmp108_, FALSE, FALSE);
					_vala_code_node_unref0 (_tmp108_);
					_vala_iterable_unref0 (_tmp106_);
					_g_free0 (_tmp103_);
					_tmp109_ = self->priv->indent;
					self->priv->indent = _tmp109_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp110_ = self->priv->buffer;
					g_string_append_printf (_tmp110_, "</field>\n");
					vala_gir_writer_write_indent (self);
					_tmp111_ = self->priv->buffer;
					_tmp112_ = finish_name;
					g_string_append_printf (_tmp111_, "<field name=\"%s\">\n", _tmp112_);
					_tmp113_ = self->priv->indent;
					self->priv->indent = _tmp113_ + 1;
					_tmp114_ = m;
					_tmp115_ = finish_name;
					_tmp116_ = m;
					_tmp117_ = vala_get_ccode_finish_name (_tmp116_);
					_tmp118_ = _tmp117_;
					_tmp119_ = m;
					_tmp120_ = vala_method_get_async_end_parameters (_tmp119_);
					_tmp121_ = _tmp120_;
					_tmp122_ = m;
					_tmp123_ = vala_callable_get_return_type ((ValaCallable*) _tmp122_);
					_tmp124_ = _tmp123_;
					_tmp125_ = m;
					_tmp126_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp125_);
					_tmp127_ = _tmp126_;
					vala_gir_writer_do_write_signature (self, _tmp114_, "callback", TRUE, _tmp115_, _tmp118_, _tmp121_, _tmp124_, _tmp127_, FALSE);
					_vala_iterable_unref0 (_tmp121_);
					_g_free0 (_tmp118_);
					_tmp128_ = self->priv->indent;
					self->priv->indent = _tmp128_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp129_ = self->priv->buffer;
					g_string_append_printf (_tmp129_, "</field>\n");
					_g_free0 (finish_name);
				} else {
					GString* _tmp130_;
					ValaMethod* _tmp131_;
					const gchar* _tmp132_;
					const gchar* _tmp133_;
					gint _tmp134_;
					ValaMethod* _tmp135_;
					ValaMethod* _tmp136_;
					const gchar* _tmp137_;
					const gchar* _tmp138_;
					ValaMethod* _tmp139_;
					gchar* _tmp140_;
					gchar* _tmp141_;
					ValaMethod* _tmp142_;
					ValaList* _tmp143_;
					ValaList* _tmp144_;
					ValaMethod* _tmp145_;
					ValaDataType* _tmp146_;
					ValaDataType* _tmp147_;
					ValaMethod* _tmp148_;
					gboolean _tmp149_;
					gboolean _tmp150_;
					gint _tmp151_;
					GString* _tmp152_;
					vala_gir_writer_write_indent (self);
					_tmp130_ = self->priv->buffer;
					_tmp131_ = m;
					_tmp132_ = vala_symbol_get_name ((ValaSymbol*) _tmp131_);
					_tmp133_ = _tmp132_;
					g_string_append_printf (_tmp130_, "<field name=\"%s\">\n", _tmp133_);
					_tmp134_ = self->priv->indent;
					self->priv->indent = _tmp134_ + 1;
					_tmp135_ = m;
					_tmp136_ = m;
					_tmp137_ = vala_symbol_get_name ((ValaSymbol*) _tmp136_);
					_tmp138_ = _tmp137_;
					_tmp139_ = m;
					_tmp140_ = vala_get_ccode_name ((ValaCodeNode*) _tmp139_);
					_tmp141_ = _tmp140_;
					_tmp142_ = m;
					_tmp143_ = vala_callable_get_parameters ((ValaCallable*) _tmp142_);
					_tmp144_ = _tmp143_;
					_tmp145_ = m;
					_tmp146_ = vala_callable_get_return_type ((ValaCallable*) _tmp145_);
					_tmp147_ = _tmp146_;
					_tmp148_ = m;
					_tmp149_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp148_);
					_tmp150_ = _tmp149_;
					vala_gir_writer_do_write_signature (self, _tmp135_, "callback", TRUE, _tmp138_, _tmp141_, _tmp144_, _tmp147_, _tmp150_, FALSE);
					_vala_iterable_unref0 (_tmp144_);
					_g_free0 (_tmp141_);
					_tmp151_ = self->priv->indent;
					self->priv->indent = _tmp151_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp152_ = self->priv->buffer;
					g_string_append_printf (_tmp152_, "</field>\n");
				}
			}
			_vala_code_node_unref0 (m);
		}
		_vala_iterable_unref0 (_m_list);
	}
	{
		ValaList* _prop_list = NULL;
		ValaList* _tmp153_;
		gint _prop_size = 0;
		ValaList* _tmp154_;
		gint _tmp155_;
		gint _tmp156_;
		gint _prop_index = 0;
		_tmp153_ = vala_object_type_symbol_get_properties ((ValaObjectTypeSymbol*) iface);
		_prop_list = _tmp153_;
		_tmp154_ = _prop_list;
		_tmp155_ = vala_collection_get_size ((ValaCollection*) _tmp154_);
		_tmp156_ = _tmp155_;
		_prop_size = _tmp156_;
		_prop_index = -1;
		while (TRUE) {
			gint _tmp157_;
			gint _tmp158_;
			gint _tmp159_;
			ValaProperty* prop = NULL;
			ValaList* _tmp160_;
			gint _tmp161_;
			gpointer _tmp162_;
			gboolean _tmp163_ = FALSE;
			ValaProperty* _tmp164_;
			gboolean _tmp165_;
			gboolean _tmp166_;
			_tmp157_ = _prop_index;
			_prop_index = _tmp157_ + 1;
			_tmp158_ = _prop_index;
			_tmp159_ = _prop_size;
			if (!(_tmp158_ < _tmp159_)) {
				break;
			}
			_tmp160_ = _prop_list;
			_tmp161_ = _prop_index;
			_tmp162_ = vala_list_get (_tmp160_, _tmp161_);
			prop = (ValaProperty*) _tmp162_;
			_tmp164_ = prop;
			_tmp165_ = vala_property_get_is_abstract (_tmp164_);
			_tmp166_ = _tmp165_;
			if (_tmp166_) {
				_tmp163_ = TRUE;
			} else {
				ValaProperty* _tmp167_;
				gboolean _tmp168_;
				gboolean _tmp169_;
				_tmp167_ = prop;
				_tmp168_ = vala_property_get_is_virtual (_tmp167_);
				_tmp169_ = _tmp168_;
				_tmp163_ = _tmp169_;
			}
			if (_tmp163_) {
				ValaProperty* _tmp170_;
				ValaPropertyAccessor* _tmp171_;
				ValaPropertyAccessor* _tmp172_;
				gboolean _tmp200_ = FALSE;
				ValaProperty* _tmp201_;
				ValaPropertyAccessor* _tmp202_;
				ValaPropertyAccessor* _tmp203_;
				_tmp170_ = prop;
				_tmp171_ = vala_property_get_get_accessor (_tmp170_);
				_tmp172_ = _tmp171_;
				if (_tmp172_ != NULL) {
					ValaMethod* m = NULL;
					ValaProperty* _tmp173_;
					ValaPropertyAccessor* _tmp174_;
					ValaPropertyAccessor* _tmp175_;
					ValaMethod* _tmp176_;
					GString* _tmp177_;
					ValaMethod* _tmp178_;
					const gchar* _tmp179_;
					const gchar* _tmp180_;
					gint _tmp181_;
					ValaMethod* _tmp182_;
					ValaMethod* _tmp183_;
					const gchar* _tmp184_;
					const gchar* _tmp185_;
					ValaMethod* _tmp186_;
					gchar* _tmp187_;
					gchar* _tmp188_;
					ValaMethod* _tmp189_;
					ValaList* _tmp190_;
					ValaList* _tmp191_;
					ValaMethod* _tmp192_;
					ValaDataType* _tmp193_;
					ValaDataType* _tmp194_;
					ValaMethod* _tmp195_;
					gboolean _tmp196_;
					gboolean _tmp197_;
					gint _tmp198_;
					GString* _tmp199_;
					_tmp173_ = prop;
					_tmp174_ = vala_property_get_get_accessor (_tmp173_);
					_tmp175_ = _tmp174_;
					_tmp176_ = vala_property_accessor_get_method (_tmp175_);
					m = _tmp176_;
					vala_gir_writer_write_indent (self);
					_tmp177_ = self->priv->buffer;
					_tmp178_ = m;
					_tmp179_ = vala_symbol_get_name ((ValaSymbol*) _tmp178_);
					_tmp180_ = _tmp179_;
					g_string_append_printf (_tmp177_, "<field name=\"%s\">\n", _tmp180_);
					_tmp181_ = self->priv->indent;
					self->priv->indent = _tmp181_ + 1;
					_tmp182_ = m;
					_tmp183_ = m;
					_tmp184_ = vala_symbol_get_name ((ValaSymbol*) _tmp183_);
					_tmp185_ = _tmp184_;
					_tmp186_ = m;
					_tmp187_ = vala_get_ccode_name ((ValaCodeNode*) _tmp186_);
					_tmp188_ = _tmp187_;
					_tmp189_ = m;
					_tmp190_ = vala_callable_get_parameters ((ValaCallable*) _tmp189_);
					_tmp191_ = _tmp190_;
					_tmp192_ = m;
					_tmp193_ = vala_callable_get_return_type ((ValaCallable*) _tmp192_);
					_tmp194_ = _tmp193_;
					_tmp195_ = m;
					_tmp196_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp195_);
					_tmp197_ = _tmp196_;
					vala_gir_writer_do_write_signature (self, _tmp182_, "callback", TRUE, _tmp185_, _tmp188_, _tmp191_, _tmp194_, _tmp197_, FALSE);
					_vala_iterable_unref0 (_tmp191_);
					_g_free0 (_tmp188_);
					_tmp198_ = self->priv->indent;
					self->priv->indent = _tmp198_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp199_ = self->priv->buffer;
					g_string_append_printf (_tmp199_, "</field>\n");
					_vala_code_node_unref0 (m);
				}
				_tmp201_ = prop;
				_tmp202_ = vala_property_get_set_accessor (_tmp201_);
				_tmp203_ = _tmp202_;
				if (_tmp203_ != NULL) {
					ValaProperty* _tmp204_;
					ValaPropertyAccessor* _tmp205_;
					ValaPropertyAccessor* _tmp206_;
					gboolean _tmp207_;
					gboolean _tmp208_;
					_tmp204_ = prop;
					_tmp205_ = vala_property_get_set_accessor (_tmp204_);
					_tmp206_ = _tmp205_;
					_tmp207_ = vala_property_accessor_get_writable (_tmp206_);
					_tmp208_ = _tmp207_;
					_tmp200_ = _tmp208_;
				} else {
					_tmp200_ = FALSE;
				}
				if (_tmp200_) {
					ValaMethod* m = NULL;
					ValaProperty* _tmp209_;
					ValaPropertyAccessor* _tmp210_;
					ValaPropertyAccessor* _tmp211_;
					ValaMethod* _tmp212_;
					GString* _tmp213_;
					ValaMethod* _tmp214_;
					const gchar* _tmp215_;
					const gchar* _tmp216_;
					gint _tmp217_;
					ValaMethod* _tmp218_;
					ValaMethod* _tmp219_;
					const gchar* _tmp220_;
					const gchar* _tmp221_;
					ValaMethod* _tmp222_;
					gchar* _tmp223_;
					gchar* _tmp224_;
					ValaMethod* _tmp225_;
					ValaList* _tmp226_;
					ValaList* _tmp227_;
					ValaMethod* _tmp228_;
					ValaDataType* _tmp229_;
					ValaDataType* _tmp230_;
					ValaMethod* _tmp231_;
					gboolean _tmp232_;
					gboolean _tmp233_;
					gint _tmp234_;
					GString* _tmp235_;
					_tmp209_ = prop;
					_tmp210_ = vala_property_get_set_accessor (_tmp209_);
					_tmp211_ = _tmp210_;
					_tmp212_ = vala_property_accessor_get_method (_tmp211_);
					m = _tmp212_;
					vala_gir_writer_write_indent (self);
					_tmp213_ = self->priv->buffer;
					_tmp214_ = m;
					_tmp215_ = vala_symbol_get_name ((ValaSymbol*) _tmp214_);
					_tmp216_ = _tmp215_;
					g_string_append_printf (_tmp213_, "<field name=\"%s\">\n", _tmp216_);
					_tmp217_ = self->priv->indent;
					self->priv->indent = _tmp217_ + 1;
					_tmp218_ = m;
					_tmp219_ = m;
					_tmp220_ = vala_symbol_get_name ((ValaSymbol*) _tmp219_);
					_tmp221_ = _tmp220_;
					_tmp222_ = m;
					_tmp223_ = vala_get_ccode_name ((ValaCodeNode*) _tmp222_);
					_tmp224_ = _tmp223_;
					_tmp225_ = m;
					_tmp226_ = vala_callable_get_parameters ((ValaCallable*) _tmp225_);
					_tmp227_ = _tmp226_;
					_tmp228_ = m;
					_tmp229_ = vala_callable_get_return_type ((ValaCallable*) _tmp228_);
					_tmp230_ = _tmp229_;
					_tmp231_ = m;
					_tmp232_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) _tmp231_);
					_tmp233_ = _tmp232_;
					vala_gir_writer_do_write_signature (self, _tmp218_, "callback", TRUE, _tmp221_, _tmp224_, _tmp227_, _tmp230_, _tmp233_, FALSE);
					_vala_iterable_unref0 (_tmp227_);
					_g_free0 (_tmp224_);
					_tmp234_ = self->priv->indent;
					self->priv->indent = _tmp234_ - 1;
					vala_gir_writer_write_indent (self);
					_tmp235_ = self->priv->buffer;
					g_string_append_printf (_tmp235_, "</field>\n");
					_vala_code_node_unref0 (m);
				}
			}
			_vala_code_node_unref0 (prop);
		}
		_vala_iterable_unref0 (_prop_list);
	}
	_tmp236_ = self->priv->indent;
	self->priv->indent = _tmp236_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp237_ = self->priv->buffer;
	g_string_append_printf (_tmp237_, "</record>\n");
	vala_gir_writer_visit_deferred (self);
	_g_free0 (gtype_struct_name);
}


static void
vala_gir_writer_visit_deferred (ValaGIRWriter* self)
{
	ValaArrayList* nodes = NULL;
	ValaArrayList* _tmp0_;
	ValaArrayList* _tmp1_;
	GEqualFunc _tmp2_;
	ValaArrayList* _tmp3_;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->deferred;
	_tmp1_ = _vala_iterable_ref0 (_tmp0_);
	nodes = _tmp1_;
	_tmp2_ = g_direct_equal;
	_tmp3_ = vala_array_list_new (VALA_TYPE_CODE_NODE, (GBoxedCopyFunc) vala_code_node_ref, (GDestroyNotify) vala_code_node_unref, _tmp2_);
	_vala_iterable_unref0 (self->priv->deferred);
	self->priv->deferred = _tmp3_;
	{
		ValaArrayList* _node_list = NULL;
		ValaArrayList* _tmp4_;
		ValaArrayList* _tmp5_;
		gint _node_size = 0;
		ValaArrayList* _tmp6_;
		gint _tmp7_;
		gint _tmp8_;
		gint _node_index = 0;
		_tmp4_ = nodes;
		_tmp5_ = _vala_iterable_ref0 (_tmp4_);
		_node_list = _tmp5_;
		_tmp6_ = _node_list;
		_tmp7_ = vala_collection_get_size ((ValaCollection*) _tmp6_);
		_tmp8_ = _tmp7_;
		_node_size = _tmp8_;
		_node_index = -1;
		while (TRUE) {
			gint _tmp9_;
			gint _tmp10_;
			gint _tmp11_;
			ValaCodeNode* node = NULL;
			ValaArrayList* _tmp12_;
			gint _tmp13_;
			gpointer _tmp14_;
			ValaCodeNode* _tmp15_;
			_tmp9_ = _node_index;
			_node_index = _tmp9_ + 1;
			_tmp10_ = _node_index;
			_tmp11_ = _node_size;
			if (!(_tmp10_ < _tmp11_)) {
				break;
			}
			_tmp12_ = _node_list;
			_tmp13_ = _node_index;
			_tmp14_ = vala_list_get ((ValaList*) _tmp12_, _tmp13_);
			node = (ValaCodeNode*) _tmp14_;
			_tmp15_ = node;
			vala_code_node_accept (_tmp15_, (ValaCodeVisitor*) self);
			_vala_code_node_unref0 (node);
		}
		_vala_iterable_unref0 (_node_list);
	}
	_vala_iterable_unref0 (nodes);
}


static gchar*
vala_gir_writer_get_gir_name (ValaGIRWriter* self,
                              ValaSymbol* symbol)
{
	gchar* result = NULL;
	gchar* gir_name = NULL;
	ValaSymbol* h0 = NULL;
	ValaArrayList* _tmp0_;
	gpointer _tmp1_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (symbol != NULL, NULL);
	gir_name = NULL;
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = vala_list_get ((ValaList*) _tmp0_, 0);
	h0 = (ValaSymbol*) _tmp1_;
	{
		ValaSymbol* cur_sym = NULL;
		ValaSymbol* _tmp2_;
		_tmp2_ = _vala_code_node_ref0 (symbol);
		cur_sym = _tmp2_;
		{
			gboolean _tmp3_ = FALSE;
			_tmp3_ = TRUE;
			while (TRUE) {
				ValaSymbol* _tmp8_;
				ValaSymbol* _tmp9_;
				ValaSymbol* _tmp10_;
				gchar* cur_name = NULL;
				ValaSymbol* _tmp11_;
				gchar* _tmp12_;
				const gchar* _tmp13_;
				const gchar* _tmp18_;
				const gchar* _tmp19_;
				gchar* _tmp20_;
				if (!_tmp3_) {
					ValaSymbol* _tmp4_;
					ValaSymbol* _tmp5_;
					ValaSymbol* _tmp6_;
					ValaSymbol* _tmp7_;
					_tmp4_ = cur_sym;
					_tmp5_ = vala_symbol_get_parent_symbol (_tmp4_);
					_tmp6_ = _tmp5_;
					_tmp7_ = _vala_code_node_ref0 (_tmp6_);
					_vala_code_node_unref0 (cur_sym);
					cur_sym = _tmp7_;
				}
				_tmp3_ = FALSE;
				_tmp8_ = cur_sym;
				if (!(_tmp8_ != NULL)) {
					break;
				}
				_tmp9_ = cur_sym;
				_tmp10_ = h0;
				if (_tmp9_ == _tmp10_) {
					break;
				}
				_tmp11_ = cur_sym;
				_tmp12_ = vala_code_node_get_attribute_string ((ValaCodeNode*) _tmp11_, "GIR", "name", NULL);
				cur_name = _tmp12_;
				_tmp13_ = cur_name;
				if (_tmp13_ == NULL) {
					ValaSymbol* _tmp14_;
					const gchar* _tmp15_;
					const gchar* _tmp16_;
					gchar* _tmp17_;
					_tmp14_ = cur_sym;
					_tmp15_ = vala_symbol_get_name (_tmp14_);
					_tmp16_ = _tmp15_;
					_tmp17_ = g_strdup (_tmp16_);
					_g_free0 (cur_name);
					cur_name = _tmp17_;
				}
				_tmp18_ = cur_name;
				_tmp19_ = gir_name;
				_tmp20_ = g_strconcat (_tmp18_, _tmp19_, NULL);
				_g_free0 (gir_name);
				gir_name = _tmp20_;
				_g_free0 (cur_name);
			}
		}
		_vala_code_node_unref0 (cur_sym);
	}
	result = gir_name;
	_vala_code_node_unref0 (h0);
	return result;
}


static void
vala_gir_writer_real_visit_enum (ValaCodeVisitor* base,
                                 ValaEnum* en)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	ValaArrayList* _tmp2_;
	gpointer _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean _tmp5_;
	const gchar* _tmp7_ = NULL;
	gboolean _tmp8_;
	gboolean _tmp9_;
	gchar* element_name = NULL;
	gchar* _tmp10_;
	GString* _tmp11_;
	const gchar* _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	GString* _tmp15_;
	gint _tmp16_;
	gchar* _tmp17_;
	gchar* _tmp18_;
	ValaArrayList* _tmp19_;
	ValaArrayList* _tmp20_;
	gpointer _tmp21_;
	ValaSymbol* _tmp22_;
	gint _tmp23_;
	GString* _tmp24_;
	const gchar* _tmp25_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (en != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) en);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) en)) {
		return;
	}
	_tmp2_ = self->priv->hierarchy;
	_tmp3_ = vala_list_get ((ValaList*) _tmp2_, 0);
	_tmp4_ = (ValaSymbol*) _tmp3_;
	_tmp5_ = !G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_NAMESPACE);
	_vala_code_node_unref0 (_tmp4_);
	if (_tmp5_) {
		ValaArrayList* _tmp6_;
		_tmp6_ = self->priv->deferred;
		vala_collection_add ((ValaCollection*) _tmp6_, (ValaCodeNode*) en);
		return;
	}
	_tmp8_ = vala_enum_get_is_flags (en);
	_tmp9_ = _tmp8_;
	if (_tmp9_) {
		_tmp7_ = "bitfield";
	} else {
		_tmp7_ = "enumeration";
	}
	_tmp10_ = g_strdup (_tmp7_);
	element_name = _tmp10_;
	vala_gir_writer_write_indent (self);
	_tmp11_ = self->priv->buffer;
	_tmp12_ = element_name;
	_tmp13_ = vala_gir_writer_get_gir_name (self, (ValaSymbol*) en);
	_tmp14_ = _tmp13_;
	g_string_append_printf (_tmp11_, "<%s name=\"%s\"", _tmp12_, _tmp14_);
	_g_free0 (_tmp14_);
	vala_gir_writer_write_gtype_attributes (self, (ValaTypeSymbol*) en);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) en);
	_tmp15_ = self->priv->buffer;
	g_string_append_printf (_tmp15_, ">\n");
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ + 1;
	_tmp17_ = vala_gir_writer_get_enum_comment (self, en);
	_tmp18_ = _tmp17_;
	vala_gir_writer_write_doc (self, _tmp18_);
	_g_free0 (_tmp18_);
	self->priv->enum_value = 0;
	_tmp19_ = self->priv->hierarchy;
	vala_list_insert ((ValaList*) _tmp19_, 0, (ValaSymbol*) en);
	vala_code_node_accept_children ((ValaCodeNode*) en, (ValaCodeVisitor*) self);
	_tmp20_ = self->priv->hierarchy;
	_tmp21_ = vala_list_remove_at ((ValaList*) _tmp20_, 0);
	_tmp22_ = (ValaSymbol*) _tmp21_;
	_vala_code_node_unref0 (_tmp22_);
	_tmp23_ = self->priv->indent;
	self->priv->indent = _tmp23_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp24_ = self->priv->buffer;
	_tmp25_ = element_name;
	g_string_append_printf (_tmp24_, "</%s>\n", _tmp25_);
	vala_gir_writer_visit_deferred (self);
	_g_free0 (element_name);
}


static void
vala_gir_writer_real_visit_enum_value (ValaCodeVisitor* base,
                                       ValaEnumValue* ev)
{
	ValaGIRWriter * self;
	ValaEnum* en = NULL;
	ValaArrayList* _tmp0_;
	gpointer _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	gchar* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	gchar* _tmp8_;
	ValaExpression* _tmp9_;
	ValaExpression* _tmp10_;
	gchar* comment = NULL;
	gchar* _tmp23_;
	const gchar* _tmp24_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (ev != NULL);
	vala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = vala_list_get ((ValaList*) _tmp0_, 0);
	en = G_TYPE_CHECK_INSTANCE_CAST ((ValaSymbol*) _tmp1_, VALA_TYPE_ENUM, ValaEnum);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = vala_symbol_get_name ((ValaSymbol*) ev);
	_tmp4_ = _tmp3_;
	_tmp5_ = g_utf8_strdown (_tmp4_, (gssize) -1);
	_tmp6_ = _tmp5_;
	_tmp7_ = vala_get_ccode_name ((ValaCodeNode*) ev);
	_tmp8_ = _tmp7_;
	g_string_append_printf (_tmp2_, "<member name=\"%s\" c:identifier=\"%s\"", _tmp6_, _tmp8_);
	_g_free0 (_tmp8_);
	_g_free0 (_tmp6_);
	_tmp9_ = vala_constant_get_value ((ValaConstant*) ev);
	_tmp10_ = _tmp9_;
	if (_tmp10_ != NULL) {
		gchar* value = NULL;
		ValaExpression* _tmp11_;
		ValaExpression* _tmp12_;
		gchar* _tmp13_;
		GString* _tmp14_;
		const gchar* _tmp15_;
		_tmp11_ = vala_constant_get_value ((ValaConstant*) ev);
		_tmp12_ = _tmp11_;
		_tmp13_ = vala_gir_writer_literal_expression_to_value_string (self, _tmp12_);
		value = _tmp13_;
		_tmp14_ = self->priv->buffer;
		_tmp15_ = value;
		g_string_append_printf (_tmp14_, " value=\"%s\"", _tmp15_);
		_g_free0 (value);
	} else {
		ValaEnum* _tmp16_;
		gboolean _tmp17_;
		gboolean _tmp18_;
		_tmp16_ = en;
		_tmp17_ = vala_enum_get_is_flags (_tmp16_);
		_tmp18_ = _tmp17_;
		if (_tmp18_) {
			GString* _tmp19_;
			gint _tmp20_;
			_tmp19_ = self->priv->buffer;
			_tmp20_ = self->priv->enum_value;
			self->priv->enum_value = _tmp20_ + 1;
			g_string_append_printf (_tmp19_, " value=\"%d\"", 1 << _tmp20_);
		} else {
			GString* _tmp21_;
			gint _tmp22_;
			_tmp21_ = self->priv->buffer;
			_tmp22_ = self->priv->enum_value;
			self->priv->enum_value = _tmp22_ + 1;
			g_string_append_printf (_tmp21_, " value=\"%d\"", _tmp22_);
		}
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) ev);
	_tmp23_ = vala_gir_writer_get_enum_value_comment (self, ev);
	comment = _tmp23_;
	_tmp24_ = comment;
	if (_tmp24_ == NULL) {
		GString* _tmp25_;
		_tmp25_ = self->priv->buffer;
		g_string_append_printf (_tmp25_, "/>\n");
	} else {
		GString* _tmp26_;
		gint _tmp27_;
		const gchar* _tmp28_;
		gint _tmp29_;
		GString* _tmp30_;
		_tmp26_ = self->priv->buffer;
		g_string_append_printf (_tmp26_, ">\n");
		_tmp27_ = self->priv->indent;
		self->priv->indent = _tmp27_ + 1;
		_tmp28_ = comment;
		vala_gir_writer_write_doc (self, _tmp28_);
		_tmp29_ = self->priv->indent;
		self->priv->indent = _tmp29_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp30_ = self->priv->buffer;
		g_string_append_printf (_tmp30_, "</member>\n");
	}
	_g_free0 (comment);
	_vala_code_node_unref0 (en);
}


static void
vala_gir_writer_real_visit_error_domain (ValaCodeVisitor* base,
                                         ValaErrorDomain* edomain)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	GString* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	GString* _tmp8_;
	gint _tmp9_;
	gchar* _tmp10_;
	gchar* _tmp11_;
	ValaArrayList* _tmp12_;
	ValaArrayList* _tmp13_;
	gpointer _tmp14_;
	ValaSymbol* _tmp15_;
	gint _tmp16_;
	GString* _tmp17_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (edomain != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) edomain);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) edomain)) {
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = vala_symbol_get_name ((ValaSymbol*) edomain);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<enumeration name=\"%s\"", _tmp4_);
	vala_gir_writer_write_ctype_attributes (self, (ValaTypeSymbol*) edomain, "");
	_tmp5_ = self->priv->buffer;
	_tmp6_ = vala_get_ccode_quark_name (edomain);
	_tmp7_ = _tmp6_;
	g_string_append_printf (_tmp5_, " glib:error-domain=\"%s\"", _tmp7_);
	_g_free0 (_tmp7_);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) edomain);
	_tmp8_ = self->priv->buffer;
	g_string_append_printf (_tmp8_, ">\n");
	_tmp9_ = self->priv->indent;
	self->priv->indent = _tmp9_ + 1;
	_tmp10_ = vala_gir_writer_get_error_domain_comment (self, edomain);
	_tmp11_ = _tmp10_;
	vala_gir_writer_write_doc (self, _tmp11_);
	_g_free0 (_tmp11_);
	self->priv->enum_value = 0;
	_tmp12_ = self->priv->hierarchy;
	vala_list_insert ((ValaList*) _tmp12_, 0, (ValaSymbol*) edomain);
	vala_code_node_accept_children ((ValaCodeNode*) edomain, (ValaCodeVisitor*) self);
	_tmp13_ = self->priv->hierarchy;
	_tmp14_ = vala_list_remove_at ((ValaList*) _tmp13_, 0);
	_tmp15_ = (ValaSymbol*) _tmp14_;
	_vala_code_node_unref0 (_tmp15_);
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp17_ = self->priv->buffer;
	g_string_append_printf (_tmp17_, "</enumeration>\n");
	vala_gir_writer_visit_deferred (self);
}


static void
vala_gir_writer_real_visit_error_code (ValaCodeVisitor* base,
                                       ValaErrorCode* ecode)
{
	ValaGIRWriter * self;
	GString* _tmp0_;
	const gchar* _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	gchar* _tmp5_;
	gchar* _tmp6_;
	ValaExpression* _tmp7_;
	ValaExpression* _tmp8_;
	gchar* comment = NULL;
	gchar* _tmp16_;
	const gchar* _tmp17_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (ecode != NULL);
	vala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	_tmp1_ = vala_symbol_get_name ((ValaSymbol*) ecode);
	_tmp2_ = _tmp1_;
	_tmp3_ = g_utf8_strdown (_tmp2_, (gssize) -1);
	_tmp4_ = _tmp3_;
	_tmp5_ = vala_get_ccode_name ((ValaCodeNode*) ecode);
	_tmp6_ = _tmp5_;
	g_string_append_printf (_tmp0_, "<member name=\"%s\" c:identifier=\"%s\"", _tmp4_, _tmp6_);
	_g_free0 (_tmp6_);
	_g_free0 (_tmp4_);
	_tmp7_ = vala_error_code_get_value (ecode);
	_tmp8_ = _tmp7_;
	if (_tmp8_ != NULL) {
		gchar* value = NULL;
		ValaExpression* _tmp9_;
		ValaExpression* _tmp10_;
		gchar* _tmp11_;
		GString* _tmp12_;
		const gchar* _tmp13_;
		_tmp9_ = vala_error_code_get_value (ecode);
		_tmp10_ = _tmp9_;
		_tmp11_ = vala_gir_writer_literal_expression_to_value_string (self, _tmp10_);
		value = _tmp11_;
		_tmp12_ = self->priv->buffer;
		_tmp13_ = value;
		g_string_append_printf (_tmp12_, " value=\"%s\"", _tmp13_);
		_g_free0 (value);
	} else {
		GString* _tmp14_;
		gint _tmp15_;
		_tmp14_ = self->priv->buffer;
		_tmp15_ = self->priv->enum_value;
		self->priv->enum_value = _tmp15_ + 1;
		g_string_append_printf (_tmp14_, " value=\"%d\"", _tmp15_);
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) ecode);
	_tmp16_ = vala_gir_writer_get_error_code_comment (self, ecode);
	comment = _tmp16_;
	_tmp17_ = comment;
	if (_tmp17_ == NULL) {
		GString* _tmp18_;
		_tmp18_ = self->priv->buffer;
		g_string_append_printf (_tmp18_, "/>\n");
	} else {
		GString* _tmp19_;
		gint _tmp20_;
		const gchar* _tmp21_;
		gint _tmp22_;
		GString* _tmp23_;
		_tmp19_ = self->priv->buffer;
		g_string_append_printf (_tmp19_, ">\n");
		_tmp20_ = self->priv->indent;
		self->priv->indent = _tmp20_ + 1;
		_tmp21_ = comment;
		vala_gir_writer_write_doc (self, _tmp21_);
		_tmp22_ = self->priv->indent;
		self->priv->indent = _tmp22_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp23_ = self->priv->buffer;
		g_string_append_printf (_tmp23_, "</member>\n");
	}
	_g_free0 (comment);
}


static void
vala_gir_writer_real_visit_constant (ValaCodeVisitor* base,
                                     ValaConstant* c)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	ValaExpression* initializer = NULL;
	ValaExpression* _tmp2_;
	ValaExpression* _tmp3_;
	ValaExpression* _tmp4_;
	gchar* value = NULL;
	ValaExpression* _tmp5_;
	gchar* _tmp6_;
	GString* _tmp7_;
	const gchar* _tmp8_;
	const gchar* _tmp9_;
	gchar* _tmp10_;
	gchar* _tmp11_;
	GString* _tmp12_;
	const gchar* _tmp13_;
	GString* _tmp14_;
	gint _tmp15_;
	gchar* _tmp16_;
	gchar* _tmp17_;
	ValaExpression* _tmp18_;
	ValaDataType* _tmp19_;
	ValaDataType* _tmp20_;
	gint _tmp21_;
	GString* _tmp22_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (c != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) c);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) c)) {
		return;
	}
	_tmp2_ = vala_constant_get_value (c);
	_tmp3_ = _tmp2_;
	_tmp4_ = _vala_code_node_ref0 (_tmp3_);
	initializer = _tmp4_;
	_tmp5_ = initializer;
	_tmp6_ = vala_gir_writer_literal_expression_to_value_string (self, _tmp5_);
	value = _tmp6_;
	vala_gir_writer_write_indent (self);
	_tmp7_ = self->priv->buffer;
	_tmp8_ = vala_symbol_get_name ((ValaSymbol*) c);
	_tmp9_ = _tmp8_;
	_tmp10_ = vala_get_ccode_name ((ValaCodeNode*) c);
	_tmp11_ = _tmp10_;
	g_string_append_printf (_tmp7_, "<constant name=\"%s\" c:identifier=\"%s\"", _tmp9_, _tmp11_);
	_g_free0 (_tmp11_);
	_tmp12_ = self->priv->buffer;
	_tmp13_ = value;
	g_string_append_printf (_tmp12_, " value=\"%s\"", _tmp13_);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) c);
	_tmp14_ = self->priv->buffer;
	g_string_append_printf (_tmp14_, ">\n");
	_tmp15_ = self->priv->indent;
	self->priv->indent = _tmp15_ + 1;
	_tmp16_ = vala_gir_writer_get_constant_comment (self, c);
	_tmp17_ = _tmp16_;
	vala_gir_writer_write_doc (self, _tmp17_);
	_g_free0 (_tmp17_);
	_tmp18_ = initializer;
	_tmp19_ = vala_expression_get_value_type (_tmp18_);
	_tmp20_ = _tmp19_;
	vala_gir_writer_write_type (self, _tmp20_, -1, VALA_PARAMETER_DIRECTION_IN);
	_tmp21_ = self->priv->indent;
	self->priv->indent = _tmp21_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp22_ = self->priv->buffer;
	g_string_append_printf (_tmp22_, "</constant>\n");
	_g_free0 (value);
	_vala_code_node_unref0 (initializer);
}


static void
vala_gir_writer_real_visit_field (ValaCodeVisitor* base,
                                  ValaField* f)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	ValaDataType* _tmp5_;
	ValaDataType* _tmp6_;
	gboolean _tmp7_;
	gboolean _tmp8_;
	GString* _tmp10_;
	gint _tmp11_;
	gchar* _tmp12_;
	gchar* _tmp13_;
	ValaDataType* _tmp14_;
	ValaDataType* _tmp15_;
	gint _tmp16_;
	GString* _tmp17_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (f != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) f);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) f)) {
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = vala_get_ccode_name ((ValaCodeNode*) f);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<field name=\"%s\"", _tmp4_);
	_g_free0 (_tmp4_);
	_tmp5_ = vala_variable_get_variable_type ((ValaVariable*) f);
	_tmp6_ = _tmp5_;
	_tmp7_ = vala_data_type_get_nullable (_tmp6_);
	_tmp8_ = _tmp7_;
	if (_tmp8_) {
		GString* _tmp9_;
		_tmp9_ = self->priv->buffer;
		g_string_append_printf (_tmp9_, " allow-none=\"1\"");
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) f);
	_tmp10_ = self->priv->buffer;
	g_string_append_printf (_tmp10_, ">\n");
	_tmp11_ = self->priv->indent;
	self->priv->indent = _tmp11_ + 1;
	_tmp12_ = vala_gir_writer_get_field_comment (self, f);
	_tmp13_ = _tmp12_;
	vala_gir_writer_write_doc (self, _tmp13_);
	_g_free0 (_tmp13_);
	_tmp14_ = vala_variable_get_variable_type ((ValaVariable*) f);
	_tmp15_ = _tmp14_;
	vala_gir_writer_write_type (self, _tmp15_, -1, VALA_PARAMETER_DIRECTION_IN);
	_tmp16_ = self->priv->indent;
	self->priv->indent = _tmp16_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp17_ = self->priv->buffer;
	g_string_append_printf (_tmp17_, "</field>\n");
}


static void
vala_gir_writer_write_implicit_params (ValaGIRWriter* self,
                                       ValaDataType* type,
                                       gint* index,
                                       gboolean has_array_length,
                                       const gchar* name,
                                       ValaParameterDirection direction)
{
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_ARRAY_TYPE)) {
		_tmp0_ = has_array_length;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		ValaIntegerType* int_type = NULL;
		ValaCodeContext* _tmp1_;
		ValaNamespace* _tmp2_;
		ValaNamespace* _tmp3_;
		ValaScope* _tmp4_;
		ValaScope* _tmp5_;
		ValaSymbol* _tmp6_;
		ValaStruct* _tmp7_;
		ValaStruct* _tmp8_;
		ValaIntegerType* _tmp9_;
		ValaIntegerType* _tmp10_;
		_tmp1_ = self->priv->context;
		_tmp2_ = vala_code_context_get_root (_tmp1_);
		_tmp3_ = _tmp2_;
		_tmp4_ = vala_symbol_get_scope ((ValaSymbol*) _tmp3_);
		_tmp5_ = _tmp4_;
		_tmp6_ = vala_scope_lookup (_tmp5_, "int");
		_tmp7_ = G_TYPE_CHECK_INSTANCE_TYPE (_tmp6_, VALA_TYPE_STRUCT) ? ((ValaStruct*) _tmp6_) : NULL;
		if (_tmp7_ == NULL) {
			_vala_code_node_unref0 (_tmp6_);
		}
		_tmp8_ = _tmp7_;
		_tmp9_ = vala_integer_type_new (_tmp8_, NULL, NULL);
		_tmp10_ = _tmp9_;
		_vala_code_node_unref0 (_tmp8_);
		int_type = _tmp10_;
		{
			gint i = 0;
			i = 0;
			{
				gboolean _tmp11_ = FALSE;
				_tmp11_ = TRUE;
				while (TRUE) {
					gint _tmp13_;
					gint _tmp14_;
					gint _tmp15_;
					ValaIntegerType* _tmp16_;
					gint _tmp17_;
					gchar* _tmp18_;
					gchar* _tmp19_;
					if (!_tmp11_) {
						gint _tmp12_;
						_tmp12_ = i;
						i = _tmp12_ + 1;
					}
					_tmp11_ = FALSE;
					_tmp13_ = i;
					_tmp14_ = vala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_ARRAY_TYPE, ValaArrayType));
					_tmp15_ = _tmp14_;
					if (!(_tmp13_ < _tmp15_)) {
						break;
					}
					_tmp16_ = int_type;
					_tmp17_ = i;
					_tmp18_ = g_strdup_printf ("%s_length%i", name, _tmp17_ + 1);
					_tmp19_ = _tmp18_;
					vala_gir_writer_write_param_or_return (self, (ValaDataType*) _tmp16_, TRUE, index, has_array_length, _tmp19_, NULL, direction, FALSE, FALSE, FALSE);
					_g_free0 (_tmp19_);
				}
			}
		}
		_vala_code_node_unref0 (int_type);
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_DELEGATE_TYPE)) {
			ValaDelegateType* deleg_type = NULL;
			ValaDelegateType* _tmp20_;
			ValaDelegateType* _tmp21_;
			ValaDelegate* _tmp22_;
			ValaDelegate* _tmp23_;
			gboolean _tmp24_;
			gboolean _tmp25_;
			_tmp20_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_DELEGATE_TYPE, ValaDelegateType));
			deleg_type = _tmp20_;
			_tmp21_ = deleg_type;
			_tmp22_ = vala_delegate_type_get_delegate_symbol (_tmp21_);
			_tmp23_ = _tmp22_;
			_tmp24_ = vala_delegate_get_has_target (_tmp23_);
			_tmp25_ = _tmp24_;
			if (_tmp25_) {
				ValaPointerType* data_type = NULL;
				ValaVoidType* _tmp26_;
				ValaVoidType* _tmp27_;
				ValaPointerType* _tmp28_;
				ValaPointerType* _tmp29_;
				ValaPointerType* _tmp30_;
				gchar* _tmp31_;
				gchar* _tmp32_;
				ValaDelegateType* _tmp33_;
				_tmp26_ = vala_void_type_new (NULL);
				_tmp27_ = _tmp26_;
				_tmp28_ = vala_pointer_type_new ((ValaDataType*) _tmp27_, NULL);
				_tmp29_ = _tmp28_;
				_vala_code_node_unref0 (_tmp27_);
				data_type = _tmp29_;
				_tmp30_ = data_type;
				_tmp31_ = g_strdup_printf ("%s_target", name);
				_tmp32_ = _tmp31_;
				vala_gir_writer_write_param_or_return (self, (ValaDataType*) _tmp30_, TRUE, index, FALSE, _tmp32_, NULL, direction, FALSE, FALSE, FALSE);
				_g_free0 (_tmp32_);
				_tmp33_ = deleg_type;
				if (vala_data_type_is_disposable ((ValaDataType*) _tmp33_)) {
					ValaDelegateType* notify_type = NULL;
					ValaCodeContext* _tmp34_;
					ValaNamespace* _tmp35_;
					ValaNamespace* _tmp36_;
					ValaScope* _tmp37_;
					ValaScope* _tmp38_;
					ValaSymbol* _tmp39_;
					ValaSymbol* _tmp40_;
					ValaScope* _tmp41_;
					ValaScope* _tmp42_;
					ValaSymbol* _tmp43_;
					ValaDelegate* _tmp44_;
					ValaDelegate* _tmp45_;
					ValaDelegateType* _tmp46_;
					ValaDelegateType* _tmp47_;
					ValaDelegateType* _tmp48_;
					gchar* _tmp49_;
					gchar* _tmp50_;
					_tmp34_ = self->priv->context;
					_tmp35_ = vala_code_context_get_root (_tmp34_);
					_tmp36_ = _tmp35_;
					_tmp37_ = vala_symbol_get_scope ((ValaSymbol*) _tmp36_);
					_tmp38_ = _tmp37_;
					_tmp39_ = vala_scope_lookup (_tmp38_, "GLib");
					_tmp40_ = _tmp39_;
					_tmp41_ = vala_symbol_get_scope (_tmp40_);
					_tmp42_ = _tmp41_;
					_tmp43_ = vala_scope_lookup (_tmp42_, "DestroyNotify");
					_tmp44_ = G_TYPE_CHECK_INSTANCE_TYPE (_tmp43_, VALA_TYPE_DELEGATE) ? ((ValaDelegate*) _tmp43_) : NULL;
					if (_tmp44_ == NULL) {
						_vala_code_node_unref0 (_tmp43_);
					}
					_tmp45_ = _tmp44_;
					_tmp46_ = vala_delegate_type_new (_tmp45_);
					_tmp47_ = _tmp46_;
					_vala_code_node_unref0 (_tmp45_);
					_vala_code_node_unref0 (_tmp40_);
					notify_type = _tmp47_;
					_tmp48_ = notify_type;
					_tmp49_ = g_strdup_printf ("%s_target_destroy_notify", name);
					_tmp50_ = _tmp49_;
					vala_gir_writer_write_param_or_return (self, (ValaDataType*) _tmp48_, TRUE, index, FALSE, _tmp50_, NULL, direction, FALSE, FALSE, FALSE);
					_g_free0 (_tmp50_);
					_vala_code_node_unref0 (notify_type);
				}
				_vala_code_node_unref0 (data_type);
			}
			_vala_code_node_unref0 (deleg_type);
		}
	}
}


static void
vala_gir_writer_skip_implicit_params (ValaGIRWriter* self,
                                      ValaDataType* type,
                                      gint* index,
                                      gboolean has_array_length)
{
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_ARRAY_TYPE)) {
		_tmp0_ = has_array_length;
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		gint _tmp1_;
		gint _tmp2_;
		_tmp1_ = vala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_ARRAY_TYPE, ValaArrayType));
		_tmp2_ = _tmp1_;
		*index = (*index) + _tmp2_;
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_DELEGATE_TYPE)) {
			gint _tmp3_;
			ValaDelegateType* deleg_type = NULL;
			ValaDelegateType* _tmp4_;
			ValaDelegateType* _tmp5_;
			_tmp3_ = *index;
			*index = _tmp3_ + 1;
			_tmp4_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_DELEGATE_TYPE, ValaDelegateType));
			deleg_type = _tmp4_;
			_tmp5_ = deleg_type;
			if (vala_data_type_is_disposable ((ValaDataType*) _tmp5_)) {
				gint _tmp6_;
				_tmp6_ = *index;
				*index = _tmp6_ + 1;
			}
			_vala_code_node_unref0 (deleg_type);
		}
	}
}


static void
vala_gir_writer_write_params_and_return (ValaGIRWriter* self,
                                         ValaList* params,
                                         ValaDataType* return_type,
                                         gboolean return_array_length,
                                         const gchar* return_comment,
                                         gboolean constructor,
                                         ValaDataType* instance_type,
                                         gboolean user_data)
{
	gint last_index = 0;
	gboolean _tmp0_ = FALSE;
	gboolean ret_is_struct = FALSE;
	gboolean _tmp1_ = FALSE;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	gboolean _tmp4_ = FALSE;
	gint _tmp5_;
	gint _tmp6_;
	gboolean _tmp32_ = FALSE;
	gboolean _tmp37_ = FALSE;
	gboolean _tmp38_ = FALSE;
	gboolean _tmp39_ = FALSE;
	gboolean _tmp40_ = FALSE;
	gint _tmp41_;
	gint _tmp42_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (params != NULL);
	last_index = 0;
	if (return_type != NULL) {
		_tmp0_ = vala_data_type_is_real_non_null_struct_type (return_type);
	} else {
		_tmp0_ = FALSE;
	}
	ret_is_struct = _tmp0_;
	_tmp5_ = vala_collection_get_size ((ValaCollection*) params);
	_tmp6_ = _tmp5_;
	if (_tmp6_ != 0) {
		_tmp4_ = TRUE;
	} else {
		_tmp4_ = instance_type != NULL;
	}
	if (_tmp4_) {
		_tmp3_ = TRUE;
	} else {
		gboolean _tmp7_ = FALSE;
		if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, VALA_TYPE_ARRAY_TYPE)) {
			_tmp7_ = return_array_length;
		} else {
			_tmp7_ = FALSE;
		}
		_tmp3_ = _tmp7_;
	}
	if (_tmp3_) {
		_tmp2_ = TRUE;
	} else {
		_tmp2_ = G_TYPE_CHECK_INSTANCE_TYPE (return_type, VALA_TYPE_DELEGATE_TYPE);
	}
	if (_tmp2_) {
		_tmp1_ = TRUE;
	} else {
		gboolean _tmp8_;
		_tmp8_ = ret_is_struct;
		_tmp1_ = _tmp8_;
	}
	if (_tmp1_) {
		gint index = 0;
		gboolean _tmp25_;
		gint _tmp31_;
		index = 0;
		if (instance_type != NULL) {
			gint _tmp9_;
			_tmp9_ = index;
			index = _tmp9_ + 1;
		}
		{
			ValaList* _param_list = NULL;
			ValaList* _tmp10_;
			gint _param_size = 0;
			ValaList* _tmp11_;
			gint _tmp12_;
			gint _tmp13_;
			gint _param_index = 0;
			_tmp10_ = _vala_iterable_ref0 (params);
			_param_list = _tmp10_;
			_tmp11_ = _param_list;
			_tmp12_ = vala_collection_get_size ((ValaCollection*) _tmp11_);
			_tmp13_ = _tmp12_;
			_param_size = _tmp13_;
			_param_index = -1;
			while (TRUE) {
				gint _tmp14_;
				gint _tmp15_;
				gint _tmp16_;
				ValaParameter* param = NULL;
				ValaList* _tmp17_;
				gint _tmp18_;
				gpointer _tmp19_;
				gint _tmp20_;
				ValaParameter* _tmp21_;
				ValaDataType* _tmp22_;
				ValaDataType* _tmp23_;
				ValaParameter* _tmp24_;
				_tmp14_ = _param_index;
				_param_index = _tmp14_ + 1;
				_tmp15_ = _param_index;
				_tmp16_ = _param_size;
				if (!(_tmp15_ < _tmp16_)) {
					break;
				}
				_tmp17_ = _param_list;
				_tmp18_ = _param_index;
				_tmp19_ = vala_list_get (_tmp17_, _tmp18_);
				param = (ValaParameter*) _tmp19_;
				_tmp20_ = index;
				index = _tmp20_ + 1;
				_tmp21_ = param;
				_tmp22_ = vala_variable_get_variable_type ((ValaVariable*) _tmp21_);
				_tmp23_ = _tmp22_;
				_tmp24_ = param;
				vala_gir_writer_skip_implicit_params (self, _tmp23_, &index, vala_get_ccode_array_length ((ValaCodeNode*) _tmp24_));
				_vala_code_node_unref0 (param);
			}
			_vala_iterable_unref0 (_param_list);
		}
		_tmp25_ = ret_is_struct;
		if (_tmp25_) {
			gint _tmp26_;
			_tmp26_ = index;
			index = _tmp26_ + 1;
		} else {
			gboolean _tmp27_ = FALSE;
			vala_gir_writer_skip_implicit_params (self, return_type, &index, return_array_length);
			if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, VALA_TYPE_ARRAY_TYPE)) {
				_tmp27_ = return_array_length;
			} else {
				_tmp27_ = FALSE;
			}
			if (_tmp27_) {
				gint _tmp28_;
				gint _tmp29_;
				gint _tmp30_;
				_tmp28_ = index;
				_tmp29_ = vala_array_type_get_rank (G_TYPE_CHECK_INSTANCE_CAST (return_type, VALA_TYPE_ARRAY_TYPE, ValaArrayType));
				_tmp30_ = _tmp29_;
				index = _tmp28_ - (_tmp30_ - 1);
			}
		}
		_tmp31_ = index;
		last_index = _tmp31_ - 1;
	}
	if (return_type != NULL) {
		gboolean _tmp33_;
		_tmp33_ = ret_is_struct;
		_tmp32_ = !_tmp33_;
	} else {
		_tmp32_ = FALSE;
	}
	if (_tmp32_) {
		vala_gir_writer_write_param_or_return (self, return_type, FALSE, &last_index, return_array_length, NULL, return_comment, VALA_PARAMETER_DIRECTION_IN, constructor, FALSE, FALSE);
	} else {
		gboolean _tmp34_;
		_tmp34_ = ret_is_struct;
		if (_tmp34_) {
			ValaVoidType* _tmp35_;
			ValaVoidType* _tmp36_;
			_tmp35_ = vala_void_type_new (NULL);
			_tmp36_ = _tmp35_;
			vala_gir_writer_write_param_or_return (self, (ValaDataType*) _tmp36_, FALSE, &last_index, FALSE, NULL, return_comment, VALA_PARAMETER_DIRECTION_IN, FALSE, FALSE, FALSE);
			_vala_code_node_unref0 (_tmp36_);
		}
	}
	_tmp41_ = vala_collection_get_size ((ValaCollection*) params);
	_tmp42_ = _tmp41_;
	if (_tmp42_ != 0) {
		_tmp40_ = TRUE;
	} else {
		_tmp40_ = instance_type != NULL;
	}
	if (_tmp40_) {
		_tmp39_ = TRUE;
	} else {
		gboolean _tmp43_ = FALSE;
		if (G_TYPE_CHECK_INSTANCE_TYPE (return_type, VALA_TYPE_ARRAY_TYPE)) {
			_tmp43_ = return_array_length;
		} else {
			_tmp43_ = FALSE;
		}
		_tmp39_ = _tmp43_;
	}
	if (_tmp39_) {
		_tmp38_ = TRUE;
	} else {
		_tmp38_ = G_TYPE_CHECK_INSTANCE_TYPE (return_type, VALA_TYPE_DELEGATE_TYPE);
	}
	if (_tmp38_) {
		_tmp37_ = TRUE;
	} else {
		gboolean _tmp44_;
		_tmp44_ = ret_is_struct;
		_tmp37_ = _tmp44_;
	}
	if (_tmp37_) {
		GString* _tmp45_;
		gint _tmp46_;
		gint index = 0;
		gboolean _tmp83_;
		gint _tmp90_;
		GString* _tmp91_;
		vala_gir_writer_write_indent (self);
		_tmp45_ = self->priv->buffer;
		g_string_append_printf (_tmp45_, "<parameters>\n");
		_tmp46_ = self->priv->indent;
		self->priv->indent = _tmp46_ + 1;
		index = 0;
		if (instance_type != NULL) {
			vala_gir_writer_write_param_or_return (self, instance_type, TRUE, &index, FALSE, "self", NULL, VALA_PARAMETER_DIRECTION_IN, FALSE, FALSE, FALSE);
		}
		{
			ValaList* _param_list = NULL;
			ValaList* _tmp47_;
			gint _param_size = 0;
			ValaList* _tmp48_;
			gint _tmp49_;
			gint _tmp50_;
			gint _param_index = 0;
			_tmp47_ = _vala_iterable_ref0 (params);
			_param_list = _tmp47_;
			_tmp48_ = _param_list;
			_tmp49_ = vala_collection_get_size ((ValaCollection*) _tmp48_);
			_tmp50_ = _tmp49_;
			_param_size = _tmp50_;
			_param_index = -1;
			while (TRUE) {
				gint _tmp51_;
				gint _tmp52_;
				gint _tmp53_;
				ValaParameter* param = NULL;
				ValaList* _tmp54_;
				gint _tmp55_;
				gpointer _tmp56_;
				ValaParameter* _tmp57_;
				ValaDataType* _tmp58_;
				ValaDataType* _tmp59_;
				ValaParameter* _tmp60_;
				ValaParameter* _tmp61_;
				const gchar* _tmp62_;
				const gchar* _tmp63_;
				ValaParameter* _tmp64_;
				gchar* _tmp65_;
				gchar* _tmp66_;
				ValaParameter* _tmp67_;
				ValaParameterDirection _tmp68_;
				ValaParameterDirection _tmp69_;
				ValaParameter* _tmp70_;
				gboolean _tmp71_;
				gboolean _tmp72_;
				ValaParameter* _tmp73_;
				ValaDataType* _tmp74_;
				ValaDataType* _tmp75_;
				ValaParameter* _tmp76_;
				ValaParameter* _tmp77_;
				const gchar* _tmp78_;
				const gchar* _tmp79_;
				ValaParameter* _tmp80_;
				ValaParameterDirection _tmp81_;
				ValaParameterDirection _tmp82_;
				_tmp51_ = _param_index;
				_param_index = _tmp51_ + 1;
				_tmp52_ = _param_index;
				_tmp53_ = _param_size;
				if (!(_tmp52_ < _tmp53_)) {
					break;
				}
				_tmp54_ = _param_list;
				_tmp55_ = _param_index;
				_tmp56_ = vala_list_get (_tmp54_, _tmp55_);
				param = (ValaParameter*) _tmp56_;
				_tmp57_ = param;
				_tmp58_ = vala_variable_get_variable_type ((ValaVariable*) _tmp57_);
				_tmp59_ = _tmp58_;
				_tmp60_ = param;
				_tmp61_ = param;
				_tmp62_ = vala_symbol_get_name ((ValaSymbol*) _tmp61_);
				_tmp63_ = _tmp62_;
				_tmp64_ = param;
				_tmp65_ = vala_gir_writer_get_parameter_comment (self, _tmp64_);
				_tmp66_ = _tmp65_;
				_tmp67_ = param;
				_tmp68_ = vala_parameter_get_direction (_tmp67_);
				_tmp69_ = _tmp68_;
				_tmp70_ = param;
				_tmp71_ = vala_parameter_get_ellipsis (_tmp70_);
				_tmp72_ = _tmp71_;
				vala_gir_writer_write_param_or_return (self, _tmp59_, TRUE, &index, vala_get_ccode_array_length ((ValaCodeNode*) _tmp60_), _tmp63_, _tmp66_, _tmp69_, FALSE, FALSE, _tmp72_);
				_g_free0 (_tmp66_);
				_tmp73_ = param;
				_tmp74_ = vala_variable_get_variable_type ((ValaVariable*) _tmp73_);
				_tmp75_ = _tmp74_;
				_tmp76_ = param;
				_tmp77_ = param;
				_tmp78_ = vala_symbol_get_name ((ValaSymbol*) _tmp77_);
				_tmp79_ = _tmp78_;
				_tmp80_ = param;
				_tmp81_ = vala_parameter_get_direction (_tmp80_);
				_tmp82_ = _tmp81_;
				vala_gir_writer_write_implicit_params (self, _tmp75_, &index, vala_get_ccode_array_length ((ValaCodeNode*) _tmp76_), _tmp79_, _tmp82_);
				_vala_code_node_unref0 (param);
			}
			_vala_iterable_unref0 (_param_list);
		}
		_tmp83_ = ret_is_struct;
		if (_tmp83_) {
			vala_gir_writer_write_param_or_return (self, return_type, TRUE, &index, FALSE, "result", return_comment, VALA_PARAMETER_DIRECTION_OUT, constructor, TRUE, FALSE);
		} else {
			vala_gir_writer_write_implicit_params (self, return_type, &index, return_array_length, "result", VALA_PARAMETER_DIRECTION_OUT);
		}
		if (user_data) {
			GString* _tmp84_;
			gint _tmp85_;
			gint _tmp86_;
			GString* _tmp87_;
			gint _tmp88_;
			GString* _tmp89_;
			vala_gir_writer_write_indent (self);
			_tmp84_ = self->priv->buffer;
			_tmp85_ = index;
			g_string_append_printf (_tmp84_, "<parameter name=\"user_data\" transfer-ownership=\"none\" closure=\"%d" \
"\">\n", _tmp85_);
			_tmp86_ = self->priv->indent;
			self->priv->indent = _tmp86_ + 1;
			vala_gir_writer_write_indent (self);
			_tmp87_ = self->priv->buffer;
			g_string_append_printf (_tmp87_, "<type name=\"gpointer\" c:type=\"void*\"/>\n");
			_tmp88_ = self->priv->indent;
			self->priv->indent = _tmp88_ - 1;
			vala_gir_writer_write_indent (self);
			_tmp89_ = self->priv->buffer;
			g_string_append_printf (_tmp89_, "</parameter>\n");
		}
		_tmp90_ = self->priv->indent;
		self->priv->indent = _tmp90_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp91_ = self->priv->buffer;
		g_string_append_printf (_tmp91_, "</parameters>\n");
	}
}


static void
vala_gir_writer_real_visit_delegate (ValaCodeVisitor* base,
                                     ValaDelegate* cb)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	const gchar* _tmp4_;
	GString* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	gboolean _tmp8_;
	gboolean _tmp9_;
	GString* _tmp11_;
	gint _tmp12_;
	gchar* _tmp13_;
	gchar* _tmp14_;
	ValaList* _tmp15_;
	ValaList* _tmp16_;
	ValaDataType* _tmp17_;
	ValaDataType* _tmp18_;
	gchar* _tmp19_;
	gchar* _tmp20_;
	gboolean _tmp21_;
	gboolean _tmp22_;
	gint _tmp23_;
	GString* _tmp24_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (cb != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) cb);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) cb)) {
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp2_ = self->priv->buffer;
	_tmp3_ = vala_symbol_get_name ((ValaSymbol*) cb);
	_tmp4_ = _tmp3_;
	g_string_append_printf (_tmp2_, "<callback name=\"%s\"", _tmp4_);
	_tmp5_ = self->priv->buffer;
	_tmp6_ = vala_get_ccode_name ((ValaCodeNode*) cb);
	_tmp7_ = _tmp6_;
	g_string_append_printf (_tmp5_, " c:type=\"%s\"", _tmp7_);
	_g_free0 (_tmp7_);
	_tmp8_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) cb);
	_tmp9_ = _tmp8_;
	if (_tmp9_) {
		GString* _tmp10_;
		_tmp10_ = self->priv->buffer;
		g_string_append_printf (_tmp10_, " throws=\"1\"");
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) cb);
	_tmp11_ = self->priv->buffer;
	g_string_append_printf (_tmp11_, ">\n");
	_tmp12_ = self->priv->indent;
	self->priv->indent = _tmp12_ + 1;
	_tmp13_ = vala_gir_writer_get_delegate_comment (self, cb);
	_tmp14_ = _tmp13_;
	vala_gir_writer_write_doc (self, _tmp14_);
	_g_free0 (_tmp14_);
	_tmp15_ = vala_callable_get_parameters ((ValaCallable*) cb);
	_tmp16_ = _tmp15_;
	_tmp17_ = vala_callable_get_return_type ((ValaCallable*) cb);
	_tmp18_ = _tmp17_;
	_tmp19_ = vala_gir_writer_get_delegate_return_comment (self, cb);
	_tmp20_ = _tmp19_;
	_tmp21_ = vala_delegate_get_has_target (cb);
	_tmp22_ = _tmp21_;
	vala_gir_writer_write_params_and_return (self, _tmp16_, _tmp18_, vala_get_ccode_array_length ((ValaCodeNode*) cb), _tmp20_, FALSE, NULL, _tmp22_);
	_g_free0 (_tmp20_);
	_vala_iterable_unref0 (_tmp16_);
	_tmp23_ = self->priv->indent;
	self->priv->indent = _tmp23_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp24_ = self->priv->buffer;
	g_string_append_printf (_tmp24_, "</callback>\n");
}


static void
vala_gir_writer_real_visit_method (ValaCodeVisitor* base,
                                   ValaMethod* m)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_ = FALSE;
	gboolean _tmp3_ = FALSE;
	gchar* tag_name = NULL;
	gchar* _tmp14_;
	ValaSymbol* parent = NULL;
	ValaArrayList* _tmp15_;
	gpointer _tmp16_;
	ValaSymbol* _tmp17_;
	gboolean _tmp19_ = FALSE;
	gboolean _tmp20_ = FALSE;
	ValaSymbol* _tmp21_;
	const gchar* _tmp28_;
	gboolean _tmp29_ = FALSE;
	gboolean _tmp30_;
	gboolean _tmp31_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (m != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) m);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) m)) {
		_tmp3_ = TRUE;
	} else {
		gboolean _tmp4_;
		gboolean _tmp5_;
		_tmp4_ = vala_method_get_overrides (m);
		_tmp5_ = _tmp4_;
		_tmp3_ = _tmp5_;
	}
	if (_tmp3_) {
		_tmp2_ = TRUE;
	} else {
		gboolean _tmp6_ = FALSE;
		gboolean _tmp7_ = FALSE;
		ValaMethod* _tmp8_;
		ValaMethod* _tmp9_;
		_tmp8_ = vala_method_get_base_interface_method (m);
		_tmp9_ = _tmp8_;
		if (_tmp9_ != NULL) {
			gboolean _tmp10_;
			gboolean _tmp11_;
			_tmp10_ = vala_method_get_is_abstract (m);
			_tmp11_ = _tmp10_;
			_tmp7_ = !_tmp11_;
		} else {
			_tmp7_ = FALSE;
		}
		if (_tmp7_) {
			gboolean _tmp12_;
			gboolean _tmp13_;
			_tmp12_ = vala_method_get_is_virtual (m);
			_tmp13_ = _tmp12_;
			_tmp6_ = !_tmp13_;
		} else {
			_tmp6_ = FALSE;
		}
		_tmp2_ = _tmp6_;
	}
	if (_tmp2_) {
		return;
	}
	_tmp14_ = g_strdup ("method");
	tag_name = _tmp14_;
	_tmp15_ = self->priv->hierarchy;
	_tmp16_ = vala_list_get ((ValaList*) _tmp15_, 0);
	parent = (ValaSymbol*) _tmp16_;
	_tmp17_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp17_, VALA_TYPE_ENUM)) {
		ValaArrayList* _tmp18_;
		_tmp18_ = self->priv->deferred;
		vala_collection_add ((ValaCollection*) _tmp18_, (ValaCodeNode*) m);
		_vala_code_node_unref0 (parent);
		_g_free0 (tag_name);
		return;
	}
	_tmp21_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp21_, VALA_TYPE_NAMESPACE)) {
		_tmp20_ = TRUE;
	} else {
		ValaMemberBinding _tmp22_;
		ValaMemberBinding _tmp23_;
		_tmp22_ = vala_method_get_binding (m);
		_tmp23_ = _tmp22_;
		_tmp20_ = _tmp23_ == VALA_MEMBER_BINDING_STATIC;
	}
	if (_tmp20_) {
		_tmp19_ = TRUE;
	} else {
		ValaSymbol* _tmp24_;
		ValaSymbol* _tmp25_;
		ValaSymbol* _tmp26_;
		_tmp24_ = parent;
		_tmp25_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
		_tmp26_ = _tmp25_;
		_tmp19_ = _tmp24_ != _tmp26_;
	}
	if (_tmp19_) {
		gchar* _tmp27_;
		_tmp27_ = g_strdup ("function");
		_g_free0 (tag_name);
		tag_name = _tmp27_;
	}
	_tmp28_ = tag_name;
	vala_gir_writer_write_signature (self, m, _tmp28_, TRUE, FALSE);
	_tmp30_ = vala_method_get_is_abstract (m);
	_tmp31_ = _tmp30_;
	if (_tmp31_) {
		_tmp29_ = TRUE;
	} else {
		gboolean _tmp32_;
		gboolean _tmp33_;
		_tmp32_ = vala_method_get_is_virtual (m);
		_tmp33_ = _tmp32_;
		_tmp29_ = _tmp33_;
	}
	if (_tmp29_) {
		vala_gir_writer_write_signature (self, m, "virtual-method", TRUE, FALSE);
	}
	_vala_code_node_unref0 (parent);
	_g_free0 (tag_name);
}


static gboolean
vala_gir_writer_is_type_introspectable (ValaGIRWriter* self,
                                        ValaDataType* type)
{
	gboolean result = FALSE;
	gchar* _tmp0_;
	gchar* _tmp1_;
	gboolean _tmp2_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (type != NULL, FALSE);
	_tmp0_ = vala_get_ccode_name ((ValaCodeNode*) type);
	_tmp1_ = _tmp0_;
	_tmp2_ = g_strcmp0 (_tmp1_, "va_list") == 0;
	_g_free0 (_tmp1_);
	if (_tmp2_) {
		result = FALSE;
		return result;
	}
	result = TRUE;
	return result;
}


static gboolean
vala_gir_writer_is_method_introspectable (ValaGIRWriter* self,
                                          ValaMethod* m)
{
	gboolean result = FALSE;
	ValaDataType* _tmp0_;
	ValaDataType* _tmp1_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (m != NULL, FALSE);
	_tmp0_ = vala_callable_get_return_type ((ValaCallable*) m);
	_tmp1_ = _tmp0_;
	if (!vala_gir_writer_is_type_introspectable (self, _tmp1_)) {
		result = FALSE;
		return result;
	}
	{
		ValaList* _param_list = NULL;
		ValaList* _tmp2_;
		gint _param_size = 0;
		ValaList* _tmp3_;
		gint _tmp4_;
		gint _tmp5_;
		gint _param_index = 0;
		_tmp2_ = vala_callable_get_parameters ((ValaCallable*) m);
		_param_list = _tmp2_;
		_tmp3_ = _param_list;
		_tmp4_ = vala_collection_get_size ((ValaCollection*) _tmp3_);
		_tmp5_ = _tmp4_;
		_param_size = _tmp5_;
		_param_index = -1;
		while (TRUE) {
			gint _tmp6_;
			gint _tmp7_;
			gint _tmp8_;
			ValaParameter* param = NULL;
			ValaList* _tmp9_;
			gint _tmp10_;
			gpointer _tmp11_;
			gboolean _tmp12_ = FALSE;
			ValaParameter* _tmp13_;
			gboolean _tmp14_;
			gboolean _tmp15_;
			_tmp6_ = _param_index;
			_param_index = _tmp6_ + 1;
			_tmp7_ = _param_index;
			_tmp8_ = _param_size;
			if (!(_tmp7_ < _tmp8_)) {
				break;
			}
			_tmp9_ = _param_list;
			_tmp10_ = _param_index;
			_tmp11_ = vala_list_get (_tmp9_, _tmp10_);
			param = (ValaParameter*) _tmp11_;
			_tmp13_ = param;
			_tmp14_ = vala_parameter_get_ellipsis (_tmp13_);
			_tmp15_ = _tmp14_;
			if (_tmp15_) {
				_tmp12_ = TRUE;
			} else {
				ValaParameter* _tmp16_;
				ValaDataType* _tmp17_;
				ValaDataType* _tmp18_;
				_tmp16_ = param;
				_tmp17_ = vala_variable_get_variable_type ((ValaVariable*) _tmp16_);
				_tmp18_ = _tmp17_;
				_tmp12_ = !vala_gir_writer_is_type_introspectable (self, _tmp18_);
			}
			if (_tmp12_) {
				result = FALSE;
				_vala_code_node_unref0 (param);
				_vala_iterable_unref0 (_param_list);
				return result;
			}
			_vala_code_node_unref0 (param);
		}
		_vala_iterable_unref0 (_param_list);
	}
	result = TRUE;
	return result;
}


static gboolean
vala_gir_writer_is_introspectable (ValaGIRWriter* self,
                                   ValaSymbol* sym)
{
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	if (G_TYPE_CHECK_INSTANCE_TYPE (sym, VALA_TYPE_METHOD)) {
		_tmp0_ = !vala_gir_writer_is_method_introspectable (self, G_TYPE_CHECK_INSTANCE_CAST (sym, VALA_TYPE_METHOD, ValaMethod));
	} else {
		_tmp0_ = FALSE;
	}
	if (_tmp0_) {
		result = FALSE;
		return result;
	}
	result = vala_gir_writer_is_visibility (self, sym);
	return result;
}


static void
vala_gir_writer_write_signature (ValaGIRWriter* self,
                                 ValaMethod* m,
                                 const gchar* tag_name,
                                 gboolean write_doc,
                                 gboolean instance)
{
	ValaSymbol* parent = NULL;
	ValaArrayList* _tmp0_;
	gpointer _tmp1_;
	gchar* name = NULL;
	ValaSymbol* _tmp2_;
	ValaSymbol* _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean _tmp18_;
	gboolean _tmp19_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (m != NULL);
	g_return_if_fail (tag_name != NULL);
	_tmp0_ = self->priv->hierarchy;
	_tmp1_ = vala_list_get ((ValaList*) _tmp0_, 0);
	parent = (ValaSymbol*) _tmp1_;
	_tmp2_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
	_tmp3_ = _tmp2_;
	_tmp4_ = parent;
	if (_tmp3_ != _tmp4_) {
		gchar* _tmp5_;
		gchar* parent_prefix = NULL;
		ValaSymbol* _tmp6_;
		gchar* _tmp7_;
		const gchar* _tmp8_;
		const gchar* _tmp9_;
		instance = FALSE;
		_tmp5_ = vala_get_ccode_name ((ValaCodeNode*) m);
		_g_free0 (name);
		name = _tmp5_;
		_tmp6_ = parent;
		_tmp7_ = vala_get_ccode_lower_case_prefix (_tmp6_);
		parent_prefix = _tmp7_;
		_tmp8_ = name;
		_tmp9_ = parent_prefix;
		if (g_str_has_prefix (_tmp8_, _tmp9_)) {
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			gint _tmp12_;
			gint _tmp13_;
			gchar* _tmp14_;
			_tmp10_ = name;
			_tmp11_ = parent_prefix;
			_tmp12_ = strlen (_tmp11_);
			_tmp13_ = _tmp12_;
			_tmp14_ = string_substring (_tmp10_, (glong) _tmp13_, (glong) -1);
			_g_free0 (name);
			name = _tmp14_;
		}
		_g_free0 (parent_prefix);
	} else {
		const gchar* _tmp15_;
		const gchar* _tmp16_;
		gchar* _tmp17_;
		_tmp15_ = vala_symbol_get_name ((ValaSymbol*) m);
		_tmp16_ = _tmp15_;
		_tmp17_ = g_strdup (_tmp16_);
		_g_free0 (name);
		name = _tmp17_;
	}
	_tmp18_ = vala_method_get_coroutine (m);
	_tmp19_ = _tmp18_;
	if (_tmp19_) {
		gchar* finish_name = NULL;
		const gchar* _tmp20_;
		gchar* _tmp21_;
		const gchar* _tmp22_;
		const gchar* _tmp30_;
		gchar* _tmp31_;
		const gchar* _tmp32_;
		gchar* _tmp33_;
		gchar* _tmp34_;
		ValaList* _tmp35_;
		ValaList* _tmp36_;
		ValaVoidType* _tmp37_;
		ValaVoidType* _tmp38_;
		const gchar* _tmp39_;
		gchar* _tmp40_;
		gchar* _tmp41_;
		ValaList* _tmp42_;
		ValaList* _tmp43_;
		ValaDataType* _tmp44_;
		ValaDataType* _tmp45_;
		gboolean _tmp46_;
		gboolean _tmp47_;
		_tmp20_ = name;
		_tmp21_ = g_strdup (_tmp20_);
		finish_name = _tmp21_;
		_tmp22_ = finish_name;
		if (g_str_has_suffix (_tmp22_, "_async")) {
			const gchar* _tmp23_;
			const gchar* _tmp24_;
			gint _tmp25_;
			gint _tmp26_;
			gint _tmp27_;
			gint _tmp28_;
			gchar* _tmp29_;
			_tmp23_ = finish_name;
			_tmp24_ = finish_name;
			_tmp25_ = strlen (_tmp24_);
			_tmp26_ = _tmp25_;
			_tmp27_ = strlen ("_async");
			_tmp28_ = _tmp27_;
			_tmp29_ = string_substring (_tmp23_, (glong) 0, (glong) (_tmp26_ - _tmp28_));
			_g_free0 (finish_name);
			finish_name = _tmp29_;
		}
		_tmp30_ = finish_name;
		_tmp31_ = g_strconcat (_tmp30_, "_finish", NULL);
		_g_free0 (finish_name);
		finish_name = _tmp31_;
		_tmp32_ = name;
		_tmp33_ = vala_get_ccode_name ((ValaCodeNode*) m);
		_tmp34_ = _tmp33_;
		_tmp35_ = vala_method_get_async_begin_parameters (m);
		_tmp36_ = _tmp35_;
		_tmp37_ = vala_void_type_new (NULL);
		_tmp38_ = _tmp37_;
		vala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp32_, _tmp34_, _tmp36_, (ValaDataType*) _tmp38_, FALSE, TRUE);
		_vala_code_node_unref0 (_tmp38_);
		_vala_iterable_unref0 (_tmp36_);
		_g_free0 (_tmp34_);
		_tmp39_ = finish_name;
		_tmp40_ = vala_get_ccode_finish_name (m);
		_tmp41_ = _tmp40_;
		_tmp42_ = vala_method_get_async_end_parameters (m);
		_tmp43_ = _tmp42_;
		_tmp44_ = vala_callable_get_return_type ((ValaCallable*) m);
		_tmp45_ = _tmp44_;
		_tmp46_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) m);
		_tmp47_ = _tmp46_;
		vala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp39_, _tmp41_, _tmp43_, _tmp45_, _tmp47_, FALSE);
		_vala_iterable_unref0 (_tmp43_);
		_g_free0 (_tmp41_);
		_g_free0 (finish_name);
	} else {
		const gchar* _tmp48_;
		gchar* _tmp49_;
		gchar* _tmp50_;
		ValaList* _tmp51_;
		ValaList* _tmp52_;
		ValaDataType* _tmp53_;
		ValaDataType* _tmp54_;
		gboolean _tmp55_;
		gboolean _tmp56_;
		_tmp48_ = name;
		_tmp49_ = vala_get_ccode_name ((ValaCodeNode*) m);
		_tmp50_ = _tmp49_;
		_tmp51_ = vala_callable_get_parameters ((ValaCallable*) m);
		_tmp52_ = _tmp51_;
		_tmp53_ = vala_callable_get_return_type ((ValaCallable*) m);
		_tmp54_ = _tmp53_;
		_tmp55_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) m);
		_tmp56_ = _tmp55_;
		vala_gir_writer_do_write_signature (self, m, tag_name, instance, _tmp48_, _tmp50_, _tmp52_, _tmp54_, _tmp56_, TRUE);
		_vala_iterable_unref0 (_tmp52_);
		_g_free0 (_tmp50_);
	}
	_g_free0 (name);
	_vala_code_node_unref0 (parent);
}


static void
vala_gir_writer_do_write_signature (ValaGIRWriter* self,
                                    ValaMethod* m,
                                    const gchar* tag_name,
                                    gboolean instance,
                                    const gchar* name,
                                    const gchar* cname,
                                    ValaList* params,
                                    ValaDataType* return_type,
                                    gboolean can_fail,
                                    gboolean write_comment)
{
	GString* _tmp0_;
	GString* _tmp5_;
	gint _tmp6_;
	gchar* return_comment = NULL;
	ValaDataType* instance_type = NULL;
	const gchar* _tmp13_;
	ValaDataType* _tmp14_;
	gint _tmp15_;
	GString* _tmp16_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (m != NULL);
	g_return_if_fail (tag_name != NULL);
	g_return_if_fail (name != NULL);
	g_return_if_fail (cname != NULL);
	g_return_if_fail (params != NULL);
	g_return_if_fail (return_type != NULL);
	vala_gir_writer_write_indent (self);
	_tmp0_ = self->priv->buffer;
	g_string_append_printf (_tmp0_, "<%s name=\"%s\"", tag_name, name);
	if (g_strcmp0 (tag_name, "virtual-method") == 0) {
		GString* _tmp1_;
		_tmp1_ = self->priv->buffer;
		g_string_append_printf (_tmp1_, " invoker=\"%s\"", name);
	} else {
		if (g_strcmp0 (tag_name, "callback") == 0) {
			GString* _tmp2_;
			_tmp2_ = self->priv->buffer;
			g_string_append_printf (_tmp2_, " c:type=\"%s\"", name);
		} else {
			GString* _tmp3_;
			_tmp3_ = self->priv->buffer;
			g_string_append_printf (_tmp3_, " c:identifier=\"%s\"", cname);
		}
	}
	if (can_fail) {
		GString* _tmp4_;
		_tmp4_ = self->priv->buffer;
		g_string_append_printf (_tmp4_, " throws=\"1\"");
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) m);
	_tmp5_ = self->priv->buffer;
	g_string_append_printf (_tmp5_, ">\n");
	_tmp6_ = self->priv->indent;
	self->priv->indent = _tmp6_ + 1;
	return_comment = NULL;
	if (write_comment) {
		gchar* _tmp7_;
		gchar* _tmp8_;
		gchar* _tmp9_;
		_tmp7_ = vala_gir_writer_get_method_return_comment (self, m);
		_g_free0 (return_comment);
		return_comment = _tmp7_;
		_tmp8_ = vala_gir_writer_get_method_comment (self, m);
		_tmp9_ = _tmp8_;
		vala_gir_writer_write_doc (self, _tmp9_);
		_g_free0 (_tmp9_);
	}
	instance_type = NULL;
	if (instance) {
		ValaSymbol* _tmp10_;
		ValaSymbol* _tmp11_;
		ValaDataType* _tmp12_;
		_tmp10_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
		_tmp11_ = _tmp10_;
		_tmp12_ = vala_ccode_base_module_get_data_type_for_symbol (G_TYPE_CHECK_INSTANCE_CAST (_tmp11_, VALA_TYPE_TYPESYMBOL, ValaTypeSymbol));
		_vala_code_node_unref0 (instance_type);
		instance_type = _tmp12_;
	}
	_tmp13_ = return_comment;
	_tmp14_ = instance_type;
	vala_gir_writer_write_params_and_return (self, params, return_type, vala_get_ccode_array_length ((ValaCodeNode*) m), _tmp13_, FALSE, _tmp14_, FALSE);
	_tmp15_ = self->priv->indent;
	self->priv->indent = _tmp15_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp16_ = self->priv->buffer;
	g_string_append_printf (_tmp16_, "</%s>\n", tag_name);
	_vala_code_node_unref0 (instance_type);
	_g_free0 (return_comment);
}


static void
vala_gir_writer_real_visit_creation_method (ValaCodeVisitor* base,
                                            ValaCreationMethod* m)
{
	ValaGIRWriter * self;
	gboolean _tmp0_;
	gboolean _tmp1_;
	gboolean _tmp2_ = FALSE;
	ValaSymbol* _tmp3_;
	ValaSymbol* _tmp4_;
	gboolean is_struct = FALSE;
	ValaSymbol* _tmp9_;
	ValaSymbol* _tmp10_;
	const gchar* _tmp11_ = NULL;
	gboolean _tmp12_;
	gchar* tag_name = NULL;
	gchar* _tmp13_;
	gboolean _tmp14_ = FALSE;
	gboolean _tmp15_ = FALSE;
	ValaSymbol* _tmp16_;
	ValaSymbol* _tmp17_;
	gboolean _tmp43_;
	gboolean _tmp44_;
	GString* _tmp46_;
	gint _tmp47_;
	gchar* _tmp48_;
	gchar* _tmp49_;
	ValaDataType* datatype = NULL;
	ValaSymbol* _tmp50_;
	ValaSymbol* _tmp51_;
	ValaDataType* _tmp52_;
	ValaList* _tmp53_;
	ValaList* _tmp54_;
	ValaDataType* _tmp55_;
	gchar* _tmp56_;
	gchar* _tmp57_;
	gint _tmp58_;
	GString* _tmp59_;
	const gchar* _tmp60_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (m != NULL);
	_tmp0_ = vala_symbol_get_external_package ((ValaSymbol*) m);
	_tmp1_ = _tmp0_;
	if (_tmp1_) {
		return;
	}
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) m)) {
		return;
	}
	_tmp3_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
	_tmp4_ = _tmp3_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_CLASS)) {
		ValaSymbol* _tmp5_;
		ValaSymbol* _tmp6_;
		gboolean _tmp7_;
		gboolean _tmp8_;
		_tmp5_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
		_tmp6_ = _tmp5_;
		_tmp7_ = vala_class_get_is_abstract (G_TYPE_CHECK_INSTANCE_CAST (_tmp6_, VALA_TYPE_CLASS, ValaClass));
		_tmp8_ = _tmp7_;
		_tmp2_ = _tmp8_;
	} else {
		_tmp2_ = FALSE;
	}
	if (_tmp2_) {
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp9_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
	_tmp10_ = _tmp9_;
	is_struct = G_TYPE_CHECK_INSTANCE_TYPE (_tmp10_, VALA_TYPE_STRUCT);
	_tmp12_ = is_struct;
	if (_tmp12_) {
		_tmp11_ = "function";
	} else {
		_tmp11_ = "constructor";
	}
	_tmp13_ = g_strdup (_tmp11_);
	tag_name = _tmp13_;
	_tmp16_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
	_tmp17_ = _tmp16_;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp17_, VALA_TYPE_CLASS)) {
		ValaSymbol* _tmp18_;
		ValaSymbol* _tmp19_;
		ValaCreationMethod* _tmp20_;
		ValaCreationMethod* _tmp21_;
		_tmp18_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
		_tmp19_ = _tmp18_;
		_tmp20_ = vala_class_get_default_construction_method (G_TYPE_CHECK_INSTANCE_CAST (_tmp19_, VALA_TYPE_CLASS, ValaClass));
		_tmp21_ = _tmp20_;
		_tmp15_ = m == _tmp21_;
	} else {
		_tmp15_ = FALSE;
	}
	if (_tmp15_) {
		_tmp14_ = TRUE;
	} else {
		gboolean _tmp22_ = FALSE;
		ValaSymbol* _tmp23_;
		ValaSymbol* _tmp24_;
		_tmp23_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
		_tmp24_ = _tmp23_;
		if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp24_, VALA_TYPE_STRUCT)) {
			ValaSymbol* _tmp25_;
			ValaSymbol* _tmp26_;
			ValaMethod* _tmp27_;
			ValaMethod* _tmp28_;
			_tmp25_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
			_tmp26_ = _tmp25_;
			_tmp27_ = vala_struct_get_default_construction_method (G_TYPE_CHECK_INSTANCE_CAST (_tmp26_, VALA_TYPE_STRUCT, ValaStruct));
			_tmp28_ = _tmp27_;
			_tmp22_ = G_TYPE_CHECK_INSTANCE_CAST (m, VALA_TYPE_METHOD, ValaMethod) == _tmp28_;
		} else {
			_tmp22_ = FALSE;
		}
		_tmp14_ = _tmp22_;
	}
	if (_tmp14_) {
		const gchar* _tmp29_ = NULL;
		gboolean _tmp30_;
		gchar* m_name = NULL;
		gchar* _tmp31_;
		GString* _tmp32_;
		const gchar* _tmp33_;
		const gchar* _tmp34_;
		gchar* _tmp35_;
		gchar* _tmp36_;
		_tmp30_ = is_struct;
		if (_tmp30_) {
			_tmp29_ = "init";
		} else {
			_tmp29_ = "new";
		}
		_tmp31_ = g_strdup (_tmp29_);
		m_name = _tmp31_;
		_tmp32_ = self->priv->buffer;
		_tmp33_ = tag_name;
		_tmp34_ = m_name;
		_tmp35_ = vala_get_ccode_name ((ValaCodeNode*) m);
		_tmp36_ = _tmp35_;
		g_string_append_printf (_tmp32_, "<%s name=\"%s\" c:identifier=\"%s\"", _tmp33_, _tmp34_, _tmp36_);
		_g_free0 (_tmp36_);
		_g_free0 (m_name);
	} else {
		GString* _tmp37_;
		const gchar* _tmp38_;
		const gchar* _tmp39_;
		const gchar* _tmp40_;
		gchar* _tmp41_;
		gchar* _tmp42_;
		_tmp37_ = self->priv->buffer;
		_tmp38_ = tag_name;
		_tmp39_ = vala_symbol_get_name ((ValaSymbol*) m);
		_tmp40_ = _tmp39_;
		_tmp41_ = vala_get_ccode_name ((ValaCodeNode*) m);
		_tmp42_ = _tmp41_;
		g_string_append_printf (_tmp37_, "<%s name=\"%s\" c:identifier=\"%s\"", _tmp38_, _tmp40_, _tmp42_);
		_g_free0 (_tmp42_);
	}
	_tmp43_ = vala_code_node_get_tree_can_fail ((ValaCodeNode*) m);
	_tmp44_ = _tmp43_;
	if (_tmp44_) {
		GString* _tmp45_;
		_tmp45_ = self->priv->buffer;
		g_string_append_printf (_tmp45_, " throws=\"1\"");
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) m);
	_tmp46_ = self->priv->buffer;
	g_string_append_printf (_tmp46_, ">\n");
	_tmp47_ = self->priv->indent;
	self->priv->indent = _tmp47_ + 1;
	_tmp48_ = vala_gir_writer_get_method_comment (self, (ValaMethod*) m);
	_tmp49_ = _tmp48_;
	vala_gir_writer_write_doc (self, _tmp49_);
	_g_free0 (_tmp49_);
	_tmp50_ = vala_symbol_get_parent_symbol ((ValaSymbol*) m);
	_tmp51_ = _tmp50_;
	_tmp52_ = vala_ccode_base_module_get_data_type_for_symbol (G_TYPE_CHECK_INSTANCE_CAST (_tmp51_, VALA_TYPE_TYPESYMBOL, ValaTypeSymbol));
	datatype = _tmp52_;
	_tmp53_ = vala_callable_get_parameters ((ValaCallable*) m);
	_tmp54_ = _tmp53_;
	_tmp55_ = datatype;
	_tmp56_ = vala_gir_writer_get_method_return_comment (self, (ValaMethod*) m);
	_tmp57_ = _tmp56_;
	vala_gir_writer_write_params_and_return (self, _tmp54_, _tmp55_, FALSE, _tmp57_, TRUE, NULL, FALSE);
	_g_free0 (_tmp57_);
	_vala_iterable_unref0 (_tmp54_);
	_tmp58_ = self->priv->indent;
	self->priv->indent = _tmp58_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp59_ = self->priv->buffer;
	_tmp60_ = tag_name;
	g_string_append_printf (_tmp59_, "</%s>\n", _tmp60_);
	_vala_code_node_unref0 (datatype);
	_g_free0 (tag_name);
}


static gchar*
string_replace (const gchar* self,
                const gchar* old,
                const gchar* replacement)
{
	gchar* result = NULL;
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	GError * _inner_error_ = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (old != NULL, NULL);
	g_return_val_if_fail (replacement != NULL, NULL);
	if ((*((gchar*) self)) == '\0') {
		_tmp1_ = TRUE;
	} else {
		_tmp1_ = (*((gchar*) old)) == '\0';
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		_tmp0_ = g_strcmp0 (old, replacement) == 0;
	}
	if (_tmp0_) {
		gchar* _tmp2_;
		_tmp2_ = g_strdup (self);
		result = _tmp2_;
		return result;
	}
	{
		GRegex* regex = NULL;
		gchar* _tmp3_;
		gchar* _tmp4_;
		GRegex* _tmp5_;
		GRegex* _tmp6_;
		gchar* _tmp7_ = NULL;
		GRegex* _tmp8_;
		gchar* _tmp9_;
		gchar* _tmp10_;
		_tmp3_ = g_regex_escape_string (old, -1);
		_tmp4_ = _tmp3_;
		_tmp5_ = g_regex_new (_tmp4_, 0, 0, &_inner_error_);
		_tmp6_ = _tmp5_;
		_g_free0 (_tmp4_);
		regex = _tmp6_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch6_g_regex_error;
			}
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		_tmp8_ = regex;
		_tmp9_ = g_regex_replace_literal (_tmp8_, self, (gssize) -1, 0, replacement, 0, &_inner_error_);
		_tmp7_ = _tmp9_;
		if (G_UNLIKELY (_inner_error_ != NULL)) {
			_g_regex_unref0 (regex);
			if (_inner_error_->domain == G_REGEX_ERROR) {
				goto __catch6_g_regex_error;
			}
			_g_regex_unref0 (regex);
			g_critical ("file %s: line %d: unexpected error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
			g_clear_error (&_inner_error_);
			return NULL;
		}
		_tmp10_ = _tmp7_;
		_tmp7_ = NULL;
		result = _tmp10_;
		_g_free0 (_tmp7_);
		_g_regex_unref0 (regex);
		return result;
	}
	goto __finally6;
	__catch6_g_regex_error:
	{
		GError* e = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		g_assert_not_reached ();
		_g_error_free0 (e);
	}
	__finally6:
	if (G_UNLIKELY (_inner_error_ != NULL)) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return NULL;
	}
}


static void
vala_gir_writer_real_visit_property (ValaCodeVisitor* base,
                                     ValaProperty* prop)
{
	ValaGIRWriter * self;
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	GString* _tmp12_;
	const gchar* _tmp13_;
	const gchar* _tmp14_;
	gchar* _tmp15_;
	gchar* _tmp16_;
	ValaPropertyAccessor* _tmp17_;
	ValaPropertyAccessor* _tmp18_;
	ValaPropertyAccessor* _tmp20_;
	ValaPropertyAccessor* _tmp21_;
	GString* _tmp33_;
	gint _tmp34_;
	gchar* _tmp35_;
	gchar* _tmp36_;
	ValaDataType* _tmp37_;
	ValaDataType* _tmp38_;
	gint _tmp39_;
	GString* _tmp40_;
	ValaPropertyAccessor* _tmp41_;
	ValaPropertyAccessor* _tmp42_;
	ValaPropertyAccessor* _tmp48_;
	ValaPropertyAccessor* _tmp49_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (prop != NULL);
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) prop)) {
		_tmp1_ = TRUE;
	} else {
		gboolean _tmp2_;
		gboolean _tmp3_;
		_tmp2_ = vala_property_get_overrides (prop);
		_tmp3_ = _tmp2_;
		_tmp1_ = _tmp3_;
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		gboolean _tmp4_ = FALSE;
		gboolean _tmp5_ = FALSE;
		ValaProperty* _tmp6_;
		ValaProperty* _tmp7_;
		_tmp6_ = vala_property_get_base_interface_property (prop);
		_tmp7_ = _tmp6_;
		if (_tmp7_ != NULL) {
			gboolean _tmp8_;
			gboolean _tmp9_;
			_tmp8_ = vala_property_get_is_abstract (prop);
			_tmp9_ = _tmp8_;
			_tmp5_ = !_tmp9_;
		} else {
			_tmp5_ = FALSE;
		}
		if (_tmp5_) {
			gboolean _tmp10_;
			gboolean _tmp11_;
			_tmp10_ = vala_property_get_is_virtual (prop);
			_tmp11_ = _tmp10_;
			_tmp4_ = !_tmp11_;
		} else {
			_tmp4_ = FALSE;
		}
		_tmp0_ = _tmp4_;
	}
	if (_tmp0_) {
		return;
	}
	vala_gir_writer_write_indent (self);
	_tmp12_ = self->priv->buffer;
	_tmp13_ = vala_symbol_get_name ((ValaSymbol*) prop);
	_tmp14_ = _tmp13_;
	_tmp15_ = string_replace (_tmp14_, "_", "-");
	_tmp16_ = _tmp15_;
	g_string_append_printf (_tmp12_, "<property name=\"%s\"", _tmp16_);
	_g_free0 (_tmp16_);
	_tmp17_ = vala_property_get_get_accessor (prop);
	_tmp18_ = _tmp17_;
	if (_tmp18_ == NULL) {
		GString* _tmp19_;
		_tmp19_ = self->priv->buffer;
		g_string_append_printf (_tmp19_, " readable=\"0\"");
	}
	_tmp20_ = vala_property_get_set_accessor (prop);
	_tmp21_ = _tmp20_;
	if (_tmp21_ != NULL) {
		GString* _tmp22_;
		ValaPropertyAccessor* _tmp23_;
		ValaPropertyAccessor* _tmp24_;
		gboolean _tmp25_;
		gboolean _tmp26_;
		_tmp22_ = self->priv->buffer;
		g_string_append_printf (_tmp22_, " writable=\"1\"");
		_tmp23_ = vala_property_get_set_accessor (prop);
		_tmp24_ = _tmp23_;
		_tmp25_ = vala_property_accessor_get_construction (_tmp24_);
		_tmp26_ = _tmp25_;
		if (_tmp26_) {
			ValaPropertyAccessor* _tmp27_;
			ValaPropertyAccessor* _tmp28_;
			gboolean _tmp29_;
			gboolean _tmp30_;
			_tmp27_ = vala_property_get_set_accessor (prop);
			_tmp28_ = _tmp27_;
			_tmp29_ = vala_property_accessor_get_writable (_tmp28_);
			_tmp30_ = _tmp29_;
			if (!_tmp30_) {
				GString* _tmp31_;
				_tmp31_ = self->priv->buffer;
				g_string_append_printf (_tmp31_, " construct-only=\"1\"");
			} else {
				GString* _tmp32_;
				_tmp32_ = self->priv->buffer;
				g_string_append_printf (_tmp32_, " construct=\"1\"");
			}
		}
	}
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) prop);
	_tmp33_ = self->priv->buffer;
	g_string_append_printf (_tmp33_, ">\n");
	_tmp34_ = self->priv->indent;
	self->priv->indent = _tmp34_ + 1;
	_tmp35_ = vala_gir_writer_get_property_comment (self, prop);
	_tmp36_ = _tmp35_;
	vala_gir_writer_write_doc (self, _tmp36_);
	_g_free0 (_tmp36_);
	_tmp37_ = vala_property_get_property_type (prop);
	_tmp38_ = _tmp37_;
	vala_gir_writer_write_type (self, _tmp38_, -1, VALA_PARAMETER_DIRECTION_IN);
	_tmp39_ = self->priv->indent;
	self->priv->indent = _tmp39_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp40_ = self->priv->buffer;
	g_string_append_printf (_tmp40_, "</property>\n");
	_tmp41_ = vala_property_get_get_accessor (prop);
	_tmp42_ = _tmp41_;
	if (_tmp42_ != NULL) {
		ValaMethod* m = NULL;
		ValaPropertyAccessor* _tmp43_;
		ValaPropertyAccessor* _tmp44_;
		ValaMethod* _tmp45_;
		ValaMethod* _tmp46_;
		_tmp43_ = vala_property_get_get_accessor (prop);
		_tmp44_ = _tmp43_;
		_tmp45_ = vala_property_accessor_get_method (_tmp44_);
		m = _tmp45_;
		_tmp46_ = m;
		if (_tmp46_ != NULL) {
			ValaMethod* _tmp47_;
			_tmp47_ = m;
			vala_code_visitor_visit_method ((ValaCodeVisitor*) self, _tmp47_);
		}
		_vala_code_node_unref0 (m);
	}
	_tmp48_ = vala_property_get_set_accessor (prop);
	_tmp49_ = _tmp48_;
	if (_tmp49_ != NULL) {
		ValaMethod* m = NULL;
		ValaPropertyAccessor* _tmp50_;
		ValaPropertyAccessor* _tmp51_;
		ValaMethod* _tmp52_;
		ValaMethod* _tmp53_;
		_tmp50_ = vala_property_get_set_accessor (prop);
		_tmp51_ = _tmp50_;
		_tmp52_ = vala_property_accessor_get_method (_tmp51_);
		m = _tmp52_;
		_tmp53_ = m;
		if (_tmp53_ != NULL) {
			ValaMethod* _tmp54_;
			_tmp54_ = m;
			vala_code_visitor_visit_method ((ValaCodeVisitor*) self, _tmp54_);
		}
		_vala_code_node_unref0 (m);
	}
}


static void
vala_gir_writer_real_visit_signal (ValaCodeVisitor* base,
                                   ValaSignal* sig)
{
	ValaGIRWriter * self;
	ValaMethod* _tmp0_;
	ValaMethod* _tmp1_;
	GString* _tmp4_;
	gchar* _tmp5_;
	gchar* _tmp6_;
	GString* _tmp7_;
	gint _tmp8_;
	gchar* _tmp9_;
	gchar* _tmp10_;
	ValaList* _tmp11_;
	ValaList* _tmp12_;
	ValaDataType* _tmp13_;
	ValaDataType* _tmp14_;
	gchar* _tmp15_;
	gchar* _tmp16_;
	gint _tmp17_;
	GString* _tmp18_;
	self = (ValaGIRWriter*) base;
	g_return_if_fail (sig != NULL);
	if (!vala_gir_writer_check_accessibility (self, (ValaSymbol*) sig)) {
		return;
	}
	_tmp0_ = vala_signal_get_emitter (sig);
	_tmp1_ = _tmp0_;
	if (_tmp1_ != NULL) {
		ValaMethod* _tmp2_;
		ValaMethod* _tmp3_;
		_tmp2_ = vala_signal_get_emitter (sig);
		_tmp3_ = _tmp2_;
		vala_code_node_accept ((ValaCodeNode*) _tmp3_, (ValaCodeVisitor*) self);
	}
	vala_gir_writer_write_indent (self);
	_tmp4_ = self->priv->buffer;
	_tmp5_ = vala_get_ccode_name ((ValaCodeNode*) sig);
	_tmp6_ = _tmp5_;
	g_string_append_printf (_tmp4_, "<glib:signal name=\"%s\"", _tmp6_);
	_g_free0 (_tmp6_);
	vala_gir_writer_write_symbol_attributes (self, (ValaSymbol*) sig);
	_tmp7_ = self->priv->buffer;
	g_string_append_printf (_tmp7_, ">\n");
	_tmp8_ = self->priv->indent;
	self->priv->indent = _tmp8_ + 1;
	_tmp9_ = vala_gir_writer_get_signal_comment (self, sig);
	_tmp10_ = _tmp9_;
	vala_gir_writer_write_doc (self, _tmp10_);
	_g_free0 (_tmp10_);
	_tmp11_ = vala_callable_get_parameters ((ValaCallable*) sig);
	_tmp12_ = _tmp11_;
	_tmp13_ = vala_callable_get_return_type ((ValaCallable*) sig);
	_tmp14_ = _tmp13_;
	_tmp15_ = vala_gir_writer_get_signal_return_comment (self, sig);
	_tmp16_ = _tmp15_;
	vala_gir_writer_write_params_and_return (self, _tmp12_, _tmp14_, FALSE, _tmp16_, FALSE, NULL, FALSE);
	_g_free0 (_tmp16_);
	_vala_iterable_unref0 (_tmp12_);
	_tmp17_ = self->priv->indent;
	self->priv->indent = _tmp17_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp18_ = self->priv->buffer;
	g_string_append_printf (_tmp18_, "</glib:signal>\n");
}


static void
vala_gir_writer_write_indent (ValaGIRWriter* self)
{
	gint i = 0;
	g_return_if_fail (self != NULL);
	{
		gboolean _tmp0_ = FALSE;
		i = 0;
		_tmp0_ = TRUE;
		while (TRUE) {
			gint _tmp2_;
			gint _tmp3_;
			GString* _tmp4_;
			if (!_tmp0_) {
				gint _tmp1_;
				_tmp1_ = i;
				i = _tmp1_ + 1;
			}
			_tmp0_ = FALSE;
			_tmp2_ = i;
			_tmp3_ = self->priv->indent;
			if (!(_tmp2_ < _tmp3_)) {
				break;
			}
			_tmp4_ = self->priv->buffer;
			g_string_append_c (_tmp4_, '\t');
		}
	}
}


static void
vala_gir_writer_write_indent_stream (ValaGIRWriter* self)
{
	gint i = 0;
	g_return_if_fail (self != NULL);
	{
		gboolean _tmp0_ = FALSE;
		i = 0;
		_tmp0_ = TRUE;
		while (TRUE) {
			gint _tmp2_;
			gint _tmp3_;
			FILE* _tmp4_;
			if (!_tmp0_) {
				gint _tmp1_;
				_tmp1_ = i;
				i = _tmp1_ + 1;
			}
			_tmp0_ = FALSE;
			_tmp2_ = i;
			_tmp3_ = self->priv->indent;
			if (!(_tmp2_ < _tmp3_)) {
				break;
			}
			_tmp4_ = self->priv->stream;
			fputc ('\t', _tmp4_);
		}
	}
}


static void
vala_gir_writer_write_param_or_return (ValaGIRWriter* self,
                                       ValaDataType* type,
                                       gboolean is_parameter,
                                       gint* index,
                                       gboolean has_array_length,
                                       const gchar* name,
                                       const gchar* comment,
                                       ValaParameterDirection direction,
                                       gboolean constructor,
                                       gboolean caller_allocates,
                                       gboolean ellipsis)
{
	const gchar* _tmp0_ = NULL;
	gchar* tag = NULL;
	gchar* _tmp1_;
	GString* _tmp2_;
	const gchar* _tmp3_;
	ValaDelegateType* delegate_type = NULL;
	ValaDelegateType* _tmp7_;
	gboolean _tmp8_ = FALSE;
	gboolean _tmp38_ = FALSE;
	gboolean _tmp42_ = FALSE;
	ValaDelegateType* _tmp43_;
	GString* _tmp66_;
	gint _tmp67_;
	gint _tmp71_;
	GString* _tmp72_;
	const gchar* _tmp73_;
	gint _tmp74_;
	g_return_if_fail (self != NULL);
	vala_gir_writer_write_indent (self);
	if (is_parameter) {
		_tmp0_ = "parameter";
	} else {
		_tmp0_ = "return-value";
	}
	_tmp1_ = g_strdup (_tmp0_);
	tag = _tmp1_;
	_tmp2_ = self->priv->buffer;
	_tmp3_ = tag;
	g_string_append_printf (_tmp2_, "<%s", _tmp3_);
	if (ellipsis) {
		name = "...";
	}
	if (name != NULL) {
		GString* _tmp4_;
		_tmp4_ = self->priv->buffer;
		g_string_append_printf (_tmp4_, " name=\"%s\"", name);
	}
	if (direction == VALA_PARAMETER_DIRECTION_REF) {
		GString* _tmp5_;
		_tmp5_ = self->priv->buffer;
		g_string_append_printf (_tmp5_, " direction=\"inout\"");
	} else {
		if (direction == VALA_PARAMETER_DIRECTION_OUT) {
			GString* _tmp6_;
			_tmp6_ = self->priv->buffer;
			g_string_append_printf (_tmp6_, " direction=\"out\"");
		}
	}
	_tmp7_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_DELEGATE_TYPE) ? ((ValaDelegateType*) type) : NULL);
	delegate_type = _tmp7_;
	if (type != NULL) {
		gboolean _tmp9_ = FALSE;
		gboolean _tmp10_ = FALSE;
		gboolean _tmp11_;
		gboolean _tmp12_;
		_tmp11_ = vala_data_type_get_value_owned (type);
		_tmp12_ = _tmp11_;
		if (_tmp12_) {
			ValaDelegateType* _tmp13_;
			_tmp13_ = delegate_type;
			_tmp10_ = _tmp13_ == NULL;
		} else {
			_tmp10_ = FALSE;
		}
		if (_tmp10_) {
			_tmp9_ = TRUE;
		} else {
			gboolean _tmp14_ = FALSE;
			if (constructor) {
				ValaTypeSymbol* _tmp15_;
				ValaTypeSymbol* _tmp16_;
				ValaTypeSymbol* _tmp17_;
				_tmp15_ = vala_data_type_get_data_type (type);
				_tmp16_ = _tmp15_;
				_tmp17_ = self->priv->ginitiallyunowned_type;
				_tmp14_ = !vala_typesymbol_is_subtype_of (_tmp16_, _tmp17_);
			} else {
				_tmp14_ = FALSE;
			}
			_tmp9_ = _tmp14_;
		}
		_tmp8_ = _tmp9_;
	} else {
		_tmp8_ = FALSE;
	}
	if (_tmp8_) {
		gboolean any_owned = FALSE;
		gboolean _tmp32_ = FALSE;
		any_owned = FALSE;
		{
			ValaList* _generic_arg_list = NULL;
			ValaList* _tmp18_;
			gint _generic_arg_size = 0;
			ValaList* _tmp19_;
			gint _tmp20_;
			gint _tmp21_;
			gint _generic_arg_index = 0;
			_tmp18_ = vala_data_type_get_type_arguments (type);
			_generic_arg_list = _tmp18_;
			_tmp19_ = _generic_arg_list;
			_tmp20_ = vala_collection_get_size ((ValaCollection*) _tmp19_);
			_tmp21_ = _tmp20_;
			_generic_arg_size = _tmp21_;
			_generic_arg_index = -1;
			while (TRUE) {
				gint _tmp22_;
				gint _tmp23_;
				gint _tmp24_;
				ValaDataType* generic_arg = NULL;
				ValaList* _tmp25_;
				gint _tmp26_;
				gpointer _tmp27_;
				gboolean _tmp28_;
				ValaDataType* _tmp29_;
				gboolean _tmp30_;
				gboolean _tmp31_;
				_tmp22_ = _generic_arg_index;
				_generic_arg_index = _tmp22_ + 1;
				_tmp23_ = _generic_arg_index;
				_tmp24_ = _generic_arg_size;
				if (!(_tmp23_ < _tmp24_)) {
					break;
				}
				_tmp25_ = _generic_arg_list;
				_tmp26_ = _generic_arg_index;
				_tmp27_ = vala_list_get (_tmp25_, _tmp26_);
				generic_arg = (ValaDataType*) _tmp27_;
				_tmp28_ = any_owned;
				_tmp29_ = generic_arg;
				_tmp30_ = vala_data_type_get_value_owned (_tmp29_);
				_tmp31_ = _tmp30_;
				any_owned = _tmp28_ | _tmp31_;
				_vala_code_node_unref0 (generic_arg);
			}
			_vala_iterable_unref0 (_generic_arg_list);
		}
		if (vala_data_type_has_type_arguments (type)) {
			gboolean _tmp33_;
			_tmp33_ = any_owned;
			_tmp32_ = !_tmp33_;
		} else {
			_tmp32_ = FALSE;
		}
		if (_tmp32_) {
			GString* _tmp34_;
			_tmp34_ = self->priv->buffer;
			g_string_append_printf (_tmp34_, " transfer-ownership=\"container\"");
		} else {
			GString* _tmp35_;
			_tmp35_ = self->priv->buffer;
			g_string_append_printf (_tmp35_, " transfer-ownership=\"full\"");
		}
	} else {
		GString* _tmp36_;
		_tmp36_ = self->priv->buffer;
		g_string_append_printf (_tmp36_, " transfer-ownership=\"none\"");
	}
	if (caller_allocates) {
		GString* _tmp37_;
		_tmp37_ = self->priv->buffer;
		g_string_append_printf (_tmp37_, " caller-allocates=\"1\"");
	}
	if (type != NULL) {
		gboolean _tmp39_;
		gboolean _tmp40_;
		_tmp39_ = vala_data_type_get_nullable (type);
		_tmp40_ = _tmp39_;
		_tmp38_ = _tmp40_;
	} else {
		_tmp38_ = FALSE;
	}
	if (_tmp38_) {
		GString* _tmp41_;
		_tmp41_ = self->priv->buffer;
		g_string_append_printf (_tmp41_, " allow-none=\"1\"");
	}
	_tmp43_ = delegate_type;
	if (_tmp43_ != NULL) {
		ValaDelegateType* _tmp44_;
		ValaDelegate* _tmp45_;
		ValaDelegate* _tmp46_;
		gboolean _tmp47_;
		gboolean _tmp48_;
		_tmp44_ = delegate_type;
		_tmp45_ = vala_delegate_type_get_delegate_symbol (_tmp44_);
		_tmp46_ = _tmp45_;
		_tmp47_ = vala_delegate_get_has_target (_tmp46_);
		_tmp48_ = _tmp47_;
		_tmp42_ = _tmp48_;
	} else {
		_tmp42_ = FALSE;
	}
	if (_tmp42_) {
		gint _tmp49_ = 0;
		gint closure_index = 0;
		GString* _tmp53_;
		gint _tmp54_;
		ValaDelegateType* _tmp55_;
		gboolean _tmp56_;
		gboolean _tmp57_;
		if (is_parameter) {
			_tmp49_ = (*index) + 1;
		} else {
			gint _tmp50_ = 0;
			gboolean _tmp51_;
			gboolean _tmp52_;
			_tmp51_ = vala_data_type_get_value_owned (type);
			_tmp52_ = _tmp51_;
			if (_tmp52_) {
				_tmp50_ = (*index) - 1;
			} else {
				_tmp50_ = *index;
			}
			_tmp49_ = _tmp50_;
		}
		closure_index = _tmp49_;
		_tmp53_ = self->priv->buffer;
		_tmp54_ = closure_index;
		g_string_append_printf (_tmp53_, " closure=\"%i\"", _tmp54_);
		_tmp55_ = delegate_type;
		_tmp56_ = vala_delegate_type_get_is_called_once (_tmp55_);
		_tmp57_ = _tmp56_;
		if (_tmp57_) {
			GString* _tmp58_;
			_tmp58_ = self->priv->buffer;
			g_string_append (_tmp58_, " scope=\"async\"");
		} else {
			gboolean _tmp59_;
			gboolean _tmp60_;
			_tmp59_ = vala_data_type_get_value_owned (type);
			_tmp60_ = _tmp59_;
			if (_tmp60_) {
				GString* _tmp61_;
				gint _tmp62_;
				_tmp61_ = self->priv->buffer;
				_tmp62_ = closure_index;
				g_string_append_printf (_tmp61_, " scope=\"notified\" destroy=\"%i\"", _tmp62_ + 1);
			} else {
				GString* _tmp63_;
				_tmp63_ = self->priv->buffer;
				g_string_append (_tmp63_, " scope=\"call\"");
			}
		}
	} else {
		ValaDelegateType* _tmp64_;
		_tmp64_ = delegate_type;
		if (_tmp64_ != NULL) {
			GString* _tmp65_;
			_tmp65_ = self->priv->buffer;
			g_string_append (_tmp65_, " scope=\"call\"");
		}
	}
	_tmp66_ = self->priv->buffer;
	g_string_append_printf (_tmp66_, ">\n");
	_tmp67_ = self->priv->indent;
	self->priv->indent = _tmp67_ + 1;
	vala_gir_writer_write_doc (self, comment);
	if (ellipsis) {
		GString* _tmp68_;
		vala_gir_writer_write_indent (self);
		_tmp68_ = self->priv->buffer;
		g_string_append (_tmp68_, "<varargs/>\n");
	} else {
		if (type != NULL) {
			gint length_param_index = 0;
			gint _tmp70_;
			length_param_index = -1;
			if (has_array_length) {
				gint _tmp69_ = 0;
				if (is_parameter) {
					_tmp69_ = (*index) + 1;
				} else {
					_tmp69_ = *index;
				}
				length_param_index = _tmp69_;
			}
			_tmp70_ = length_param_index;
			vala_gir_writer_write_type (self, type, _tmp70_, direction);
		}
	}
	_tmp71_ = self->priv->indent;
	self->priv->indent = _tmp71_ - 1;
	vala_gir_writer_write_indent (self);
	_tmp72_ = self->priv->buffer;
	_tmp73_ = tag;
	g_string_append_printf (_tmp72_, "</%s>\n", _tmp73_);
	_tmp74_ = *index;
	*index = _tmp74_ + 1;
	_vala_code_node_unref0 (delegate_type);
	_g_free0 (tag);
}


static void
vala_gir_writer_write_ctype_attributes (ValaGIRWriter* self,
                                        ValaTypeSymbol* symbol,
                                        const gchar* suffix)
{
	GString* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	g_return_if_fail (suffix != NULL);
	_tmp0_ = self->priv->buffer;
	_tmp1_ = vala_get_ccode_name ((ValaCodeNode*) symbol);
	_tmp2_ = _tmp1_;
	g_string_append_printf (_tmp0_, " c:type=\"%s%s\"", _tmp2_, suffix);
	_g_free0 (_tmp2_);
}


static void
vala_gir_writer_write_gtype_attributes (ValaGIRWriter* self,
                                        ValaTypeSymbol* symbol)
{
	GString* _tmp0_;
	gchar* _tmp1_;
	gchar* _tmp2_;
	GString* _tmp3_;
	gchar* _tmp4_;
	gchar* _tmp5_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (symbol != NULL);
	vala_gir_writer_write_ctype_attributes (self, symbol, "");
	_tmp0_ = self->priv->buffer;
	_tmp1_ = vala_get_ccode_name ((ValaCodeNode*) symbol);
	_tmp2_ = _tmp1_;
	g_string_append_printf (_tmp0_, " glib:type-name=\"%s\"", _tmp2_);
	_g_free0 (_tmp2_);
	_tmp3_ = self->priv->buffer;
	_tmp4_ = vala_get_ccode_lower_case_prefix ((ValaSymbol*) symbol);
	_tmp5_ = _tmp4_;
	g_string_append_printf (_tmp3_, " glib:get-type=\"%sget_type\"", _tmp5_);
	_g_free0 (_tmp5_);
}


static void
vala_gir_writer_write_type (ValaGIRWriter* self,
                            ValaDataType* type,
                            gint index,
                            ValaParameterDirection direction)
{
	g_return_if_fail (self != NULL);
	g_return_if_fail (type != NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_ARRAY_TYPE)) {
		ValaArrayType* array_type = NULL;
		ValaArrayType* _tmp0_;
		GString* _tmp1_;
		gboolean _tmp2_ = FALSE;
		ValaArrayType* _tmp3_;
		gboolean _tmp4_;
		gboolean _tmp5_;
		GString* _tmp18_;
		gint _tmp19_;
		ValaArrayType* _tmp20_;
		ValaDataType* _tmp21_;
		ValaDataType* _tmp22_;
		gint _tmp23_;
		GString* _tmp24_;
		_tmp0_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_ARRAY_TYPE, ValaArrayType));
		array_type = _tmp0_;
		vala_gir_writer_write_indent (self);
		_tmp1_ = self->priv->buffer;
		g_string_append_printf (_tmp1_, "<array");
		_tmp3_ = array_type;
		_tmp4_ = vala_array_type_get_fixed_length (_tmp3_);
		_tmp5_ = _tmp4_;
		if (_tmp5_) {
			ValaArrayType* _tmp6_;
			ValaExpression* _tmp7_;
			ValaExpression* _tmp8_;
			_tmp6_ = array_type;
			_tmp7_ = vala_array_type_get_length (_tmp6_);
			_tmp8_ = _tmp7_;
			_tmp2_ = G_TYPE_CHECK_INSTANCE_TYPE (_tmp8_, VALA_TYPE_INTEGER_LITERAL);
		} else {
			_tmp2_ = FALSE;
		}
		if (_tmp2_) {
			ValaIntegerLiteral* lit = NULL;
			ValaArrayType* _tmp9_;
			ValaExpression* _tmp10_;
			ValaExpression* _tmp11_;
			ValaIntegerLiteral* _tmp12_;
			GString* _tmp13_;
			ValaIntegerLiteral* _tmp14_;
			const gchar* _tmp15_;
			const gchar* _tmp16_;
			_tmp9_ = array_type;
			_tmp10_ = vala_array_type_get_length (_tmp9_);
			_tmp11_ = _tmp10_;
			_tmp12_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (_tmp11_, VALA_TYPE_INTEGER_LITERAL, ValaIntegerLiteral));
			lit = _tmp12_;
			_tmp13_ = self->priv->buffer;
			_tmp14_ = lit;
			_tmp15_ = vala_integer_literal_get_value (_tmp14_);
			_tmp16_ = _tmp15_;
			g_string_append_printf (_tmp13_, " fixed-size=\"%i\"", atoi (_tmp16_));
			_vala_code_node_unref0 (lit);
		} else {
			if (index != -1) {
				GString* _tmp17_;
				_tmp17_ = self->priv->buffer;
				g_string_append_printf (_tmp17_, " length=\"%i\"", index);
			}
		}
		_tmp18_ = self->priv->buffer;
		g_string_append_printf (_tmp18_, ">\n");
		_tmp19_ = self->priv->indent;
		self->priv->indent = _tmp19_ + 1;
		_tmp20_ = array_type;
		_tmp21_ = vala_array_type_get_element_type (_tmp20_);
		_tmp22_ = _tmp21_;
		vala_gir_writer_write_type (self, _tmp22_, -1, VALA_PARAMETER_DIRECTION_IN);
		_tmp23_ = self->priv->indent;
		self->priv->indent = _tmp23_ - 1;
		vala_gir_writer_write_indent (self);
		_tmp24_ = self->priv->buffer;
		g_string_append_printf (_tmp24_, "</array>\n");
		_vala_code_node_unref0 (array_type);
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_VOID_TYPE)) {
			GString* _tmp25_;
			vala_gir_writer_write_indent (self);
			_tmp25_ = self->priv->buffer;
			g_string_append_printf (_tmp25_, "<type name=\"none\"/>\n");
		} else {
			if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_POINTER_TYPE)) {
				GString* _tmp26_;
				gchar* _tmp27_;
				gchar* _tmp28_;
				vala_gir_writer_write_indent (self);
				_tmp26_ = self->priv->buffer;
				_tmp27_ = vala_get_ccode_name ((ValaCodeNode*) type);
				_tmp28_ = _tmp27_;
				g_string_append_printf (_tmp26_, "<type name=\"gpointer\" c:type=\"%s\"/>\n", _tmp28_);
				_g_free0 (_tmp28_);
			} else {
				ValaTypeSymbol* _tmp29_;
				ValaTypeSymbol* _tmp30_;
				_tmp29_ = vala_data_type_get_data_type (type);
				_tmp30_ = _tmp29_;
				if (_tmp30_ != NULL) {
					gchar* type_name = NULL;
					ValaTypeSymbol* _tmp31_;
					ValaTypeSymbol* _tmp32_;
					gchar* _tmp33_;
					gboolean is_array = FALSE;
					gboolean _tmp34_ = FALSE;
					const gchar* _tmp35_;
					const gchar* _tmp37_ = NULL;
					gboolean _tmp38_;
					const gchar* _tmp39_ = NULL;
					GString* _tmp40_;
					ValaTypeSymbol* _tmp41_;
					ValaTypeSymbol* _tmp42_;
					gchar* _tmp43_;
					gchar* _tmp44_;
					gchar* _tmp45_;
					gchar* _tmp46_;
					ValaList* type_arguments = NULL;
					ValaList* _tmp47_;
					ValaList* _tmp48_;
					gint _tmp49_;
					gint _tmp50_;
					vala_gir_writer_write_indent (self);
					_tmp31_ = vala_data_type_get_data_type (type);
					_tmp32_ = _tmp31_;
					_tmp33_ = vala_gir_writer_gi_type_name (self, _tmp32_);
					type_name = _tmp33_;
					is_array = FALSE;
					_tmp35_ = type_name;
					if (g_strcmp0 (_tmp35_, "GLib.Array") == 0) {
						_tmp34_ = TRUE;
					} else {
						const gchar* _tmp36_;
						_tmp36_ = type_name;
						_tmp34_ = g_strcmp0 (_tmp36_, "GLib.PtrArray") == 0;
					}
					if (_tmp34_) {
						is_array = TRUE;
					}
					_tmp38_ = is_array;
					if (_tmp38_) {
						_tmp37_ = "array";
					} else {
						_tmp37_ = "type";
					}
					if (direction == VALA_PARAMETER_DIRECTION_IN) {
						_tmp39_ = "";
					} else {
						_tmp39_ = "*";
					}
					_tmp40_ = self->priv->buffer;
					_tmp41_ = vala_data_type_get_data_type (type);
					_tmp42_ = _tmp41_;
					_tmp43_ = vala_gir_writer_gi_type_name (self, _tmp42_);
					_tmp44_ = _tmp43_;
					_tmp45_ = vala_get_ccode_name ((ValaCodeNode*) type);
					_tmp46_ = _tmp45_;
					g_string_append_printf (_tmp40_, "<%s name=\"%s\" c:type=\"%s%s\"", _tmp37_, _tmp44_, _tmp46_, _tmp39_);
					_g_free0 (_tmp46_);
					_g_free0 (_tmp44_);
					_tmp47_ = vala_data_type_get_type_arguments (type);
					type_arguments = _tmp47_;
					_tmp48_ = type_arguments;
					_tmp49_ = vala_collection_get_size ((ValaCollection*) _tmp48_);
					_tmp50_ = _tmp49_;
					if (_tmp50_ == 0) {
						GString* _tmp51_;
						_tmp51_ = self->priv->buffer;
						g_string_append_printf (_tmp51_, "/>\n");
					} else {
						GString* _tmp52_;
						gint _tmp53_;
						gint _tmp66_;
						const gchar* _tmp67_ = NULL;
						gboolean _tmp68_;
						GString* _tmp69_;
						_tmp52_ = self->priv->buffer;
						g_string_append_printf (_tmp52_, ">\n");
						_tmp53_ = self->priv->indent;
						self->priv->indent = _tmp53_ + 1;
						{
							ValaList* _type_argument_list = NULL;
							ValaList* _tmp54_;
							ValaList* _tmp55_;
							gint _type_argument_size = 0;
							ValaList* _tmp56_;
							gint _tmp57_;
							gint _tmp58_;
							gint _type_argument_index = 0;
							_tmp54_ = type_arguments;
							_tmp55_ = _vala_iterable_ref0 (_tmp54_);
							_type_argument_list = _tmp55_;
							_tmp56_ = _type_argument_list;
							_tmp57_ = vala_collection_get_size ((ValaCollection*) _tmp56_);
							_tmp58_ = _tmp57_;
							_type_argument_size = _tmp58_;
							_type_argument_index = -1;
							while (TRUE) {
								gint _tmp59_;
								gint _tmp60_;
								gint _tmp61_;
								ValaDataType* type_argument = NULL;
								ValaList* _tmp62_;
								gint _tmp63_;
								gpointer _tmp64_;
								ValaDataType* _tmp65_;
								_tmp59_ = _type_argument_index;
								_type_argument_index = _tmp59_ + 1;
								_tmp60_ = _type_argument_index;
								_tmp61_ = _type_argument_size;
								if (!(_tmp60_ < _tmp61_)) {
									break;
								}
								_tmp62_ = _type_argument_list;
								_tmp63_ = _type_argument_index;
								_tmp64_ = vala_list_get (_tmp62_, _tmp63_);
								type_argument = (ValaDataType*) _tmp64_;
								_tmp65_ = type_argument;
								vala_gir_writer_write_type (self, _tmp65_, -1, VALA_PARAMETER_DIRECTION_IN);
								_vala_code_node_unref0 (type_argument);
							}
							_vala_iterable_unref0 (_type_argument_list);
						}
						_tmp66_ = self->priv->indent;
						self->priv->indent = _tmp66_ - 1;
						vala_gir_writer_write_indent (self);
						_tmp68_ = is_array;
						if (_tmp68_) {
							_tmp67_ = "array";
						} else {
							_tmp67_ = "type";
						}
						_tmp69_ = self->priv->buffer;
						g_string_append_printf (_tmp69_, "</%s>\n", _tmp67_);
					}
					_vala_iterable_unref0 (type_arguments);
					_g_free0 (type_name);
				} else {
					if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_DELEGATE_TYPE)) {
						ValaDelegateType* deleg_type = NULL;
						ValaDelegateType* _tmp70_;
						GString* _tmp71_;
						ValaDelegateType* _tmp72_;
						ValaDelegate* _tmp73_;
						ValaDelegate* _tmp74_;
						gchar* _tmp75_;
						gchar* _tmp76_;
						gchar* _tmp77_;
						gchar* _tmp78_;
						_tmp70_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (type, VALA_TYPE_DELEGATE_TYPE, ValaDelegateType));
						deleg_type = _tmp70_;
						vala_gir_writer_write_indent (self);
						_tmp71_ = self->priv->buffer;
						_tmp72_ = deleg_type;
						_tmp73_ = vala_delegate_type_get_delegate_symbol (_tmp72_);
						_tmp74_ = _tmp73_;
						_tmp75_ = vala_gir_writer_gi_type_name (self, (ValaTypeSymbol*) _tmp74_);
						_tmp76_ = _tmp75_;
						_tmp77_ = vala_get_ccode_name ((ValaCodeNode*) type);
						_tmp78_ = _tmp77_;
						g_string_append_printf (_tmp71_, "<type name=\"%s\" c:type=\"%s\"/>\n", _tmp76_, _tmp78_);
						_g_free0 (_tmp78_);
						_g_free0 (_tmp76_);
						_vala_code_node_unref0 (deleg_type);
					} else {
						if (G_TYPE_CHECK_INSTANCE_TYPE (type, VALA_TYPE_GENERIC_TYPE)) {
							GString* _tmp79_;
							vala_gir_writer_write_indent (self);
							_tmp79_ = self->priv->buffer;
							g_string_append (_tmp79_, "<type name=\"gpointer\" c:type=\"gpointer\"/>\n");
						} else {
							GString* _tmp80_;
							gchar* _tmp81_;
							gchar* _tmp82_;
							vala_gir_writer_write_indent (self);
							_tmp80_ = self->priv->buffer;
							_tmp81_ = vala_code_node_to_string ((ValaCodeNode*) type);
							_tmp82_ = _tmp81_;
							g_string_append_printf (_tmp80_, "<type name=\"%s\"/>\n", _tmp82_);
							_g_free0 (_tmp82_);
						}
					}
				}
			}
		}
	}
}


static gboolean
string_contains (const gchar* self,
                 const gchar* needle)
{
	gboolean result = FALSE;
	gchar* _tmp0_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (needle != NULL, FALSE);
	_tmp0_ = strstr ((gchar*) self, (gchar*) needle);
	result = _tmp0_ != NULL;
	return result;
}


static gchar*
vala_gir_writer_get_full_gir_name (ValaGIRWriter* self,
                                   ValaSymbol* sym)
{
	gchar* result = NULL;
	gchar* gir_fullname = NULL;
	gchar* _tmp0_;
	const gchar* _tmp1_;
	gchar* gir_name = NULL;
	gchar* _tmp2_;
	gboolean _tmp3_ = FALSE;
	const gchar* _tmp4_;
	const gchar* _tmp6_;
	ValaSymbol* _tmp10_;
	ValaSymbol* _tmp11_;
	const gchar* _tmp12_;
	const gchar* _tmp13_;
	gchar* parent_gir_name = NULL;
	ValaSymbol* _tmp17_;
	ValaSymbol* _tmp18_;
	gchar* _tmp19_;
	const gchar* _tmp20_;
	gchar* _tmp21_ = NULL;
	const gchar* _tmp22_;
	gchar* self_gir_name = NULL;
	gchar* _tmp27_;
	const gchar* _tmp28_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (sym != NULL, NULL);
	_tmp0_ = vala_code_node_get_attribute_string ((ValaCodeNode*) sym, "GIR", "fullname", NULL);
	gir_fullname = _tmp0_;
	_tmp1_ = gir_fullname;
	if (_tmp1_ != NULL) {
		result = gir_fullname;
		return result;
	}
	_tmp2_ = vala_code_node_get_attribute_string ((ValaCodeNode*) sym, "GIR", "name", NULL);
	gir_name = _tmp2_;
	_tmp4_ = gir_name;
	if (_tmp4_ == NULL) {
		_tmp3_ = G_TYPE_CHECK_INSTANCE_TYPE (sym, VALA_TYPE_NAMESPACE);
	} else {
		_tmp3_ = FALSE;
	}
	if (_tmp3_) {
		gchar* _tmp5_;
		_tmp5_ = vala_code_node_get_attribute_string ((ValaCodeNode*) sym, "CCode", "gir_namespace", NULL);
		_g_free0 (gir_name);
		gir_name = _tmp5_;
	}
	_tmp6_ = gir_name;
	if (_tmp6_ == NULL) {
		const gchar* _tmp7_;
		const gchar* _tmp8_;
		gchar* _tmp9_;
		_tmp7_ = vala_symbol_get_name (sym);
		_tmp8_ = _tmp7_;
		_tmp9_ = g_strdup (_tmp8_);
		_g_free0 (gir_name);
		gir_name = _tmp9_;
	}
	_tmp10_ = vala_symbol_get_parent_symbol (sym);
	_tmp11_ = _tmp10_;
	if (_tmp11_ == NULL) {
		result = gir_name;
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp12_ = vala_symbol_get_name (sym);
	_tmp13_ = _tmp12_;
	if (_tmp13_ == NULL) {
		ValaSymbol* _tmp14_;
		ValaSymbol* _tmp15_;
		gchar* _tmp16_;
		_tmp14_ = vala_symbol_get_parent_symbol (sym);
		_tmp15_ = _tmp14_;
		_tmp16_ = vala_gir_writer_get_full_gir_name (self, _tmp15_);
		result = _tmp16_;
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp17_ = vala_symbol_get_parent_symbol (sym);
	_tmp18_ = _tmp17_;
	_tmp19_ = vala_gir_writer_get_full_gir_name (self, _tmp18_);
	parent_gir_name = _tmp19_;
	_tmp20_ = parent_gir_name;
	if (_tmp20_ == NULL) {
		result = gir_name;
		_g_free0 (parent_gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_tmp22_ = gir_name;
	if (g_str_has_prefix (_tmp22_, ".")) {
		const gchar* _tmp23_;
		gchar* _tmp24_;
		_tmp23_ = gir_name;
		_tmp24_ = string_substring (_tmp23_, (glong) 1, (glong) -1);
		_g_free0 (_tmp21_);
		_tmp21_ = _tmp24_;
	} else {
		const gchar* _tmp25_;
		gchar* _tmp26_;
		_tmp25_ = gir_name;
		_tmp26_ = g_strdup (_tmp25_);
		_g_free0 (_tmp21_);
		_tmp21_ = _tmp26_;
	}
	_tmp27_ = g_strdup (_tmp21_);
	self_gir_name = _tmp27_;
	_tmp28_ = parent_gir_name;
	if (string_contains (_tmp28_, ".")) {
		const gchar* _tmp29_;
		const gchar* _tmp30_;
		gchar* _tmp31_;
		_tmp29_ = parent_gir_name;
		_tmp30_ = self_gir_name;
		_tmp31_ = g_strdup_printf ("%s%s", _tmp29_, _tmp30_);
		result = _tmp31_;
		_g_free0 (self_gir_name);
		_g_free0 (_tmp21_);
		_g_free0 (parent_gir_name);
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	} else {
		const gchar* _tmp32_;
		const gchar* _tmp33_;
		gchar* _tmp34_;
		_tmp32_ = parent_gir_name;
		_tmp33_ = self_gir_name;
		_tmp34_ = g_strdup_printf ("%s.%s", _tmp32_, _tmp33_);
		result = _tmp34_;
		_g_free0 (self_gir_name);
		_g_free0 (_tmp21_);
		_g_free0 (parent_gir_name);
		_g_free0 (gir_name);
		_g_free0 (gir_fullname);
		return result;
	}
	_g_free0 (self_gir_name);
	_g_free0 (_tmp21_);
	_g_free0 (parent_gir_name);
	_g_free0 (gir_name);
	_g_free0 (gir_fullname);
}


static gchar*
vala_gir_writer_gi_type_name (ValaGIRWriter* self,
                              ValaTypeSymbol* type_symbol)
{
	gchar* result = NULL;
	ValaSymbol* parent = NULL;
	ValaSymbol* _tmp0_;
	ValaSymbol* _tmp1_;
	ValaSymbol* _tmp2_;
	ValaSymbol* _tmp3_;
	gchar* _tmp55_;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (type_symbol != NULL, NULL);
	_tmp0_ = vala_symbol_get_parent_symbol ((ValaSymbol*) type_symbol);
	_tmp1_ = _tmp0_;
	_tmp2_ = _vala_code_node_ref0 (_tmp1_);
	parent = _tmp2_;
	_tmp3_ = parent;
	if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp3_, VALA_TYPE_NAMESPACE)) {
		ValaNamespace* ns = NULL;
		ValaSymbol* _tmp4_;
		ValaNamespace* _tmp5_;
		gchar* _tmp6_ = NULL;
		ValaNamespace* _tmp7_;
		gchar* _tmp8_;
		gchar* ns_gir_name = NULL;
		gchar* _tmp13_;
		const gchar* _tmp14_;
		_tmp4_ = parent;
		_tmp5_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (_tmp4_, VALA_TYPE_NAMESPACE) ? ((ValaNamespace*) _tmp4_) : NULL);
		ns = _tmp5_;
		_tmp7_ = ns;
		_tmp8_ = vala_code_node_get_attribute_string ((ValaCodeNode*) _tmp7_, "GIR", "name", NULL);
		_tmp6_ = _tmp8_;
		if (_tmp6_ == NULL) {
			ValaNamespace* _tmp9_;
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			gchar* _tmp12_;
			_tmp9_ = ns;
			_tmp10_ = vala_symbol_get_name ((ValaSymbol*) _tmp9_);
			_tmp11_ = _tmp10_;
			_tmp12_ = g_strdup (_tmp11_);
			_g_free0 (_tmp6_);
			_tmp6_ = _tmp12_;
		}
		_tmp13_ = g_strdup (_tmp6_);
		ns_gir_name = _tmp13_;
		_tmp14_ = ns_gir_name;
		if (_tmp14_ != NULL) {
			ValaSourceReference* _tmp15_;
			ValaSourceReference* _tmp16_;
			ValaSourceFile* _tmp17_;
			ValaSourceFile* _tmp18_;
			const gchar* _tmp19_;
			const gchar* _tmp20_;
			_tmp15_ = vala_code_node_get_source_reference ((ValaCodeNode*) type_symbol);
			_tmp16_ = _tmp15_;
			_tmp17_ = vala_source_reference_get_file (_tmp16_);
			_tmp18_ = _tmp17_;
			_tmp19_ = vala_source_file_get_gir_namespace (_tmp18_);
			_tmp20_ = _tmp19_;
			if (_tmp20_ != NULL) {
				ValaGIRWriterGIRNamespace external = {0};
				ValaSourceReference* _tmp21_;
				ValaSourceReference* _tmp22_;
				ValaSourceFile* _tmp23_;
				ValaSourceFile* _tmp24_;
				const gchar* _tmp25_;
				const gchar* _tmp26_;
				ValaSourceReference* _tmp27_;
				ValaSourceReference* _tmp28_;
				ValaSourceFile* _tmp29_;
				ValaSourceFile* _tmp30_;
				const gchar* _tmp31_;
				const gchar* _tmp32_;
				ValaArrayList* _tmp33_;
				ValaGIRWriterGIRNamespace _tmp34_;
				gchar* gir_fullname = NULL;
				gchar* _tmp37_;
				const gchar* _tmp38_;
				gchar* _tmp39_ = NULL;
				gchar* _tmp40_;
				gchar* type_name = NULL;
				gchar* _tmp44_;
				ValaSourceReference* _tmp45_;
				ValaSourceReference* _tmp46_;
				ValaSourceFile* _tmp47_;
				ValaSourceFile* _tmp48_;
				const gchar* _tmp49_;
				const gchar* _tmp50_;
				const gchar* _tmp51_;
				gchar* _tmp52_;
				_tmp21_ = vala_code_node_get_source_reference ((ValaCodeNode*) type_symbol);
				_tmp22_ = _tmp21_;
				_tmp23_ = vala_source_reference_get_file (_tmp22_);
				_tmp24_ = _tmp23_;
				_tmp25_ = vala_source_file_get_gir_namespace (_tmp24_);
				_tmp26_ = _tmp25_;
				_tmp27_ = vala_code_node_get_source_reference ((ValaCodeNode*) type_symbol);
				_tmp28_ = _tmp27_;
				_tmp29_ = vala_source_reference_get_file (_tmp28_);
				_tmp30_ = _tmp29_;
				_tmp31_ = vala_source_file_get_gir_version (_tmp30_);
				_tmp32_ = _tmp31_;
				vala_gir_writer_gir_namespace_init (&external, _tmp26_, _tmp32_);
				_tmp33_ = self->priv->externals;
				_tmp34_ = external;
				if (!vala_collection_contains ((ValaCollection*) _tmp33_, &_tmp34_)) {
					ValaArrayList* _tmp35_;
					ValaGIRWriterGIRNamespace _tmp36_;
					_tmp35_ = self->priv->externals;
					_tmp36_ = external;
					vala_collection_add ((ValaCollection*) _tmp35_, &_tmp36_);
				}
				_tmp37_ = vala_code_node_get_attribute_string ((ValaCodeNode*) type_symbol, "GIR", "fullname", NULL);
				gir_fullname = _tmp37_;
				_tmp38_ = gir_fullname;
				if (_tmp38_ != NULL) {
					result = gir_fullname;
					vala_gir_writer_gir_namespace_destroy (&external);
					_g_free0 (ns_gir_name);
					_g_free0 (_tmp6_);
					_vala_code_node_unref0 (ns);
					_vala_code_node_unref0 (parent);
					return result;
				}
				_tmp40_ = vala_code_node_get_attribute_string ((ValaCodeNode*) type_symbol, "GIR", "name", NULL);
				_tmp39_ = _tmp40_;
				if (_tmp39_ == NULL) {
					const gchar* _tmp41_;
					const gchar* _tmp42_;
					gchar* _tmp43_;
					_tmp41_ = vala_symbol_get_name ((ValaSymbol*) type_symbol);
					_tmp42_ = _tmp41_;
					_tmp43_ = g_strdup (_tmp42_);
					_g_free0 (_tmp39_);
					_tmp39_ = _tmp43_;
				}
				_tmp44_ = g_strdup (_tmp39_);
				type_name = _tmp44_;
				_tmp45_ = vala_code_node_get_source_reference ((ValaCodeNode*) type_symbol);
				_tmp46_ = _tmp45_;
				_tmp47_ = vala_source_reference_get_file (_tmp46_);
				_tmp48_ = _tmp47_;
				_tmp49_ = vala_source_file_get_gir_namespace (_tmp48_);
				_tmp50_ = _tmp49_;
				_tmp51_ = type_name;
				_tmp52_ = g_strdup_printf ("%s.%s", _tmp50_, _tmp51_);
				result = _tmp52_;
				_g_free0 (type_name);
				_g_free0 (_tmp39_);
				_g_free0 (gir_fullname);
				vala_gir_writer_gir_namespace_destroy (&external);
				_g_free0 (ns_gir_name);
				_g_free0 (_tmp6_);
				_vala_code_node_unref0 (ns);
				_vala_code_node_unref0 (parent);
				return result;
			} else {
				ValaHashSet* _tmp53_;
				ValaNamespace* _tmp54_;
				_tmp53_ = self->priv->unannotated_namespaces;
				_tmp54_ = ns;
				vala_collection_add ((ValaCollection*) _tmp53_, _tmp54_);
			}
		}
		_g_free0 (ns_gir_name);
		_g_free0 (_tmp6_);
		_vala_code_node_unref0 (ns);
	}
	_tmp55_ = vala_gir_writer_get_full_gir_name (self, (ValaSymbol*) type_symbol);
	result = _tmp55_;
	_vala_code_node_unref0 (parent);
	return result;
}


static gchar*
vala_gir_writer_literal_expression_to_value_string (ValaGIRWriter* self,
                                                    ValaExpression* literal)
{
	gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (literal != NULL, NULL);
	if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_STRING_LITERAL)) {
		ValaStringLiteral* lit = NULL;
		ValaStringLiteral* _tmp0_;
		ValaStringLiteral* _tmp1_;
		_tmp0_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_STRING_LITERAL) ? ((ValaStringLiteral*) literal) : NULL);
		lit = _tmp0_;
		_tmp1_ = lit;
		if (_tmp1_ != NULL) {
			ValaStringLiteral* _tmp2_;
			gchar* _tmp3_;
			gchar* _tmp4_;
			gchar* _tmp5_;
			gchar* _tmp6_;
			_tmp2_ = lit;
			_tmp3_ = vala_string_literal_eval (_tmp2_);
			_tmp4_ = _tmp3_;
			_tmp5_ = g_markup_escape_text (_tmp4_, (gssize) -1);
			_tmp6_ = _tmp5_;
			_g_free0 (_tmp4_);
			result = _tmp6_;
			_vala_code_node_unref0 (lit);
			return result;
		}
		_vala_code_node_unref0 (lit);
	} else {
		if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_CHARACTER_LITERAL)) {
			gchar* _tmp7_;
			_tmp7_ = g_strdup_printf ("%c", (gint) ((gchar) vala_character_literal_get_char (G_TYPE_CHECK_INSTANCE_CAST (literal, VALA_TYPE_CHARACTER_LITERAL, ValaCharacterLiteral))));
			result = _tmp7_;
			return result;
		} else {
			if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_BOOLEAN_LITERAL)) {
				const gchar* _tmp8_ = NULL;
				gboolean _tmp9_;
				gboolean _tmp10_;
				gchar* _tmp11_;
				_tmp9_ = vala_boolean_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, VALA_TYPE_BOOLEAN_LITERAL, ValaBooleanLiteral));
				_tmp10_ = _tmp9_;
				if (_tmp10_) {
					_tmp8_ = "true";
				} else {
					_tmp8_ = "false";
				}
				_tmp11_ = g_strdup (_tmp8_);
				result = _tmp11_;
				return result;
			} else {
				if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_REAL_LITERAL)) {
					const gchar* _tmp12_;
					const gchar* _tmp13_;
					gchar* _tmp14_;
					_tmp12_ = vala_real_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, VALA_TYPE_REAL_LITERAL, ValaRealLiteral));
					_tmp13_ = _tmp12_;
					_tmp14_ = g_strdup (_tmp13_);
					result = _tmp14_;
					return result;
				} else {
					if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_INTEGER_LITERAL)) {
						const gchar* _tmp15_;
						const gchar* _tmp16_;
						gchar* _tmp17_;
						_tmp15_ = vala_integer_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (literal, VALA_TYPE_INTEGER_LITERAL, ValaIntegerLiteral));
						_tmp16_ = _tmp15_;
						_tmp17_ = g_strdup (_tmp16_);
						result = _tmp17_;
						return result;
					} else {
						if (G_TYPE_CHECK_INSTANCE_TYPE (literal, VALA_TYPE_UNARY_EXPRESSION)) {
							ValaUnaryExpression* unary = NULL;
							ValaUnaryExpression* _tmp18_;
							ValaUnaryExpression* _tmp19_;
							ValaUnaryOperator _tmp20_;
							ValaUnaryOperator _tmp21_;
							_tmp18_ = _vala_code_node_ref0 (G_TYPE_CHECK_INSTANCE_CAST (literal, VALA_TYPE_UNARY_EXPRESSION, ValaUnaryExpression));
							unary = _tmp18_;
							_tmp19_ = unary;
							_tmp20_ = vala_unary_expression_get_operator (_tmp19_);
							_tmp21_ = _tmp20_;
							if (_tmp21_ == VALA_UNARY_OPERATOR_MINUS) {
								ValaUnaryExpression* _tmp22_;
								ValaExpression* _tmp23_;
								ValaExpression* _tmp24_;
								_tmp22_ = unary;
								_tmp23_ = vala_unary_expression_get_inner (_tmp22_);
								_tmp24_ = _tmp23_;
								if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp24_, VALA_TYPE_REAL_LITERAL)) {
									ValaUnaryExpression* _tmp25_;
									ValaExpression* _tmp26_;
									ValaExpression* _tmp27_;
									const gchar* _tmp28_;
									const gchar* _tmp29_;
									gchar* _tmp30_;
									_tmp25_ = unary;
									_tmp26_ = vala_unary_expression_get_inner (_tmp25_);
									_tmp27_ = _tmp26_;
									_tmp28_ = vala_real_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (_tmp27_, VALA_TYPE_REAL_LITERAL, ValaRealLiteral));
									_tmp29_ = _tmp28_;
									_tmp30_ = g_strconcat ("-", _tmp29_, NULL);
									result = _tmp30_;
									_vala_code_node_unref0 (unary);
									return result;
								} else {
									ValaUnaryExpression* _tmp31_;
									ValaExpression* _tmp32_;
									ValaExpression* _tmp33_;
									_tmp31_ = unary;
									_tmp32_ = vala_unary_expression_get_inner (_tmp31_);
									_tmp33_ = _tmp32_;
									if (G_TYPE_CHECK_INSTANCE_TYPE (_tmp33_, VALA_TYPE_INTEGER_LITERAL)) {
										ValaUnaryExpression* _tmp34_;
										ValaExpression* _tmp35_;
										ValaExpression* _tmp36_;
										const gchar* _tmp37_;
										const gchar* _tmp38_;
										gchar* _tmp39_;
										_tmp34_ = unary;
										_tmp35_ = vala_unary_expression_get_inner (_tmp34_);
										_tmp36_ = _tmp35_;
										_tmp37_ = vala_integer_literal_get_value (G_TYPE_CHECK_INSTANCE_CAST (_tmp36_, VALA_TYPE_INTEGER_LITERAL, ValaIntegerLiteral));
										_tmp38_ = _tmp37_;
										_tmp39_ = g_strconcat ("-", _tmp38_, NULL);
										result = _tmp39_;
										_vala_code_node_unref0 (unary);
										return result;
									}
								}
							}
							_vala_code_node_unref0 (unary);
						}
					}
				}
			}
		}
	}
	result = NULL;
	return result;
}


static gboolean
vala_gir_writer_check_accessibility (ValaGIRWriter* self,
                                     ValaSymbol* sym)
{
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	ValaSymbolAccessibility _tmp1_;
	ValaSymbolAccessibility _tmp2_;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	_tmp1_ = vala_symbol_get_access (sym);
	_tmp2_ = _tmp1_;
	if (_tmp2_ == VALA_SYMBOL_ACCESSIBILITY_PUBLIC) {
		_tmp0_ = TRUE;
	} else {
		ValaSymbolAccessibility _tmp3_;
		ValaSymbolAccessibility _tmp4_;
		_tmp3_ = vala_symbol_get_access (sym);
		_tmp4_ = _tmp3_;
		_tmp0_ = _tmp4_ == VALA_SYMBOL_ACCESSIBILITY_PROTECTED;
	}
	if (_tmp0_) {
		result = TRUE;
		return result;
	}
	result = FALSE;
	return result;
}


static gboolean
vala_gir_writer_is_visibility (ValaGIRWriter* self,
                               ValaSymbol* sym)
{
	gboolean result = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (sym != NULL, FALSE);
	result = vala_code_node_get_attribute_bool ((ValaCodeNode*) sym, "GIR", "visible", TRUE);
	return result;
}


ValaGIRWriter*
vala_gir_writer_construct (GType object_type)
{
	ValaGIRWriter* self = NULL;
	self = (ValaGIRWriter*) vala_code_visitor_construct (object_type);
	return self;
}


ValaGIRWriter*
vala_gir_writer_new (void)
{
	return vala_gir_writer_construct (VALA_TYPE_GIR_WRITER);
}


static void
vala_gir_writer_gir_namespace_init (ValaGIRWriterGIRNamespace *self,
                                    const gchar* ns,
                                    const gchar* version)
{
	gchar* _tmp0_;
	gchar* _tmp1_;
	g_return_if_fail (ns != NULL);
	g_return_if_fail (version != NULL);
	memset (self, 0, sizeof (ValaGIRWriterGIRNamespace));
	_tmp0_ = g_strdup (ns);
	_g_free0 ((*self).ns);
	(*self).ns = _tmp0_;
	_tmp1_ = g_strdup (version);
	_g_free0 ((*self).version);
	(*self).version = _tmp1_;
}


static gboolean
vala_gir_writer_gir_namespace_equal (ValaGIRWriterGIRNamespace *self,
                                     ValaGIRWriterGIRNamespace* g)
{
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	const gchar* _tmp1_;
	ValaGIRWriterGIRNamespace _tmp2_;
	const gchar* _tmp3_;
	g_return_val_if_fail (g != NULL, FALSE);
	_tmp1_ = (*self).ns;
	_tmp2_ = *g;
	_tmp3_ = _tmp2_.ns;
	if (g_strcmp0 (_tmp1_, _tmp3_) == 0) {
		const gchar* _tmp4_;
		ValaGIRWriterGIRNamespace _tmp5_;
		const gchar* _tmp6_;
		_tmp4_ = (*self).version;
		_tmp5_ = *g;
		_tmp6_ = _tmp5_.version;
		_tmp0_ = g_strcmp0 (_tmp4_, _tmp6_) == 0;
	} else {
		_tmp0_ = FALSE;
	}
	result = _tmp0_;
	return result;
}


static void
vala_gir_writer_gir_namespace_copy (const ValaGIRWriterGIRNamespace* self,
                                    ValaGIRWriterGIRNamespace* dest)
{
	const gchar* _tmp0_;
	gchar* _tmp1_;
	const gchar* _tmp2_;
	gchar* _tmp3_;
	_tmp0_ = (*self).ns;
	_tmp1_ = g_strdup (_tmp0_);
	_g_free0 ((*dest).ns);
	(*dest).ns = _tmp1_;
	_tmp2_ = (*self).version;
	_tmp3_ = g_strdup (_tmp2_);
	_g_free0 ((*dest).version);
	(*dest).version = _tmp3_;
}


static void
vala_gir_writer_gir_namespace_destroy (ValaGIRWriterGIRNamespace* self)
{
	_g_free0 ((*self).ns);
	_g_free0 ((*self).version);
}


static ValaGIRWriterGIRNamespace*
vala_gir_writer_gir_namespace_dup (const ValaGIRWriterGIRNamespace* self)
{
	ValaGIRWriterGIRNamespace* dup;
	dup = g_new0 (ValaGIRWriterGIRNamespace, 1);
	vala_gir_writer_gir_namespace_copy (self, dup);
	return dup;
}


static void
vala_gir_writer_gir_namespace_free (ValaGIRWriterGIRNamespace* self)
{
	vala_gir_writer_gir_namespace_destroy (self);
	g_free (self);
}


static GType
vala_gir_writer_gir_namespace_get_type (void)
{
	static volatile gsize vala_gir_writer_gir_namespace_type_id__volatile = 0;
	if (g_once_init_enter (&vala_gir_writer_gir_namespace_type_id__volatile)) {
		GType vala_gir_writer_gir_namespace_type_id;
		vala_gir_writer_gir_namespace_type_id = g_boxed_type_register_static ("ValaGIRWriterGIRNamespace", (GBoxedCopyFunc) vala_gir_writer_gir_namespace_dup, (GBoxedFreeFunc) vala_gir_writer_gir_namespace_free);
		g_once_init_leave (&vala_gir_writer_gir_namespace_type_id__volatile, vala_gir_writer_gir_namespace_type_id);
	}
	return vala_gir_writer_gir_namespace_type_id__volatile;
}


static void
vala_gir_writer_class_init (ValaGIRWriterClass * klass)
{
	vala_gir_writer_parent_class = g_type_class_peek_parent (klass);
	((ValaCodeVisitorClass *) klass)->finalize = vala_gir_writer_finalize;
	g_type_class_add_private (klass, sizeof (ValaGIRWriterPrivate));
	((ValaGIRWriterClass *) klass)->get_interface_comment = (gchar* (*) (ValaGIRWriter *, ValaInterface*)) vala_gir_writer_real_get_interface_comment;
	((ValaGIRWriterClass *) klass)->get_struct_comment = (gchar* (*) (ValaGIRWriter *, ValaStruct*)) vala_gir_writer_real_get_struct_comment;
	((ValaGIRWriterClass *) klass)->get_enum_comment = (gchar* (*) (ValaGIRWriter *, ValaEnum*)) vala_gir_writer_real_get_enum_comment;
	((ValaGIRWriterClass *) klass)->get_class_comment = (gchar* (*) (ValaGIRWriter *, ValaClass*)) vala_gir_writer_real_get_class_comment;
	((ValaGIRWriterClass *) klass)->get_error_code_comment = (gchar* (*) (ValaGIRWriter *, ValaErrorCode*)) vala_gir_writer_real_get_error_code_comment;
	((ValaGIRWriterClass *) klass)->get_enum_value_comment = (gchar* (*) (ValaGIRWriter *, ValaEnumValue*)) vala_gir_writer_real_get_enum_value_comment;
	((ValaGIRWriterClass *) klass)->get_constant_comment = (gchar* (*) (ValaGIRWriter *, ValaConstant*)) vala_gir_writer_real_get_constant_comment;
	((ValaGIRWriterClass *) klass)->get_error_domain_comment = (gchar* (*) (ValaGIRWriter *, ValaErrorDomain*)) vala_gir_writer_real_get_error_domain_comment;
	((ValaGIRWriterClass *) klass)->get_field_comment = (gchar* (*) (ValaGIRWriter *, ValaField*)) vala_gir_writer_real_get_field_comment;
	((ValaGIRWriterClass *) klass)->get_delegate_comment = (gchar* (*) (ValaGIRWriter *, ValaDelegate*)) vala_gir_writer_real_get_delegate_comment;
	((ValaGIRWriterClass *) klass)->get_method_comment = (gchar* (*) (ValaGIRWriter *, ValaMethod*)) vala_gir_writer_real_get_method_comment;
	((ValaGIRWriterClass *) klass)->get_property_comment = (gchar* (*) (ValaGIRWriter *, ValaProperty*)) vala_gir_writer_real_get_property_comment;
	((ValaGIRWriterClass *) klass)->get_delegate_return_comment = (gchar* (*) (ValaGIRWriter *, ValaDelegate*)) vala_gir_writer_real_get_delegate_return_comment;
	((ValaGIRWriterClass *) klass)->get_signal_return_comment = (gchar* (*) (ValaGIRWriter *, ValaSignal*)) vala_gir_writer_real_get_signal_return_comment;
	((ValaGIRWriterClass *) klass)->get_method_return_comment = (gchar* (*) (ValaGIRWriter *, ValaMethod*)) vala_gir_writer_real_get_method_return_comment;
	((ValaGIRWriterClass *) klass)->get_signal_comment = (gchar* (*) (ValaGIRWriter *, ValaSignal*)) vala_gir_writer_real_get_signal_comment;
	((ValaGIRWriterClass *) klass)->get_parameter_comment = (gchar* (*) (ValaGIRWriter *, ValaParameter*)) vala_gir_writer_real_get_parameter_comment;
	((ValaCodeVisitorClass *) klass)->visit_namespace = (void (*) (ValaCodeVisitor *, ValaNamespace*)) vala_gir_writer_real_visit_namespace;
	((ValaCodeVisitorClass *) klass)->visit_class = (void (*) (ValaCodeVisitor *, ValaClass*)) vala_gir_writer_real_visit_class;
	((ValaCodeVisitorClass *) klass)->visit_struct = (void (*) (ValaCodeVisitor *, ValaStruct*)) vala_gir_writer_real_visit_struct;
	((ValaCodeVisitorClass *) klass)->visit_interface = (void (*) (ValaCodeVisitor *, ValaInterface*)) vala_gir_writer_real_visit_interface;
	((ValaCodeVisitorClass *) klass)->visit_enum = (void (*) (ValaCodeVisitor *, ValaEnum*)) vala_gir_writer_real_visit_enum;
	((ValaCodeVisitorClass *) klass)->visit_enum_value = (void (*) (ValaCodeVisitor *, ValaEnumValue*)) vala_gir_writer_real_visit_enum_value;
	((ValaCodeVisitorClass *) klass)->visit_error_domain = (void (*) (ValaCodeVisitor *, ValaErrorDomain*)) vala_gir_writer_real_visit_error_domain;
	((ValaCodeVisitorClass *) klass)->visit_error_code = (void (*) (ValaCodeVisitor *, ValaErrorCode*)) vala_gir_writer_real_visit_error_code;
	((ValaCodeVisitorClass *) klass)->visit_constant = (void (*) (ValaCodeVisitor *, ValaConstant*)) vala_gir_writer_real_visit_constant;
	((ValaCodeVisitorClass *) klass)->visit_field = (void (*) (ValaCodeVisitor *, ValaField*)) vala_gir_writer_real_visit_field;
	((ValaCodeVisitorClass *) klass)->visit_delegate = (void (*) (ValaCodeVisitor *, ValaDelegate*)) vala_gir_writer_real_visit_delegate;
	((ValaCodeVisitorClass *) klass)->visit_method = (void (*) (ValaCodeVisitor *, ValaMethod*)) vala_gir_writer_real_visit_method;
	((ValaCodeVisitorClass *) klass)->visit_creation_method = (void (*) (ValaCodeVisitor *, ValaCreationMethod*)) vala_gir_writer_real_visit_creation_method;
	((ValaCodeVisitorClass *) klass)->visit_property = (void (*) (ValaCodeVisitor *, ValaProperty*)) vala_gir_writer_real_visit_property;
	((ValaCodeVisitorClass *) klass)->visit_signal = (void (*) (ValaCodeVisitor *, ValaSignal*)) vala_gir_writer_real_visit_signal;
}


static void
vala_gir_writer_instance_init (ValaGIRWriter * self)
{
	GString* _tmp0_;
	GHashFunc _tmp1_;
	GEqualFunc _tmp2_;
	ValaHashSet* _tmp3_;
	GHashFunc _tmp4_;
	GEqualFunc _tmp5_;
	ValaHashSet* _tmp6_;
	GEqualFunc _tmp7_;
	ValaArrayList* _tmp8_;
	GEqualFunc _tmp9_;
	ValaArrayList* _tmp10_;
	ValaArrayList* _tmp11_;
	self->priv = VALA_GIR_WRITER_GET_PRIVATE (self);
	_tmp0_ = g_string_new ("");
	self->priv->buffer = _tmp0_;
	_tmp1_ = g_direct_hash;
	_tmp2_ = g_direct_equal;
	_tmp3_ = vala_hash_set_new (VALA_TYPE_NAMESPACE, (GBoxedCopyFunc) vala_code_node_ref, (GDestroyNotify) vala_code_node_unref, _tmp1_, _tmp2_);
	self->priv->unannotated_namespaces = _tmp3_;
	_tmp4_ = g_direct_hash;
	_tmp5_ = g_direct_equal;
	_tmp6_ = vala_hash_set_new (VALA_TYPE_NAMESPACE, (GBoxedCopyFunc) vala_code_node_ref, (GDestroyNotify) vala_code_node_unref, _tmp4_, _tmp5_);
	self->priv->our_namespaces = _tmp6_;
	_tmp7_ = g_direct_equal;
	_tmp8_ = vala_array_list_new (VALA_TYPE_SYMBOL, (GBoxedCopyFunc) vala_code_node_ref, (GDestroyNotify) vala_code_node_unref, _tmp7_);
	self->priv->hierarchy = _tmp8_;
	_tmp9_ = g_direct_equal;
	_tmp10_ = vala_array_list_new (VALA_TYPE_CODE_NODE, (GBoxedCopyFunc) vala_code_node_ref, (GDestroyNotify) vala_code_node_unref, _tmp9_);
	self->priv->deferred = _tmp10_;
	_tmp11_ = vala_array_list_new (VALA_GIR_WRITER_TYPE_GIR_NAMESPACE, (GBoxedCopyFunc) vala_gir_writer_gir_namespace_dup, (GDestroyNotify) vala_gir_writer_gir_namespace_free, (GEqualFunc) vala_gir_writer_gir_namespace_equal);
	self->priv->externals = _tmp11_;
}


static void
vala_gir_writer_finalize (ValaCodeVisitor * obj)
{
	ValaGIRWriter * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, VALA_TYPE_GIR_WRITER, ValaGIRWriter);
	_vala_code_context_unref0 (self->priv->context);
	_g_free0 (self->priv->directory);
	_g_free0 (self->priv->gir_namespace);
	_g_free0 (self->priv->gir_version);
	_g_free0 (self->priv->gir_shared_library);
	_g_string_free0 (self->priv->buffer);
	_fclose0 (self->priv->stream);
	_vala_iterable_unref0 (self->priv->unannotated_namespaces);
	_vala_iterable_unref0 (self->priv->our_namespaces);
	_vala_iterable_unref0 (self->priv->hierarchy);
	_vala_iterable_unref0 (self->priv->deferred);
	_vala_code_node_unref0 (self->priv->gobject_type);
	_vala_code_node_unref0 (self->priv->ginitiallyunowned_type);
	_vala_iterable_unref0 (self->priv->externals);
	VALA_CODE_VISITOR_CLASS (vala_gir_writer_parent_class)->finalize (obj);
}


/**
 * Code visitor generating .gir file for the public interface.
 */
GType
vala_gir_writer_get_type (void)
{
	static volatile gsize vala_gir_writer_type_id__volatile = 0;
	if (g_once_init_enter (&vala_gir_writer_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (ValaGIRWriterClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) vala_gir_writer_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (ValaGIRWriter), 0, (GInstanceInitFunc) vala_gir_writer_instance_init, NULL };
		GType vala_gir_writer_type_id;
		vala_gir_writer_type_id = g_type_register_static (VALA_TYPE_CODE_VISITOR, "ValaGIRWriter", &g_define_type_info, 0);
		g_once_init_leave (&vala_gir_writer_type_id__volatile, vala_gir_writer_type_id);
	}
	return vala_gir_writer_type_id__volatile;
}


static void
_vala_array_destroy (gpointer array,
                     gint array_length,
                     GDestroyNotify destroy_func)
{
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void
_vala_array_free (gpointer array,
                  gint array_length,
                  GDestroyNotify destroy_func)
{
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}


static gint
_vala_array_length (gpointer array)
{
	int length;
	length = 0;
	if (array) {
		while (((gpointer*) array)[length]) {
			length++;
		}
	}
	return length;
}



